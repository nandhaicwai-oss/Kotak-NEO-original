async function stableFetch(t,a={}){await new Promise((t=>setTimeout(t,120)));try{return await fetch(t,a)}catch(e){return await new Promise((t=>setTimeout(t,200))),fetch(t,a)}}chrome.runtime.onMessage.addListener(((t,a,e)=>"API_FETCH"===t.type?((async()=>{try{let a={method:t.method||"POST",headers:t.headers};t.body&&(a.body="string"==typeof t.body?t.body:JSON.stringify(t.body));const s=await stableFetch(t.url,a);if(s.ok){const t=await s.json().catch((()=>({})));e({ok:!0,status:s.status,data:t})}else{const t=await s.text();let a,c;try{a=JSON.parse(t)}catch{c=t}e({ok:!1,status:s.status,error:c,data:a})}}catch(t){e({ok:!1,error:t.message})}})(),!0):"API_PLAIN_FETCH"===t.type?((async()=>{try{const a=await stableFetch(t.url),s=await a.text().catch((()=>({})));e({ok:a.ok,status:a.status,data:s})}catch(t){e({ok:!1,error:t.message})}})(),!0):void 0));