var publicKeyPEM="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSreBM+rgd82hGn/2qPx4wAY3tXzMeydnpwQ0hYabGupHMNKQHYyTFVdHqPI05ffYFRpy+RpIYeDdbLTH8Z6CIEipZW2S6TrzWSc8W/+XEKQPC9t4px1ZRqI1efBm7DSsXkpKJt0m3+FXxG5Xee3JtNqyvCTSNWWdaLMsRCUiiIQIDAQAB\n-----END PUBLIC KEY-----",publicKey="",userID="",expiryDate=new Date,subType="default",basketModeCode="200",mtmStopLossCode="300",forcedStatus="200",forcedMessage="";let workModeCode="",fetchNetworkBlocked=!1;async function _f83c2f3(){let e=await _fb3ac9d("expiryDate",expiryDate.getTime());expiryDate=new Date(e);let t=await _fb3ac9d("lastReloadTime",lastReloadTime.getTime());lastReloadTime=new Date(t),latestVersion=await _fb3ac9d("latestVersion",latestVersion),minVersion=await _fb3ac9d("minVersion",minVersion),subType=await _fb3ac9d("subType",subType),forcedStatus=await _fb3ac9d("forcedStatus",forcedStatus),isBasketFeature=await _fb3ac9d("isBasketFeature",isBasketFeature),isMTMStopLossFeature=await _fb3ac9d("isMTMStopLossFeature",isMTMStopLossFeature),forcedMessage=await _fb3ac9d("forcedMessage",forcedMessage),isAPIMode=await _fb3ac9d("isAPIMode",isAPIMode),instanceCounter=await _fb3ac9d("instanceCounter",instanceCounter),instanceCounter++,await setSyncStorage("instanceCounter",instanceCounter)}async function _fda7b68(){let e=publicKeyPEM;const t=e.substring(26,e.length-24-1),o=window.atob(t),i=str2ab(o);let a;for(publicKey=await window.crypto.subtle.importKey("spki",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);null==a&&isAppActive;)a=document.querySelector(".user-id"),await delay(100);userID=a.innerText.toUpperCase();const n=getJsEngineURL(CURRENT_BROKER)+userID;let r;if(await fetch(n).then((e=>{if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return e})).then((e=>{r=e})).catch((e=>{isInitDone||showPlusMessage(document,"Extension can't be loaded properly, try refreshing the page","error")})),null==r)return void _f02a714();if(!r.ok)return void _f02a714();const s=await r.json();if(!isJsonString(s))return void _f02a714();let l=!1,c=JSON.parse(s);latestVersion=c.latestVersion,minVersion=c.minVersion,forcedStatus=c.forcedStatus,forcedMessage=c.forcedMessage,basketModeCode=c.basketModeCode,mtmStopLossCode=c.mtmStopLossCode,workModeCode=c.workMode,null!=c.licenseStatus&&""!=c.licenseStatus&&(licenseStatus=c.licenseStatus,await setSyncStorage("licenseStatus",licenseStatus)),null!=c.subType&&""!=c.subType&&(subType=c.subType);let u=c.expiryDate,f=Date.parse(u);if(expiryDate=new Date(f),"Active"==licenseStatus){let e=c.sign;l=!!isHexadecimal(e)&&await verifySign(e,userID)}else"Expired"==licenseStatus||"NoUser"==licenseStatus?l=!1:("FreeNoUser"==licenseStatus||"FreeUser"==licenseStatus)&&(l=!0);_fc80430(l),await delay(20),_fa114af()}function _f02a714(){"Active"==licenseStatus||"FreeUser"==licenseStatus||"FreeNoUser"==licenseStatus?isInitDone||_fc80430(!0):_fc80430(!1)}const verifySign=(e,t)=>new Promise(((o,i)=>{window.crypto.subtle.verify({name:"RSASSA-PKCS1-v1_5",saltLength:64},publicKey,hexStringToUint8Array(e),asciiToUint8Array(t)).then((function(e){o(e)})).catch((function(e){o(!1)}))}));function _f2c3813(e){return e==KOTAK_BROKER?"https://radiuscraft.com/neoplus/#pricing":e==JAINAM_BROKER?"https://radiuscraft.com/jainamplus/#pricing":"https://kiteplus.radiuscraft.com/#pricing"}let basketWindowContainer,baseRow,kitePlusUserInfo={userID:""};async function _fcef30f(){let e="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSreBM+rgd82hGn/2qPx4wAY3tXzMeydnpwQ0hYabGupHMNKQHYyTFVdHqPI05ffYFRpy+RpIYeDdbLTH8Z6CIEipZW2S6TrzWSc8W/+XEKQPC9t4px1ZRqI1efBm7DSsXkpKJt0m3+FXxG5Xee3JtNqyvCTSNWWdaLMsRCUiiIQIDAQAB\n-----END PUBLIC KEY-----";const t=e.substring(26,243),o=window.atob(t),i=str2ab(o);publicKey=await window.crypto.subtle.importKey("spki",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);let a={};a.userID=kitePlusUserInfo.userID,a.browser=currentBrowserName,a.version=currentVersion;let n,r="",s="";CURRENT_BROKER==ZERODHA_BROKER&&(a.apiCounter=await _fb3ac9d("neoApiLoginCounter",0),s="https://kiteplus.radiuscraft.com/wp-json/jsEngineKotak/v1/fetchUserData"),CURRENT_BROKER==KOTAK_BROKER?(a.apiCounter=await _fb3ac9d("neoApiLoginCounter",0),s="https://kiteplus.radiuscraft.com/wp-json/jsEngineKotak/v1/fetchUserData",r=cfURL+"fetchUserDataK"):CURRENT_BROKER==JAINAM_BROKER&&(s="https://kiteplus.radiuscraft.com/wp-json/jsEngineJainam/v1/fetchUserData",r=cfURL+"fetchUserDataJ");let l=!1;try{try{if(n=await fetchWithTimeout(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},3e3),!n.ok&&404===n.status)throw new Error("404_FALLBACK")}catch(e){try{n=await fetchWithTimeout(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},7e3)}catch(e){l=!0}}if(l)return isInitDone||showPlusMessage(document,"KitePlus can't be loaded, try refreshing the page","error"),fetchNetworkBlocked=!0,void _fc80430(!1);if(l||!n.ok)return fetchNetworkBlocked=!0,void _fc80430(!1);let e=await n.json(),t=!1;latestVersion=e.latestVersion,minVersion=e.minVersion,forcedStatus=e.forcedStatus,forcedMessage=e.forcedMessage,basketModeCode=e.basketModeCode,mtmStopLossCode=e.mtmStopLossCode,workModeCode=e.workMode,null!=e.licenseStatus&&""!=e.licenseStatus&&(licenseStatus=e.licenseStatus,await setSyncStorage("licenseStatus",licenseStatus)),null!=e.subType&&""!=e.subType&&(subType=e.subType);let o=e.expiryDate,i=Date.parse(o);if(expiryDate=new Date(i),"Active"==licenseStatus){let o=e.sign;t=!!isHexadecimal(o)&&await verifySign(o,kitePlusUserInfo.userID)}else"Expired"==licenseStatus||"NoUser"==licenseStatus?t=!1:("FreeNoUser"==licenseStatus||"FreeUser"==licenseStatus)&&(t=!0);_fa114af(),_fc80430(t),await delay(20)}catch(e){return void(isInitDone||showPlusMessage(document,"NeoPlus can't be loaded, try refreshing the page","error"))}}function _f8be915(){utilityContainer.querySelector("#idBrokerID");let e=utilityContainer.querySelector("#licenseHeader"),t=utilityContainer.querySelector("#expiryDateInfo"),o=utilityContainer.querySelector("#aboutPurchase"),i=utilityContainer.querySelector("#versionText"),a=document.querySelector("#storeReviewLink");null!=a&&(a.href=getStoreRatingLink(CURRENT_BROKER)),i.innerText=currentVersion,o.style.display="none","Active"==licenseStatus?(e.innerText="Valid Till:",t.innerHTML=getFormattedDateHTML(expiryDate)):"Expired"==licenseStatus?(e.innerText="Subscription Expired On",t.innerHTML=getFormattedDateHTML(expiryDate),o.style.display="flex"):"NoUser"==licenseStatus?(e.innerText="No Valid Subscription",t.innerHTML="",o.style.display="flex"):("FreeUser"==licenseStatus||"FreeNoUser"==licenseStatus)&&(e.innerText="Limited Free Trial With all Features",t.innerHTML="",o.style.display="flex"),"gift"==subType&&(e.innerText="Gift Subscription, Valid Till"),fetchNetworkBlocked&&(e.innerText="Unable to validate the subscription due to a network error",t.innerHTML="",o.style.display="none")}async function _fa54f10(){if(userConfigData=await _fb3ac9d("userConfigDataKey",userConfigData),isCustomUserMode){let e;for(;null==e&&isAppActive;)e=document.querySelector(".user-id"),await delay(100);userID=e.innerText.toUpperCase();let t={};t.userID=userID,t.auth="123";try{const e=await fetch("https://kiteplus.radiuscraft.com/wp-json/jsEngine/v1/fetchUserData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});await e.json()}catch(e){}}}let basketOpenBtn,basketModalContainer,basketHeaderElement,tbody_Basket,modalBody,modalFooter,messageElement,addRowBtn,buttonExecute,basketHeaderNameElement,orderDayTypeElement,basketPriceElement,basketChangeElement,premiumElement,additionalMarginElement,remainingMarginElement,headerInstToken,basketSearchDiv,searchClose,searchSymbol,searchUlParentDiv,basketSearchInput,currentSymbolFreezeLimit,quantityMultiplierInput,basketRows=[],basketWindowStatus=[],basketWindowCallCounter=0,headerName="",isExecuteBlocked=!1,isNRMLBasketOrder=!0,nudgeResponseData=0,currentSplitBasket=[],currentQuantityMultiplier=0,oldQuantityMultiplier=0;var prefIsNrmlBasketOrder={key:!0};let isBasketWindowOpen=!1,currentUnderlyingPrice=-1,currentSyntheticPrice=-1,isShowDelta=!1,isMcxBasket=!1,mcxMultiplier=1,isKeepBasketOpen=!1;const recentBasketSearches=new RecentSearches(5);async function _fc1aa8e(){if(basketOpenBtn=document.querySelector("#basketOpenBtn"),isBasketFeature||basketOpenBtn.addEventListener("click",(()=>{showPlusMessage(document,"Basket feature is not available right now","error")})),!isBasketFeature)return;isShowDelta=await _fb3ac9d("prefBasketDeltaKey",isShowDelta),isKeepBasketOpen=await _fb3ac9d("prefKeepBasketWindowKey",isKeepBasketOpen),basketWindowContainer=document.createElement("div"),torpedoRoot.appendChild(basketWindowContainer),basketWindowContainer.id="basketWindowContainer";let e=await fetch(chrome.runtime.getURL("Blocks/BasketWindow.html"));basketWindowContainer.innerHTML+=await e.text(),basketModalContainer=basketWindowContainer.querySelector(".modal-container");let t=basketWindowContainer.querySelector(".modal-body tbody tr");baseRow=t.cloneNode(!0),makeDraggableXDirection(basketWindowContainer.querySelector(".dragHeaderHandle"),basketWindowContainer.querySelector(".modal-container")),modalBody=basketWindowContainer.querySelector(".modal-body"),modalFooter=basketWindowContainer.querySelector(".modal-footer"),tbody_Basket=modalBody.querySelector(".modal-body tbody"),basketHeaderElement=basketWindowContainer.querySelector(".modal-header .row"),basketSearchDiv=basketWindowContainer.querySelector(".modal-header .basketSearchDiv"),searchUlParentDiv=basketSearchDiv.querySelector(".ulParentDiv"),searchSymbol=basketWindowContainer.querySelector(".searchButtonSymbol"),searchClose=basketWindowContainer.querySelector(".searchClose"),basketSearchInput=basketWindowContainer.querySelector(".modal-header input"),basketHeaderNameElement=basketWindowContainer.querySelector(".modal-header .basketHeaderName"),basketPriceElement=basketWindowContainer.querySelector(".modal-header  .basketPrice"),basketChangeElement=basketWindowContainer.querySelector(".modal-header .basketChange"),orderDayTypeElement=basketWindowContainer.querySelector(".modal-header .orderDayType"),addRowBtn=basketWindowContainer.querySelector(".modalBodyBottomDiv .addBtn"),premiumElement=basketWindowContainer.querySelector("#basketInfoPremium"),additionalMarginElement=basketWindowContainer.querySelector("#basketInfoAddMargin"),remainingMarginElement=basketWindowContainer.querySelector("#basketInfoRemMargin");let o=basketWindowContainer.querySelector(".thDelta"),i=basketWindowContainer.querySelector(".thBestPrice");o.style.display=isShowDelta?"block":"none",i.style.display=isShowDelta?"none":"block",quantityMultiplierInput=basketWindowContainer.querySelector(".basketGroupQuantity input");let a=basketWindowContainer.querySelector(".basketGroupQuantity .basketgroupQuantityDown"),n=basketWindowContainer.querySelector(".basketGroupQuantity .basketgroupQuantityUp");_f733cfb(basketWindowContainer);let r={minusButton:a,plusButton:n,textElement:quantityMultiplierInput};quantityMultiplierInput.addEventListener("keydown",(e=>{27==e.keyCode&&(quantityMultiplierInput.value=currentQuantityMultiplier,quantityMultiplierInput.blur()),13==e.keyCode&&quantityMultiplierInput.blur()})),quantityMultiplierInput.addEventListener("input",(function(){quantityMultiplierInput.value=quantityMultiplierInput.value.replace(/[^0-9, ]/,"")})),quantityMultiplierInput.addEventListener("change",(function(){""!=quantityMultiplierInput.value?currentQuantityMultiplier=parseInt(quantityMultiplierInput.value):quantityMultiplierInput.value=currentQuantityMultiplier=1,_fdbe17a(!0)})),_f9b2ec3(r,(e=>{if(e)_fc86a51();else{let e=currentQuantityMultiplier+r.direction;if(e<=0)return;oldQuantityMultiplier=currentQuantityMultiplier,currentQuantityMultiplier=e,quantityMultiplierInput.value=currentQuantityMultiplier,_fdbe17a(!1)}})),messageElement=basketWindowContainer.querySelector(".responseMessage");let s=basketWindowContainer.querySelector("#positionSwitcherBG"),l=basketWindowContainer.querySelector(".buttonClose"),c=basketWindowContainer.querySelector(".buttonExecute"),u=c.querySelector(".executeButtonLock"),f=c.querySelector(".executeButtonText");for(u.style.display=isPrem?"none":"block",f.style.display=isPrem?"block":"none",s.addEventListener("click",(()=>_fe76c48(!1))),l.addEventListener("click",(()=>_fe76c48(!1))),fetchedStorageValue=await fetchSyncStorage("prefIsNrmlBasketOrder"),null!=fetchedStorageValue&&(isNRMLBasketOrder=fetchedStorageValue),orderDayTypeElement.addEventListener("click",(async()=>{isNRMLBasketOrder=!isNRMLBasketOrder,_f339f9a()})),c.addEventListener("click",(async function(){if(!isPrem)return void showPlusMessage(document,"You don't have any active subscription plan to use basket feature","error");if(isExecuteBlocked)return showPlusMessage(document,"Please wait, basket order is processing","info"),void _fa93f63("multiple basket processing error");_f2b1270("Executing...","info"),isExecuteBlocked=!0;let e=await _f271ae9();if("error"==e.status){let t=e.message,o=t.indexOf("[Read");o>0&&(t=t.substring(0,o)),t.includes("AMO")&&(t="Market is closed! Can't place the order right now."),_f2b1270(t,"error"),isExecuteBlocked=!1}else isKeepBasketOpen?(messageString="Completed!",_f2b1270(messageString,"info"),await delay(1e3),_fe76c48(!0)):_fe76c48(!1)})),_f339f9a(),_f21a132(),_f4c29eb(premiumElement),async function(){let e=basketWindowContainer.querySelector(".basketPageDivParent"),t=basketWindowContainer.querySelector(".basketPageBtnSetParent"),o=basketWindowContainer.querySelector(".basketPageUtilityBtnSet"),i=basketWindowContainer.querySelector(".basketPageBtn");for(let e=0;e<PAGE_COUNT;e++){basketPages.push([]);let a=e,n=i.cloneNode(!0);n.querySelector(".basketPageBtnText").textContent=0==e?"Default":`${e}`,t.appendChild(n),n.classList.toggle("selectedBtn",0==e),pageBtnList.push(n),n.addEventListener("click",(e=>{o.style.display=0==a?"none":"flex",_f22bc1e(a)}))}i.remove(),e.querySelector(".posDelete").addEventListener("click",(e=>{_f13a915()})),e.querySelector(".posClone").addEventListener("click",(e=>{_f5a3c89()})),window.onpagehide=e=>{e.persisted||_f799973()}}(),basketPages=(await _fb3ac9d("basketPages",basketPages)||[]).slice(0,PAGE_COUNT);basketPages.length<PAGE_COUNT;)basketPages.push([]);_f733cfb(basketWindowContainer)}async function _fbb19f0(){basketPages=[];for(let e=0;e<PAGE_COUNT;e++)basketPages.push([]);await setSyncStorage("basketPages",basketPages)}let PAGE_COUNT=8,currentSelectedBasketPage=0,pageBtnList=[],basketPages=[];async function _f22bc1e(e){for(let t=0;t<pageBtnList.length;t++){const o=pageBtnList[t];t==e&&(_f799973(),currentSelectedBasketPage=e,_f6f8f1a(basketPages[currentSelectedBasketPage])),o.classList.toggle("selectedBtn",t==e)}}async function _f13a915(){0!=basketRows.length&&(_ffb08c2(),basketRows=[],_fe4a03d())}async function _f5a3c89(){_f6f8f1a(basketPages[0])}async function _f799973(){let e=basketRows.map((e=>({inst:e.inst,quantity:e.quantity,isSell:e.isSell,dayOrderType:e.dayOrderType,isSelected:e.isSelected})));basketPages[currentSelectedBasketPage]=e,await setSyncStorage("basketPages",basketPages),await _fb3ac9d("basketPages",basketPages)}async function _fdbe17a(e){let t=[];for(let e=0;e<basketRows.length;e++){const o=basketRows[e];let i=o.quantity/o.inst.lot_size;t.push(i)}let o=findGCD(t,t.length);for(let e=0;e<basketRows.length;e++){const t=basketRows[e];let i=t.quantity/o*currentQuantityMultiplier;t.quantity=i,t.quantityUpDownObject.textElement.value=i,t.updateRowMultiplier()}e&&_fc86a51()}async function _fa8f570(){if(0==basketRows.length)return;let e=[];for(let t=0;t<basketRows.length;t++){const o=basketRows[t];let i=o.quantity/o.inst.lot_size;e.push(i)}let t=findGCD(e,e.length);currentQuantityMultiplier=t,quantityMultiplierInput.value=currentQuantityMultiplier}async function _f339f9a(){await setSyncStorage("prefIsNrmlBasketOrder",isNRMLBasketOrder),basketRows.forEach((e=>e.dayOrderType=isNRMLBasketOrder?"NRML":"MIS")),orderDayTypeElement.classList.toggle("aqua",!isNRMLBasketOrder),orderDayTypeElement.classList.toggle("indigo",isNRMLBasketOrder),orderDayTypeElement.innerText=isNRMLBasketOrder?"NRML":"MIS"}function _fc2802f(){searchClose.dispatchEvent(new Event("click"))}let defaultNiftyLeg,arrowBtnClickHandler,customBasketPositionHandler,firstBasketLeg,basketUpdaterTimeout,isSearchListOpen=!1;async function _f21a132(){await _fbe09ae(),await delay(1e3);let e=6,t=basketSearchDiv.querySelector("ul"),o=[];for(let a=0;a<e;a++){let e=document.createElement("li");t.appendChild(e),o.push(e),e.addEventListener("click",(t=>{i(e.innerText)}))}async function i(e){if("-"!=e){if(r(!1),a(),headerName!=e){basketSearchInput.value=e;let t=await _f2cbdf1(e);defaultSearchInstruments.includes(e)||recentBasketSearches.addSearch(e),t||(basketSearchInput.value=headerName)}basketSearchInput.value=headerName}else n()}function a(){for(let t=0;t<e;t++)o[t].innerText="",o[t].style.display="none"}function n(){basketSearchInput.value=headerName,r(!1),a(),basketSearchInput.blur()}function r(e){isSearchListOpen=e,searchClose.style.visibility=e?"visible":"hidden",searchSymbol.style.visibility=e?"hidden":"visible",modalBody.classList.toggle("searchOpen",e),modalFooter.classList.toggle("searchOpen",e),searchUlParentDiv.style.visibility=e?"visible":"hidden"}function s(e,t){o[e].innerText=t,o[e].style.display="block"}function l(){o.forEach(((e,t)=>{e.classList.toggle("active",t===c)}))}basketOpenBtn.addEventListener("click",(()=>{""==headerName?i("NIFTY"):(n(),_fe76c48(!0))})),searchSymbol.addEventListener("click",(()=>{basketSearchInput.focus(),basketSearchInput.value=""})),searchClose.addEventListener("click",(()=>{n()})),basketSearchInput.addEventListener("keydown",(e=>{27==e.keyCode&&n()}),!0),basketSearchInput.addEventListener("change",(()=>{""==basketSearchInput.value&&(basketSearchInput.value=headerName)})),modalBody.addEventListener("click",(e=>{isSearchListOpen&&(basketSearchInput.value=headerName,r(!1),a(),e.preventDefault())})),modalFooter.addEventListener("click",(e=>{isSearchListOpen&&(basketSearchInput.value=headerName,r(!1),a(),e.preventDefault())}));let c=-1,u=0;function f(){r(!0),a();for(let e=0;e<defaultSearchInstruments.length;e++)u++,s(e,defaultSearchInstruments[e]);let t=recentBasketSearches.getSearches(),o=0;for(let i=defaultSearchInstruments.length;i<e;i++)""!=t[o]&&null!=t[o]&&(s(i,t[o]),u++),o++}document.addEventListener("keydown",(e=>{if(isSearchListOpen)if("ArrowDown"===e.key)c=(c+1)%u,l(),e.preventDefault();else if("ArrowUp"===e.key)c=(c-1+u)%u,l(),e.preventDefault();else if("Enter"===e.key){if(c>=0){const e=o[c];""!=e.innerText.trim()&&(i(e.innerText),n()),c=-1,l()}e.preventDefault()}}),!0),basketSearchInput.addEventListener("focus",(e=>{basketSearchInput.value="",u=0,c=-1,l(),f()})),basketSearchInput.addEventListener("input",(t=>{let o=basketSearchInput.value.toUpperCase();if(u=0,""==o.trim())return void f();r(!0),a(),r(!0);let i=eqFOKeys.filter((e=>e.includes(o))),n=Math.min(i.length,e);for(let e=0;e<Math.max(n,3);e++)e<i.length?(u++,s(e,i[e])):s(e,"-");t.stopImmediatePropagation()}),!0),_f26736f()}async function _f26736f(){let e="NIFTY",t=_fda88a8(e);_f7d8e25(BASKET_TOKEN_KEY,[t]);let o=await _f2907f8(t);if(-1!=o){let t=_f41274d(e,void 0);if(null!=t){let e=_fed54b2(t.ceList,t.peList,o);null!=e&&null!=e.CE&&(defaultNiftyLeg={baseInst:e.CE,quantity:e.PE.lot_size,isSell:!0})}}}async function _f2cbdf1(e){_f2b1270("Loading Basket...","info");let t=_fda88a8(e);_f7d8e25(BASKET_TOKEN_KEY,[t]);let o=await _f2907f8(t);if(-1!=o){let t=_f41274d(e,void 0);if(null!=t){let i=[],a=_fed54b2(t.ceList,t.peList,o);return headerName=e,basketSearchInput.value=headerName,i.push({baseInst:a.PE,quantity:a.PE.lot_size,isSell:!0}),i.push({baseInst:a.CE,quantity:a.PE.lot_size,isSell:!0}),isShowDelta&&_f489fb8(),_f7ff8c5(BASKET_TOKEN_KEY),_f8876e7(i),_f4cbe38(),!0}}return _f2b1270("Basket feature is not available for "+e+". Try Again later!","error"),!1}function _fe76c48(e){isExecuteBlocked=!1,isBasketWindowOpen=e,_f4cbe38(),basketWindowContainer.style.display=e?"block":"none"}function _f4cbe38(){messageElement.innerText="BY KITEPLUS",messageElement.style.setProperty("visibility","collapse")}function _f2b1270(e,t){messageElement.style.setProperty("visibility","visible"),messageElement.classList.toggle("text-red",!1),messageElement.innerText=e,"error"==t&&messageElement.classList.toggle("text-red",!0)}async function _f40b6f9(e){currentSymbolFreezeLimit=_ffd9157(e),basketSearchInput.value=e,basketPriceElement.innerText="",basketChangeElement.innerText="";let t=basketWindowCallCounter-1;for(;isAppActive&&basketWindowStatus[t];){if(null!=headerInstToken){let e=await _f1d31cd(headerInstToken);if(-1!=e&&null!=e){let t=e.last_price.toFixed(2);if(basketPriceElement.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,o=t.toFixed(2);basketPriceElement.classList.toggle("text-green",t>=0),basketPriceElement.classList.toggle("text-red",t<0),basketChangeElement.innerText=o}}}else basketPriceElement.innerText="N/A";await delay(500)}}function _fe17c7f(e,t){let o=t<=0,i=Math.abs(t),a=[];return a.push({baseInst:e,quantity:Math.max(i,e.lot_size),isSell:!o}),a.push({baseInst:e,quantity:Math.max(i,e.lot_size),isSell:o}),a}function _f794449(e){let t=["CE","PE"];0!=(e=e.filter((e=>t.includes(e.baseInst.instrument_type)))).length?(_f339f9a(),_f8876e7(e)):showPlusMessage(document,"not supported for this instrument","error")}async function _f6f8f1a(e){let t=e.map((e=>({baseInst:e.inst,quantity:e.quantity,isSell:e.isSell})));isNRMLBasketOrder=0===e.length||"NRML"===e[0]?.dayOrderType,_f339f9a(),_f8876e7(t)}function _f8481e6(e,t,o){if(!["CE","PE"].includes(e.instrument_type))return;let i=_fe17c7f(e,t);if(isBasketWindowOpen){if(e.name==headerName)return _f9ceac1(i[0].baseInst,i[0].isSell?-i[0].quantity:i[0].quantity),void _f9ceac1(i[1].baseInst,i[1].isSell?-i[1].quantity:i[1].quantity)}else _f22bc1e(0);isNRMLBasketOrder="NRML"==o,_f339f9a(),_f8876e7(i)}function _ffb08c2(){let e=modalBody.querySelectorAll("tbody tr");basketRows.forEach((e=>{e.status=!1,e.buySellElement.removeEventListener("click",e.buySellElementClickHandler),e.quantityElement.removeEventListener("change",e.quantityElementChangeHandler),e.callPutTD.removeEventListener("click",e.callPutTDClickHandler),e.expirySelectElement.removeEventListener("input",e.expirySelectElementInputHandler),e.strikeUpDownObject.plusButton.removeEventListener("mousedown",e.strikeUpDownObject.plusMouseDownEventListener),e.strikeUpDownObject.minusButton.removeEventListener("mousedown",e.strikeUpDownObject.minusMouseDownEventListener),e.quantityUpDownObject.plusButton.removeEventListener("mousedown",e.quantityUpDownObject.plusMouseDownEventListener),e.quantityUpDownObject.minusButton.removeEventListener("mousedown",e.quantityUpDownObject.minusMouseDownEventListener),window.removeEventListener("mouseup",e.strikeUpDownObject.windowMouseUpListener),window.removeEventListener("mouseup",e.quantityUpDownObject.windowMouseUpListener)})),e.forEach((e=>{e.remove()}))}function _fe4a03d(){basketWindowContainer.classList.toggle("noPos",0==basketRows.length)}function _f9ceac1(e,t){return customBasketPositionHandler(e,t)}async function _f8876e7(e){let t=e;if(isExecuteBlocked=!1,_f4cbe38(),_fc2802f(),basketWindowStatus=basketWindowStatus.map((e=>!1)),basketWindowStatus.push(!0),basketWindowCallCounter++,0==t.length){_ffb08c2(),basketRows=[],_fe4a03d();let e=_fda88a8("NIFTY");return _f7d8e25(BASKET_TOKEN_KEY,[e]),headerInstToken=e,headerName="NIFTY",_f40b6f9(headerName),void(firstBasketLeg=defaultNiftyLeg)}firstBasketLeg=t[0],_fe76c48(!0),_ffb08c2(),null!=arrowBtnClickHandler&&addRowBtn.removeEventListener("click",arrowBtnClickHandler),addRowBtn.addEventListener("click",arrowBtnClickHandler=function(){if(0==basketRows.length)return void n(a(),firstBasketLeg.baseInst,firstBasketLeg.quantity,firstBasketLeg.isSell,o++);let e=basketRows[basketRows.length-1];n(a(),e.inst,e.quantity,e.isSell,o++)});let o=0;headerInstToken=void 0;let i=_fda88a8(firstBasketLeg.baseInst.name);function a(){let e=baseRow.cloneNode(!0);return tbody_Basket.appendChild(e),e}_f7d8e25(BASKET_TOKEN_KEY,[i]),headerInstToken=i,mcxMultiplier=1,isMcxBasket=!1,"MCX"==firstBasketLeg.baseInst.exchange&&(mcxMultiplier=_f9b6bef(firstBasketLeg.baseInst.name),isMcxBasket=!0),headerName=firstBasketLeg.baseInst.name,_f40b6f9(headerName),basketRows=[],customBasketPositionHandler=function(e,t){if(null!=e){if(e.name!=headerName){if(0==basketRows.length){let o=[];return o.push({baseInst:e,quantity:Math.abs(t),isSell:t<0}),_f8876e7(o),1}return}return n(a(),e,Math.abs(t),t<0,o++),1}};for(let e=0;e<t.length;e++)n(a(),t[e].baseInst,t[e].quantity,t[e].isSell,o++);function n(e,t,o,i,a){let n=e.querySelector(".posBuySellType"),r=n.querySelector("span"),s=e.querySelector(".posMainSymbol"),l=e.querySelector(".posExpiry select"),c=e.querySelector(".rowStrike span"),u=e.querySelector(".strikeDown"),f=e.querySelector(".strikeUp"),d=e.querySelector(".posCallPutType"),p=e.querySelector(".posCallPutType span"),m=e.querySelector(".rowQuantity input"),_=e.querySelector(".basketQuantityMultiplier"),y=e.querySelector(".quantityDown"),b=e.querySelector(".quantityUp"),g=e.querySelector(".posLTP"),h=e.querySelector(".posBTP"),S=e.querySelector(".posDelta"),T=e.querySelector(".posCheckbox input"),w=e.querySelector(".posCheckbox label");T.id="basketCheckbox."+a,w.htmlFor="basketCheckbox."+a,e.querySelector(".posBidAskDiff");let M=e.querySelector(".posDelete .fa-solid"),k=t,E=t.lot_size,C=0!=o?Math.abs(o):E,P={id:a,isSelected:!0,targetInstToken:k.instrument_token,status:!0,dayOrderType:isNRMLBasketOrder?"NRML":"MIS",inst:k,isCall:!1,ltp:-1,btp:-1,bestBid:-1,bestAsk:-1,orderType:"MARKET",isSell:i,quantity:C,quantityMultiplierElement:_,updateRowMultiplier:function(){isMcxBasket&&(_.innerText=Math.abs(P.quantity)*mcxMultiplier+" Units")}};h.style.display=isShowDelta?"none":"table-cell",S.style.display=isShowDelta?"table-cell":"none",P.isCall="CE"==P.inst.instrument_type,P.buySellElement=n,P.callPutTD=d,P.quantityElement=m,P.quantityMultiplierElement=_,P.expirySelectElement=l;let N=[],O=[],I=[],L=[],R=0,v=_f7086f4(t.name,"OPT"),x=!1,A=getISTTimeStamp();for(let e=0;e<v.length;e++){let t=v[e],o=new Date(t),i="";i=(o.getTime()-A)/864e5<365?o.getDate()+" "+monthConst[o.getMonth()]:monthConst[o.getMonth()]+"-"+o.getFullYear(),l.add(new Option(i,e))}function D(e){I=_f41274d(P.inst.name,e).ceList,O=_f41274d(P.inst.name,e).peList,B(P.inst.instrument_type)}function B(e){N="CE"==e?I:O,L=N.map((e=>e.strike)),U.valueList=L,U.upLimit=L.length,function(){let e=P.inst.strike,t=L.reduce(((t,o)=>Math.abs(o-e)<Math.abs(t-e)?o:t)),o=N[L.indexOf(t)];R=L.findIndex((e=>e===t)),K(o),F()}()}function F(){s.innerText=P.inst.name,p.innerText=P.inst.instrument_type,c.innerText=P.inst.strike,m.value=Math.abs(P.quantity),P.updateRowMultiplier();let e=P.inst.expiry,t=new Date(e);ordinal_suffix_of(t.getDate()),p.classList.toggle("call","CE"==P.inst.instrument_type),p.classList.toggle("put","PE"==P.inst.instrument_type)}async function K(e){P.inst=e,P.targetInstToken=e.instrument_token,P.quantity%P.inst.lot_size!=0&&(P.quantity=parseInt(P.inst.lot_size),m.value=P.quantity,P.updateRowMultiplier()),P.ltp=-1,P.btp=-1,_f7d8e25(BASKET_TOKEN_KEY,[P.inst.instrument_token]),x&&_fc86a51(),isShowDelta&&_fcbd8b5(headerName,P.inst.expiry)}function W(){r.classList.toggle("red",P.isSell),r.classList.toggle("blue",!P.isSell),e.classList.toggle("sellPosRow",P.isSell),e.classList.toggle("buyPosRow",!P.isSell),r.innerText=P.isSell?"SELL":"BUY",x&&_fc86a51()}l.value=v.findIndex((e=>e==t.expiry)),l.addEventListener("input",P.expirySelectElementInputHandler=function(){D(v[l.value])}),T.checked=!0,T.addEventListener("change",P.selectCheckboxEventHandler=function(){P.isSelected=T.checked,e.classList.toggle("disabled",!P.isSelected),x&&_fc86a51()}),d.addEventListener("click",P.callPutTDClickHandler=function(){B("PE"==P.inst.instrument_type?"CE":"PE")}),m.addEventListener("keydown",(e=>{27!=e.keyCode&&13!=e.keyCode||m.blur()})),m.addEventListener("input",(function(){m.value=m.value.replace(/[^0-9, ]/,"")})),m.addEventListener("change",P.quantityElementChangeHandler=function(){P.quantity=Math.round(m.value/P.inst.lot_size)*P.inst.lot_size,P.quantity=Math.max(P.inst.lot_size,P.quantity),m.value=P.quantity,P.updateRowMultiplier(),x&&_fc86a51(),_fa8f570()}),n.addEventListener("click",P.buySellElementClickHandler=function(){P.isSell=!P.isSell,W()});let U={minusButton:u,plusButton:f,textElement:c},G={minusButton:y,plusButton:b,textElement:m};P.strikeUpDownObject=U,P.quantityUpDownObject=G,_f9b2ec3(U,(e=>{if(e)K(N[R]),F();else{let e=R+U.direction;if(e<=0||e>=L.length)return;R=e,c.innerText=L[R]}})),_f9b2ec3(G,(e=>{if(e)_fc86a51();else{let e=P.quantity+P.inst.lot_size*G.direction;if(e<=0)return;P.quantity=e,P.updateRowMultiplier(),m.value=e,_fa8f570()}})),M.addEventListener("click",P.deleteBtnClickHandler=function(){P.status=!1,window.removeEventListener("mouseup",U.windowMouseUpListener),window.removeEventListener("mouseup",G.windowMouseUpListener),n.removeEventListener("click",P.buySellElementClickHandler),m.removeEventListener("change",P.quantityElementChangeHandler),d.removeEventListener("click",P.callPutTDClickHandler),M.removeEventListener("click",P.deleteBtnClickHandler),l.removeEventListener("input",P.expirySelectElementInputHandler),U.plusButton.removeEventListener("mousedown",U.plusMouseDownEventListener),U.minusButton.removeEventListener("mousedown",U.minusMouseDownEventListener),G.plusButton.removeEventListener("mousedown",G.plusMouseDownEventListener),G.minusButton.removeEventListener("mousedown",G.minusMouseDownEventListener),e.remove(),basketRows=basketRows.filter((e=>e.id!=P.id)),_fe4a03d(),_fc86a51(),_fa8f570()}),D(t.expiry),F(),W(),async function(e){for(;e.status;){let t=-1,o=0,i=await _f1d31cd(e.targetInstToken);if(-1!=i){{if(t=i.last_price,e.ltp=t,isShowDelta){let t=await _f8de329(headerName,e.inst.expiry);if(-1!=t&&-1!=t.price){let i=t.price,a=parseFloat(e.inst.strike),n=t.yearDiff,r=.07365;r=riskFreeInterest,o=_fa83168("CE"==e.inst.instrument_type,i,a,n,r,e.ltp),S.innerText=null==o?"N/A":o.toFixed(2)}else S.innerText="N/A"}const a=i.depth;if(a&&a.buy?.length&&a.sell?.length&&null!=a.buy[0]?.price&&null!=a.sell[0]?.price){const t=a.buy[0].price,o=a.sell[0].price;e.bestBid=t,e.bestAsk=o,e.btp=e.isSell?t:o}}g.innerText=-1!=t?e.ltp.toFixed(2):"NA",h.innerText=-1!=e.btp?e.btp.toFixed(2):"NA",await delay(400)}else e.btp=-1,e.ltp=-1,e.bestBid=-1,e.bestAsk=-1,g.innerText="NA",h.innerText="NA",await delay(10)}}(P),R=L.findIndex((e=>e===t.strike)),basketRows.push(P),x=!0,_fc86a51(),_fa8f570(),_fe4a03d()}}let _basketMarginBufferCounter=0;async function _fc86a51(){_f4cbe38(),clearTimeout(basketUpdaterTimeout),basketUpdaterTimeout=setTimeout((()=>{_f53f602(),_f54e76f()}),250)}async function _f5e168b(){currentSplitBasket=[];let e=basketRows.filter((e=>1==e.isSelected)).reduce(((e,t)=>{let o=!1;for(let i=0;i<e.length;i++){let a=e[i];if(a.inst.tradingsymbol===t.inst.tradingsymbol&&a.inst.expiry===t.inst.expiry&&a.inst.strike===t.inst.strike&&a.inst.instrument_type===t.inst.instrument_type){o=!0,a.isSell?a.quantity+=t.isSell?t.quantity:-t.quantity:a.quantity+=t.isSell?-t.quantity:t.quantity,a.quantity<0&&(a.isSell=!a.isSell,a.quantity=Math.abs(a.quantity));break}}return o||e.push(JSON.parse(JSON.stringify(t))),e}),[]);if(e=e.filter((e=>0!=e.quantity)),e=e.sort(((e,t)=>e.isSell===t.isSell?0:e.isSell?1:-1)),null!=currentSymbolFreezeLimit)for(let t=0;t<e.length;t++){let o=e[t],i=currentSymbolFreezeLimit,a=Math.abs(o.quantity);if(a>i){let e=o.inst.lot_size,t=Math.floor(a/e),n=Math.ceil(a/i),r=distributeNumber(t,n);for(let t=0;t<r.length;t++){let i=JSON.parse(JSON.stringify(o));i.quantity=r[t]*e,currentSplitBasket.push(i)}}else currentSplitBasket.push(o)}else currentSplitBasket=e}let globalUsedMargin,globalTotalMargin,globalAvailableMargin,basketNudgeCounter=0;async function _f54e76f(){}async function _f53f602(){let e,t=[];for(let e=0;e<basketRows.length;e++){const o=basketRows[e];if(o.isSelected){for(;-1==o.ltp;)await delay(10);if(CURRENT_BROKER==KOTAK_BROKER){let e=_fe798c9(o,isNRMLBasketOrder);t.push(e)}else if(CURRENT_BROKER==JAINAM_BROKER){let e=_fe798c9(o,isNRMLBasketOrder);t.push(e)}else t.push({exchange:o.inst.exchange,order_type:"LIMIT",price:o.ltp,product:"NRML",quantity:Math.abs(o.quantity),tradingsymbol:o.inst.tradingsymbol,transaction_type:o.isSell?"SELL":"BUY",variety:"regular"})}}if(CURRENT_BROKER==KOTAK_BROKER){let o=t.reduce(((e,t)=>{let o=!1;for(let i=0;i<e.length;i++)e[i].exgIdentifier===t.exgIdentifier&&e[i].productType===t.productType&&(o=!0,e[i].qty+=t.qty);return o||e.push(JSON.parse(JSON.stringify(t))),e}),[]);o=o.filter((e=>0!=e.qty)),e=await _fa04073(o,!0)}else e=CURRENT_BROKER==JAINAM_BROKER?await _fa04073(t,!0):await kite_getBasketMargin(JSON.stringify(t));if(-1!=e&&null!=globalAvailableMargin){let t=e.final.total,o=globalAvailableMargin-t;CURRENT_BROKER==KOTAK_BROKER&&(t=e.final.total-globalUsedMargin,o=globalAvailableMargin-t),remainingMarginElement.classList.toggle("text-green",o>0),remainingMarginElement.classList.toggle("text-red",o<0),additionalMarginElement.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),remainingMarginElement.innerText=o.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0})}else additionalMarginElement.innerText="N/A",remainingMarginElement.innerText="N/A"}async function _f4c29eb(e){let t=-1;for(;isAppActive;){t=0;for(let e=0;e<basketRows.length;e++){const o=basketRows[e];if(!o.isSelected)continue;if(-1==o.ltp){t=void 0;break}let i=o.isSell?-o.quantity:o.quantity,a=-i*o.ltp*mcxMultiplier;(isTradingHours||-1!=o.btp)&&(a=-i*o.btp*mcxMultiplier),t+=a}null==t?(e.classList.toggle("text-green",!1),e.classList.toggle("text-red",!1),e.innerText="N/A"):(e.classList.toggle("text-green",t>0),e.classList.toggle("text-red",t<0),e.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})),await delay(400)}}function _f9b2ec3(e,t){let o=!1,i=!1,a=[],n=[],r=0,s=0;function l(o){e.direction=o,t(!1)}e.minusButton.addEventListener("mousedown",e.plusMouseDownEventListener=async function(){a.push(!0),l(-1),o=!0;let e=r;for(await delay(400);a[e]&&isAppActive;)l(-1),await delay(50)}),window.addEventListener("mouseup",e.windowMouseUpListener=function(){o&&(a[r]=!1,t(!0),r++,o=!1),i&&(n[s]=!1,t(!0),s++,i=!1)}),e.plusButton.addEventListener("mousedown",e.minusMouseDownEventListener=async function(){n.push(!0);let e=s;for(i=!0,l(1),await delay(400);n[e]&&isAppActive;)l(1),await delay(50)})}async function _f271ae9(){if(!isPrem)return;let e={statusCode:"success",type:"normal",message:"Error "};if(await _f5e168b(),0==currentSplitBasket.length)return e.status="error",e.type="fetch",e.message="Net quantity is zero. No order to execute!",e;for(let t=0;t<currentSplitBasket.length;t++){let o=currentSplitBasket[t],i=!1,a=o.ltp,n=o.ltp;o.isSell?n=getSimpleProtectedSellPrice(-1!=o.bestBid?o.bestBid:n):a=getSimpleProtectedBuyPrice(-1!=o.bestAsk?o.bestAsk:a);let r=o.isSell?n:a;if(r=(Math.ceil(20*r)/20).toFixed(2),0==o.quantity)continue;let s={variety:"regular",multiplier:mcxMultiplier,inst:o.inst,exchange:o.inst.exchange,tradingsymbol:o.inst.tradingsymbol,transaction_type:o.isSell?"SELL":"BUY",order_type:i?"LIMIT":"MARKET",quantity:Math.abs(o.quantity),price:r,product:o.dayOrderType,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID};await orderLimiter.acquire();let l=await _fd25cf4(s);if(200!=l.statusCode)return e.status="error",e.message=l.message,e;await delay(o.isSell?SELL_LEG_WAIT:BUY_LEG_WAIT)}return e}let statusBarPNL,statusBarDaysHistory,statusBarNetPNL,statusBarProjected,statusBarNetValue,globalTotalCharges=0;async function _f3a5264(){for(await delay(500);isAppActive;)document.title="P&L: "+globalPNL.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})+" / "+APP_NAME,await delay(1e3)}let statusBarPLObserver,globalPNL=0,isDayHistoryVisibleIndex=0,isMTMInit=!1;async function _fdbff49(e,t){if(globalPNL=e,!isMTMInit){let r=document.querySelector("#dayMTMParent"),s=document.querySelector("#netPNLParent"),l=document.querySelector("#netProjectedParent"),c=document.querySelector("#netValueParent");async function o(){await setSyncStorage("isDayHistoryVisibleIndex",isDayHistoryVisibleIndex)}function i(){r.style.display=0==isDayHistoryVisibleIndex?"block":"none",s.style.display=1==isDayHistoryVisibleIndex?"block":"none",c.style.display=2==isDayHistoryVisibleIndex?"block":"none",l.style.display=3==isDayHistoryVisibleIndex?"block":"none"}r.addEventListener("click",(function(){isDayHistoryVisibleIndex=1,i(),o()})),s.addEventListener("click",(async function(){isDayHistoryVisibleIndex=2,i(),o()})),c.addEventListener("click",(async function(){isDayHistoryVisibleIndex=3,i(),o()})),l.addEventListener("click",(async function(){isDayHistoryVisibleIndex=0,i(),o()})),i(),statusBarPNL=document.querySelector("#MTM"),statusBarPNL.innerText="N/A",statusBarNetPNL=document.querySelector("#netMTM"),statusBarNetPNL.innerText="N/A",statusBarProjected=document.querySelector("#netProjected"),statusBarProjected.innerText="N/A",statusBarDaysHistory=document.querySelector("#dayMTM"),statusBarDaysHistory.innerText="N/A",statusBarNetValue=document.querySelector("#netValue"),statusBarNetValue.innerText="N/A",isMTMInit=!0,null!=statusBarPLObserver&&statusBarPLObserver.disconnect(),statusBarPLObserver=new MutationObserver((function(){_fb56bc7()})),statusBarPLObserver.observe(statusBarPNL,{subtree:!0,childList:!0,characterData:!0})}globalTotalCharges=-1!=currentCharges?currentCharges:0;let a=e-globalTotalCharges,n=currentTotalProjected-globalTotalCharges;statusBarPNL.classList.toggle("text-Positive",e>0),statusBarPNL.classList.toggle("text-Negative",e<=0),statusBarPNL.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),statusBarNetPNL.classList.toggle("text-Positive",a>0),statusBarNetPNL.classList.toggle("text-Negative",a<=0),statusBarNetPNL.innerText=a.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),statusBarProjected.classList.toggle("text-Positive",n>0),statusBarProjected.classList.toggle("text-Negative",n<=0),statusBarProjected.innerText=n.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),statusBarDaysHistory.classList.toggle("text-Positive",t>0),statusBarDaysHistory.classList.toggle("text-Negative",t<=0),statusBarDaysHistory.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),statusBarNetValue.classList.toggle("text-Positive",TotalNetValue>0),statusBarNetValue.classList.toggle("text-Negative",TotalNetValue<=0),statusBarNetValue.innerText=TotalNetValue.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})}async function _f48007a(){_f3a5264();let e=document.querySelector("#usedMargin"),t=document.querySelector("#availMargin"),o=document.querySelector("#totalMargin"),i=document.querySelector("#availCash");document.querySelector("#equityCommoditySwitch"),isPrem?(e.innerText="N/A",t.innerText="N/A",o.innerText="N/A",i.innerText="N/A"):(e.innerHTML=lockFrame,t.innerHTML=lockFrame,o.innerHTML=lockFrame,i.innerHTML=lockFrame);let a=0,n=(new Date).getTime();async function r(){let r=await _f209348();if(-1==r)return void(a=50);n=(new Date).getTime();let s=0,l=0,c=0;globalUsedMargin=parseFloat(r.MarginUsed),globalAvailableMargin=parseFloat(r.Net),isCommodity||(s=parseFloat(r.MarginUsed),c=parseFloat(r.Net),l=parseFloat(r.Net));let u=s+c;globalTotalMargin=u,isPrem&&(o.innerText=u.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),e.innerText=s.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),t.innerText=c.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),i.innerText=l.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),t.classList.toggle("text-Positive",c>0),t.classList.toggle("text-Negative",c<=0))}!async function(){for(;isAppActive;)a=((new Date).getTime()-n)/1e3,a>60&&isTradingHours&&(r(),n=(new Date).getTime()),await delay(2e3)}(),r(),document.addEventListener("kc_MarginSetUpdate",(function(){r()}))}async function _fad1dcd(){if(CURRENT_BROKER==KOTAK_BROKER||CURRENT_BROKER==JAINAM_BROKER){let e=document.querySelector("#totalCharges");if(!isPrem)return void(e.innerHTML=lockFrame);for(;isAppActive;)e.innerText=-1!=currentCharges?currentCharges.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}):"N/A",await delay(1500)}}function _f44c586(){let e="#22222227",t="#8c8c8c",o="#B1C8CC",i="#0E5EFF",a="#242424",n="#181818",r="#444";return"default"!==document.documentElement.getAttribute("data-theme")||(e="#F9F9F9",t="#181818",a="#CBCBCB",n="#CBCBCB","#808080"),{height:300,width:0,autoSize:!0,localization:{timeFormatter:e=>e.toString(),priceFormatter:rupeePriceFormatter},crosshair:{mode:1,vertLine:{width:1,color:o,labelBackgroundColor:o,labelVisible:!1},horzLine:{color:i,labelBackgroundColor:i,visible:!1,labelVisible:!1}},layout:{background:{color:e},textColor:t,fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},grid:{vertLines:{color:a,style:2},horzLines:{color:n,style:2}},timeScale:{timeVisible:!0,fixLeftEdge:!0,tickMarkFormatter:e=>e.toString(),borderColor:"#444",timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:"#444",mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:0}},handleScroll:!1,handleScale:!1,axisPressedMouseMove:!1}}function _f7633f1(){return{priceLineVisible:!1,lineType:0,topFillColor1:"rgba(69, 207, 112, 0.2)",topFillColor2:"rgba(69, 207, 112, 0.05)",topLineColor:"rgba(69, 207, 112, 1)",lastValueVisible:!1,crosshairMarkerVisible:!0,axisLabelVisible:!1,title:""}}function _f2898b7(e){try{return!e.time}catch{}return!1}function _fd27b03(e){try{if(void 0===e.point||!e.time||e.point.x<0||e.point.x>chartDiv.clientWidth||e.point.y<0||e.point.y>chartDiv.clientHeight)return!0}catch{}return!1}let chartDiv,chartRootParent,straddleIVChartObject,isTestMTMTicks=!1,isTestTimeData=!1,chartDataKeyName="",isChartInit=!1,isMTMSpotEnabled=!1,isMTMChartReady=!1,isCustomDeployedMarginFeature=!1,customDeployedMarginAmount=0,currentMtmChartTimeFrame=1;async function _f0e1052(){isChartInit=!0;let e=document.querySelector(".centerContainer");if(null==e)return;chartRootParent=document.createElement("div"),chartRootParent.id="chartRootParent",chartRootParent.classList.toggle("hiddenChart",!0);let t=_f36e004("chartButtons");chartRootParent.innerHTML=t;const o=document.getElementById("chartRootParentIndexMeta");if(o)o.insertAdjacentElement("afterend",chartRootParent);else{let e=document.querySelector(".centerContainer");e.insertBefore(chartRootParent,e.firstChild)}chartDiv=e.querySelector("#lightWeightChartParent"),chartDataKeyName="mtmChartDataKey",currentMtmChartTimeFrame=await _fb3ac9d("currentMtmChartTimeFrame",currentMtmChartTimeFrame),isMTMSpotEnabled=await _fb3ac9d("isMTMSpotEnabled",isMTMSpotEnabled),isCustomDeployedMarginFeature=await _fb3ac9d("prefCustomROIAmountKey",isCustomDeployedMarginFeature),customDeployedMarginAmount=await _fb3ac9d("setting_roiMarginAmount",customDeployedMarginAmount),chartRootParent.querySelector(".kitePlusWaterMark").innerText=APP_NAME,_ff92133()}async function _f55aa32(){if(isChartInit=!0,rightContainer=document.querySelector(".container-right"),null==rightContainer)return;chartRootParent=document.createElement("div"),chartRootParent.id="chartRootParent";let e=_f36e004("chartButtons");for(chartRootParent.innerHTML=e,rightContainer.insertBefore(chartRootParent,rightContainer.firstChild),chartDiv=rightContainer.querySelector("#lightWeightChartParent");0==userID.length&&isAppActive;)await delay(10);chartDataKeyName="mtmChartDataKey",chartDataKeyName+=userID,isMTMSpotEnabled=await _fb3ac9d("isMTMSpotEnabled",isMTMSpotEnabled),isCustomDeployedMarginFeature=await _fb3ac9d("prefCustomROIAmountKey",isCustomDeployedMarginFeature),customDeployedMarginAmount=await _fb3ac9d("setting_roiMarginAmount",customDeployedMarginAmount),_ff92133()}async function _fa1a722(e){let t=document.querySelector("#chartRootParent");instanceCounter<50&&t.classList.toggle("earlyUser",!0)}async function _ff92133(){let e="#342700",t="#2e2e2eff",o="#444",i=0;const a={height:400,width:0,autoSize:!0,crosshair:{mode:0,vertLine:{labelVisible:!1,width:1,color:"#3D4447",labelBackgroundColor:"#3D4447"},horzLine:{labelVisible:!1,color:"#3D4447",labelBackgroundColor:"#3D4447"}},layout:{background:{color:"#18181800"},textColor:"#D3D3D3",fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},grid:{vertLines:{color:"#242424",style:2},horzLines:{color:"#242424",style:2}},rightPriceScale:{borderColor:o,mode:0,textColor:"#868686f5",visible:!0,autoScale:!0,scaleMargins:{top:.08,bottom:.08}},leftPriceScale:{visible:!0,textColor:"#8d8d8d73",borderColor:o,mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:.08}},handleScroll:!0,handleScale:!0,axisPressedMouseMove:!0};if(!isPrem)return;const n=LightweightCharts.createChart(chartDiv,a),r=n.panes()[0];let s="KitePlus For Zerodha",l=LightweightCharts.createTextWatermark(r,{horzAlign:"center",vertAlign:"bottom",lines:[{text:s,fontFamily:'"Open Sans", sans-serif',fontSize:32,fontStyle:"bolder",color:t}]});function c(e){l.applyOptions({lines:[{text:e?s:"",fontFamily:'"Open Sans", sans-serif',fontSize:32,fontStyle:"bolder",color:t}]})}c(!1),new ResizeObserver((e=>{n.timeScale().fitContent()})).observe(chartDiv),n.timeScale().applyOptions({borderColor:o,timeVisible:!0,secondsVisible:!1});const u=n.addSeries(LightweightCharts.LineSeries,{priceScaleId:"left",priceLineVisible:!0,lineType:0,lineStyle:1,lastValueVisible:!0,crosshairMarkerVisible:!1,lineColor:e,lineWidth:2,axisLabelVisible:!0,title:"Spot",color:"#1280d7",priceFormat:{type:"price",precision:0,minMove:1}}),f=n.addSeries(LightweightCharts.BaselineSeries,{priceLineVisible:!1,lineType:0,lastValueVisible:!1,crosshairMarkerVisible:!1,lineColor:e,lineWidth:2,axisLabelVisible:!1,title:""});!async function(){await delay(800),f.applyOptions({priceFormat:{type:"custom",formatter:A}})}();const d=n.addSeries(LightweightCharts.CandlestickSeries,{priceLineVisible:!1,lastValueVisible:!1,visible:!1,priceLineColor:"#FFCD00"});let p,m="NIFTY",_={name:m},y=document.querySelector("#chartRootParent .chartIndexMetaFooterParent"),b=document.querySelector("#chartRootParent .mtmSpotSelector"),g=document.querySelector("#chartControlSet");function h(e,t=5){const o=60*t,i=[];let a=null;return e.forEach((e=>{const t=Math.floor(e.time/o)*o;a&&a.time===t||a&&i.push(a),a={...e,time:t}})),a&&i.push(a),i}!function(e,t,o,i){let a=document.createElement("div");a.classList.add("metaChartTooltipStyle"),a.classList.add("mtmChartTooltipStyle"),e.appendChild(a);let n=_f36e004("mtmChartTooltip");t.subscribeCrosshairMove((function(t){if(isMTMSpotEnabled)if(_f2898b7(t))a.style.display="none";else{a.style.display="block";const r=t.seriesData.get(o),s=t.seriesData.get(u);if(null==r)return;const l=void 0!==r.value?r.value:r.close;let c="N/A";null!=s&&(c=void 0!==s.value?s.value:s.close);let f=A(l),d=n.replace("$indexName",i.name);d=d.replace("$time",getFormattedTimeForChart(t.time)),d=d.replace("$mtmValue",f),d=d.replace("$spotPrice",c),a.classList.toggle("positiveTooltip",l>=0),a.classList.toggle("negativeTooltip",l<0),a.innerHTML=d;const p=o.priceToCoordinate(l);let m=t.point.x-80;if(null===p)return;m=Math.max(0,Math.min(e.clientWidth-80,m));const _=Math.max(0,Math.min(e.clientHeight-80-30,p+30));a.style.left=m+"px",a.style.top=_+"px"}}))}(chartDiv,n,f,_),async function(){for(;!isChartIndexMetaObjectLoaded&&prefATMChartFeatures.key;)await delay(10);m=await _fb3ac9d("activeSpotSymbol",m),_.name=m;let e=document.querySelector("#chartSpotCheckbox");e.checked=isMTMSpotEnabled,b.style.display=isMTMSpotEnabled?"block":"none",g.classList.toggle("hasSelector",isMTMSpotEnabled);let t=!1;t=await _fb3ac9d("mtmChartExpandStatus",t),e.addEventListener("change",(async function(){isMTMSpotEnabled=e.checked,g.classList.toggle("hasSelector",isMTMSpotEnabled),b.style.display=isMTMSpotEnabled?"block":"none",l(m),W(),await setSyncStorage("isMTMSpotEnabled",e.checked)}));let o=document.querySelector("#chartRootParent #mtmChartZoomOut"),i=document.querySelector("#chartRootParent #mtmChartZoomIn"),a=document.querySelector("#chartRootParent #mtmChartResetButton");async function r(){await setSyncStorage("mtmChartExpandStatus",t),chartRootParent.classList.toggle("hiddenChart",!t)}o.addEventListener("click",(function(){let e=n.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to+.1*t,e.from=e.from-.1*t,n.timeScale().setVisibleLogicalRange(e)})),i.addEventListener("click",(function(){let e=n.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to-.1*t,e.from=e.from+.1*t,n.timeScale().setVisibleLogicalRange(e)})),a.addEventListener("click",(function(){n.timeScale().fitContent(),n.priceScale("left").setAutoScale(!0),n.priceScale("right").setAutoScale(!0)})),chartRootParent.querySelector("#chartCloseButton").addEventListener("click",(function(e){e.stopPropagation(),t=!1,r(),e.preventDefault()})),chartRootParent.querySelector(".chartControlDiv").addEventListener("click",(function(){t||(t=!0,r())})),chartRootParent.querySelector(".chartShowButton").addEventListener("click",(function(e){t||(t=!0,r())})),r(),await delay(10);for(let e=0;e<ivExpirySymbolList.length;e++){const t=ivExpirySymbolList[e].foName;b.add(new Option(t,e)),null==chartIndexMetaObject[t]&&(chartIndexMetaObject[t]=[])}ivExpirySymbolList.length>0&&(isMTMSpotEnabled?(null==ivExpirySymbolList.find((e=>e.foName==m))&&(m=ivExpirySymbolList[0].foName),b.value=ivExpirySymbolList.findIndex((e=>m==e.foName)),l(m),_.name=m):l(m)),b.addEventListener("input",(function(){m!=b.value&&""!=b.value&&l(ivExpirySymbolList.find((e=>e.foName==ivExpirySymbolList[b.value].foName)).foName)}));let s=document.querySelector("#chartRootParent .mtmChartTimeFrameSelect");async function l(e){m=e,_.name=m,await setSyncStorage("activeSpotSymbol",m);let t=u.options();if(t.lineVisible=isMTMSpotEnabled,t.lastValueVisible=isMTMSpotEnabled,t.title=isMTMSpotEnabled?e:"",u.applyOptions(t),n.applyOptions({leftPriceScale:{visible:isMTMSpotEnabled}}),!isMTMSpotEnabled)return void u.setData([]);let o=Object.keys(chartIndexMetaObject);for(let e=0;e<o.length;e++){let t=o[e];if(t==m){let e=[],o=h(chartIndexMetaObject[t],currentMtmChartTimeFrame);if(o.length>0)for(let t=0;t<o.length;t++){const i=o[t];if(i.straddlePrice>0){const t=null!==i.spotPrice&&void 0!==i.spotPrice&&!isNaN(i.spotPrice)&&i.spotPrice>=0?i.spotPrice:0;0!==t&&e.push({value:t,time:i.time})}t==o.length-1&&_fc1dd91(currentStraddleLine,i.straddlePrice)}u.setData(e)}}}s.value=currentMtmChartTimeFrame,s.addEventListener("input",(async function(){currentMtmChartTimeFrame=s.value,k(),await l(m),await setSyncStorage("currentMtmChartTimeFrame",currentMtmChartTimeFrame)})),l(m),await delay(100),n.applyOptions({rightPriceScale:{visible:!0}}),await delay(2)}();let S=[],T=await fetchSyncStorage(chartDataKeyName);if(isTestTimeData&&(T=await getTestChartData()),null!=T){let e=getISTTimeStamp(),t=new Date(e);t.setUTCHours(8,15,0),T.sort((function(e,t){return e.time-t.time}));let o=e/1e3,i=Math.floor(t.getTime()/1e3);p=o>i?1e3*(i+86400):1e3*i;for(let e=0;e<T.length;e++){let t=!0;const a=T[e];void 0!==a.time&&void 0!==a.open&&void 0!==a.high&&void 0!==a.low&&void 0!==a.close&&(o>i&&a.time<i&&(t=!1),a.time+86400<i&&(t=!1),t&&S.push({close:a.close,low:a.low,high:a.high,open:a.open,time:a.time}))}if(!isTestTimeData)try{await setSyncStorage(chartDataKeyName,S)}catch(e){}}let w=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY;function k(){let e=[],t=function(e,t=5){const o=60*t,i=[];let a=null;return e.forEach((e=>{const t=Math.floor(e.time/o)*o;a&&a.time===t?(a.high=Math.max(a.high,e.high),a.low=Math.min(a.low,e.low),a.close=e.close):(a&&i.push(a),a={time:t,open:e.open,high:e.high,low:e.low,close:e.close})})),a&&i.push(a),i}(S,currentMtmChartTimeFrame);d.setData(t);for(let o=0;o<t.length;o++){const i=t[o];e.push({time:i.time,value:i.close})}f.setData(e)}if(null!=T&&S.length>0){k();let e=S.reduce((function(e,t){return e&&e.high>t.high?e:t}));M=e.high;let t=S.reduce((function(e,t){return e&&e.low<t.low?e:t}));w=t.low}let E=document.querySelector("#MTM");f.createPriceLine({price:0,color:e,lineWidth:1,lineStyle:2,axisLabelVisible:!0,title:""});let C=f.createPriceLine({price:w,color:"#79240A",lineWidth:2,lineStyle:1,axisLabelVisible:!0,title:"Low"});const P=f.createPriceLine({price:0,color:"#612B19",lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:"MTM"});let N,O,I=f.createPriceLine({price:M,color:"#3B8A68",lineWidth:2,lineStyle:1,axisLabelVisible:!0,title:"High"}),L=document.querySelector("#chartSave");document.querySelector("#chartSaveCSV").addEventListener("click",(function(){if(0==j.length)return void showPlusMessage(document,"There is no chart data","info");let e=new Date,t=e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate()+"_"+e.getHours()+"_"+e.getMinutes(),o="data:text/csv;charset=utf-8,";o+="Time,Low,High,Open,Close,\r\n",j.forEach((function(e){let t=new Date(1e3*e.time),i=getFullDateForExcel(t)+","+e.low+","+e.high+","+e.open+","+e.close+",";o+=i+"\r\n"}));let i=encodeURI(o),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download",t+".csv"),a.click()})),L.addEventListener("click",(async function(){let e=new Date,t=e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate()+"_"+e.getHours()+"_"+e.getMinutes();c(!0);let o=n.takeScreenshot();c(!1);let i=document.createElement("a");i.setAttribute("download",t+".jpg"),i.setAttribute("href",o.toDataURL("image/jpeg",.95)),i.click()})),document.querySelector("#roiMarginAmountParent").style.display=isCustomDeployedMarginFeature?"flex":"none";let R=document.querySelector("#roiMarginAmount");customDeployedMarginAmount=await _fb3ac9d("roiMarginAmountKey",0);let v=0;R.value=customDeployedMarginAmount,R.addEventListener("focus",(function(e){v=R.value,0==R.value&&(R.value="")})),R.addEventListener("keydown",(function(e){"Enter"===e.key&&this.blur(),"Escape"===e.key&&(R.value=v,this.blur())})),R.addEventListener("change",(async function(e){const t=e.target.value.trim();isNaN(t)||""==t?R.value=0:R.value=Math.abs(t),customDeployedMarginAmount=R.value,D(),await setSyncStorage("roiMarginAmountKey",R.value)}));let x=document.querySelector("#chartROICheckbox");function A(e){if(isMTMChartReady){if(x.checked){let o=i;return isCustomDeployedMarginFeature&&0!=customDeployedMarginAmount&&(o=customDeployedMarginAmount),0!=o?(e/o*100).toFixed(2)+"%":t(e)+" (N/A %)"}return t(e)}function t(e){const t=Math.abs(e);let o="";return t>=1e7?o=(e/1e7).toFixed(2)+"Cr":t>=1e5?o=(e/1e5).toFixed(2)+"L":(o=t.toLocaleString("en-IN",{style:"currency",maximumSignificantDigits:4,currency:"INR"}),e<0&&(o="-"+o)),o}}async function D(){let e=n.options();n.applyOptions(e)}N=await fetchSyncStorage("prefChartROICheckboxKey"),O=!1,null!=N&&null!=N&&(O=N),x.checked=O,x.addEventListener("change",(async function(){D(),await setSyncStorage("prefChartROICheckboxKey",x.checked)})),async function(){let e,t=!1;for(;!t&&isAppActive;)e=document.querySelector("#totalMargin"),null!=e&&(isNaN(parseFloat(e.innerText.replaceAll(",","")))||(t=!0)),await delay(100);i=parseFloat(e.innerText.replaceAll(",","")),D()}(),D();let B=document.querySelector("#chartHighLowCheckbox");N=await fetchSyncStorage("prefChartHighLowCheckboxKey"),O=!0,null!=N&&null!=N&&(O=N),B.checked=O,B.addEventListener("change",(async function(){W(),await setSyncStorage("prefChartHighLowCheckboxKey",B.checked)}));let F=document.querySelector("#chartCandleCheckbox");N=await fetchSyncStorage("prefChartCandleCheckboxKey"),O=!0,null!=N&&null!=N&&(O=N),F.checked=O,F.addEventListener("change",(async function(){W(),await setSyncStorage("prefChartCandleCheckboxKey",F.checked)}));let K=document.querySelector("#chartLinesCheckbox");async function W(){let e=document.querySelector("#chartCandleCheckbox"),t=document.querySelector("#chartLinesCheckbox"),o=document.querySelector("#chartHighLowCheckbox");n.applyOptions({crosshair:{mode:isMTMSpotEnabled?1:0,vertLine:{labelVisible:!isMTMSpotEnabled},horzLine:{labelVisible:!isMTMSpotEnabled}}}),d.applyOptions({visible:e.checked}),u.applyOptions({crosshairMarkerVisible:isMTMSpotEnabled}),f.applyOptions({lineVisible:t.checked,crosshairMarkerVisible:isMTMSpotEnabled}),C.applyOptions({lineVisible:o.checked,axisLabelVisible:o.checked}),I.applyOptions({lineVisible:o.checked,axisLabelVisible:o.checked})}N=await fetchSyncStorage("prefChartLinesCheckboxKey"),O=!0,null!=N&&null!=N&&(O=N),K.checked=O,K.addEventListener("change",(async function(){W(),await setSyncStorage("prefChartLinesCheckboxKey",K.checked)})),W(),document.querySelector("#chartMaxButton").addEventListener("click",(function(){document.querySelector("#chartRootParent").classList.toggle("fullView",!0)}));let U=document.querySelector("#chartMinButton"),G=document.querySelector("#chartRootParent");U.addEventListener("click",(function(){G.classList.toggle("fullView",!1)})),isMTMChartReady=!0;let j=S;!async function(){await delay(30);let e,t=0==S.length,o=0,i=0,a=0,n=!1,r=Math.floor(getISTTimeStamp()/6e4);a=r;let s=S.length>0;for(S.length>0&&(e=S[S.length-1],o=e.close,r==e.time/60&&(n=!0));isAppActive;){let r={high:0,low:0,open:0,close:0,time:0};r.low=Number.POSITIVE_INFINITY,r.high=Number.NEGATIVE_INFINITY,r.open=i,r.close=i,s&&(n?(r.open=e.open,r.close=e.close,r.high=e.high,r.low=e.low,n=!1):r.open=e.close,s=!1);let l=-1;for(;isAppActive;){let e=!0,n=getISTTimeStamp(),s=new Date(n);if(n>p)return void _f6a974b();let c=60*s.getUTCHours()+s.getUTCMinutes();(c<540||c>930)&&(e=!1);let _=Math.floor(n/6e4);if(_!=a){a=_;break}let b=E.innerText,g=parseFloat(b.replaceAll(",","")),h=!1;if(null==g||isNaN(g)){if(!e){await delay(1e3);continue}}else h=!0,isTestMTMTicks||(i=g),isTestMTMTicks&&(i+=817*(2*Math.random()-1)),t&&(r.open=i,t=!1);if(e||o!=i||(h=!1),o=i,P.applyOptions({price:i,color:i<0?"rgba(239, 83, 80, 1)":"rgba(38, 166, 154, 1)"}),isChartIndexMetaObjectLoaded&&u&&isMTMSpotEnabled){const e=60*_,t=chartIndexMetaObject[m].find((t=>t.time===e));if(t){const e=60*currentMtmChartTimeFrame;let o=Math.floor(t.time/e)*e;u.update({time:o,value:Math.max(t.spotPrice,0)})}}if(h){r.close=i,i<r.low&&(r.low=i),i>r.high&&(r.high=i),i>M&&(I.applyOptions({price:i}),M=i),i<w&&(C.applyOptions({price:i}),w=i),r.time=60*_;const e=60*currentMtmChartTimeFrame;let t=Math.floor(r.time/e)*e,o={high:r.high,low:r.low,open:r.open,close:r.close,time:t};if(isTestTimeData){await delay(2500);continue}try{d.update(o),f.update({time:o.time,value:o.close})}catch{}if(-1===l){const e=j.findIndex((e=>e.time===60*_));-1!=e?(l=e,j[l]=r):(j.push(r),l=j.length-1)}else j[l]=r}await delay(500),y.style.display="flex"}V!==a&&(V=a,setSyncStorage(chartDataKeyName,j))}}();let V=null}let straddleLineSeries,ivLineSeries,spotLineSeries,currentStraddleLine,indexMetaSymbolSelector,indexMetaChartRootParent,chartIndexMetaObject={},isChartIndexMetaObjectLoaded=!1,lastIndexMetaCleanTime=0,chartTimeLength=60,ivExpirySymbolList=[],activeIvChartSymbol="NIFTY",isLargerATMLabel=!1,currentAtmChartTimeFrame=1;async function _fb61f35(){indexMetaChartRootParent=document.createElement("div"),indexMetaChartRootParent.classList.toggle("hiddenChart",!0),instanceCounter<50&&indexMetaChartRootParent.classList.toggle("earlyUser",!0),indexMetaChartRootParent.id="chartRootParentIndexMeta"}async function _f2bfe7a(){let e=".container-right";CURRENT_BROKER!=ZERODHA_BROKER&&(e=".centerContainer");let t=await querySelectWait(document,e),o=_f36e004("chartIndexMetaButtons");indexMetaChartRootParent.innerHTML=o,t.insertBefore(indexMetaChartRootParent,t.firstChild);let i=t.querySelector("#lightWeightChartIndexMetaParent");indexMetaSymbolSelector=indexMetaChartRootParent.querySelector(".indexMetaSymbolSelect");let a=indexMetaChartRootParent.querySelector("#indexMetaIvToggle"),n=indexMetaChartRootParent.querySelector("#indexMetaStraddleToggle"),r=indexMetaChartRootParent.querySelector("#indexMetaSpotToggle");isLargerATMLabel=await _fb3ac9d("prefLargerATMLabelKey",isLargerATMLabel),n.checked=await _fb3ac9d("prefIndexMetaChartStraddleChartKey",!0),a.checked=await _fb3ac9d("prefIndexMetaChartIvChartKey",!1),r.checked=await _fb3ac9d("prefIndexMetaChartSpotChartKey",!1),currentAtmChartTimeFrame=await _fb3ac9d("currentAtmChartTimeFrame",currentAtmChartTimeFrame),activeIvChartSymbol=await _fb3ac9d("activeIvChartSymbolKey",!1),a.addEventListener("change",(async function(){h(),await setSyncStorage("prefIndexMetaChartIvChartKey",a.checked)})),n.addEventListener("change",(async function(){h(),await setSyncStorage("prefIndexMetaChartStraddleChartKey",n.checked)})),r.addEventListener("change",(async function(){h(),await setSyncStorage("prefIndexMetaChartSpotChartKey",r.checked)}));let s=!1;s=await _fb3ac9d("indexMetaChartExpandStatus",s),indexMetaChartRootParent.querySelector("#chartIndexMetaCloseButton").addEventListener("click",(function(e){e.stopPropagation(),s=!1,_(),e.preventDefault()})),indexMetaSymbolSelector.addEventListener("input",(async function(){await delay(20),h()}));let l=indexMetaChartRootParent.querySelector("#chartIndexMetaZoomOut"),c=indexMetaChartRootParent.querySelector("#chartIndexMetaZoomIn"),u=indexMetaChartRootParent.querySelector("#chartIndexMetaResetButton"),f=document.querySelector("#chartIndexMetaMaxButton"),d=document.querySelector("#chartIndexMetaMinButton"),p=document.querySelector("#ivSpotLabel"),m=indexMetaChartRootParent.querySelector(".chartIndexMetaFooterParent");async function _(){await setSyncStorage("indexMetaChartExpandStatus",s),indexMetaChartRootParent.classList.toggle("hiddenChart",!s)}f.addEventListener("click",(function(){indexMetaChartRootParent.classList.toggle("fullView",!0)})),d.addEventListener("click",(function(){indexMetaChartRootParent.classList.toggle("fullView",!1)})),l.addEventListener("click",(function(){let e=straddleIVChartObject.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to+.1*t,e.from=e.from-.1*t,straddleIVChartObject.timeScale().setVisibleLogicalRange(e)})),c.addEventListener("click",(function(){let e=straddleIVChartObject.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to-.1*t,e.from=e.from+.1*t,straddleIVChartObject.timeScale().setVisibleLogicalRange(e)})),u.addEventListener("click",(async function(){straddleIVChartObject.timeScale().fitContent(),straddleIVChartObject.priceScale("left").setAutoScale(!0),straddleIVChartObject.priceScale("right").setAutoScale(!0)})),indexMetaChartRootParent.querySelector(".chartControlDiv").addEventListener("click",(function(){s||(s=!0,_())})),indexMetaChartRootParent.querySelector(".chartShowButton").addEventListener("click",(function(e){s||(s=!0,_())})),_(),await delay(10);let y="#342700",b="#444";const g={height:400,width:0,autoSize:!0,crosshair:{mode:1,vertLine:{visible:!0,labelVisible:!0,width:1,color:"#3D4447",labelBackgroundColor:"#3D4447"},horzLine:{visible:!1,labelVisible:!1,color:"#3D4447",labelBackgroundColor:"#3D4447"}},watermark:{color:"#1F1F1F",text:"",visible:!0,fontFamily:'"Open Sans", sans-serif',fontSize:35,fontStyle:"bolder",horzAlign:"center",vertAlign:"bottom"},layout:{background:{color:"#18181800"},textColor:"#D3D3D3",fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},timeScale:{timeVisible:!0,rightOffset:5,borderColor:"#444",shiftVisibleRangeOnNewBar:!0,secondsVisible:!1,localization:{timeFormatter:e=>new Date(1e3*e).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1})}},grid:{vertLines:{color:"#242424",style:2},horzLines:{color:"#242424",style:2,visible:!1}},leftPriceScale:{visible:!0,borderColor:b,mode:0,autoScale:!0,textColor:"#868686f5",scaleMargins:{top:.08,bottom:.08}},rightPriceScale:{borderColor:b,mode:0,autoScale:!0,textColor:"#868686f5",scaleMargins:{top:.08,bottom:.08}},handleScroll:{vertTouchDrag:!1,mouseWheel:!1,pressedMouseMove:!0},handleScale:{mouseWheel:!1,axisPressedMouseMove:!0,axisDoubleClickReset:!0}};async function h(){let e=straddleLineSeries.options(),t="#2b2b2b";e.color=n.checked?"#13dda0":t,e.axisLabelTextColor="#13dda0",straddleLineSeries.applyOptions(e);let o=ivLineSeries.options();o.color=a.checked?"#ddb813":t,o.title=a.checked?"IV":"",o.lineVisible=a.checked,o.lastValueVisible=a.checked;let i=spotLineSeries.options();i.color=r.checked?"#1280d7":t,i.title=r.checked?activeIvChartSymbol:"",i.lastValueVisible=r.checked,a.checked&&!r.checked?(o.priceScaleId="left",i.priceScaleId="leftSpot",p.innerText="ATM IV"):(o.priceScaleId="leftSpot",i.priceScaleId="left",p.innerText=activeIvChartSymbol+" Spot"),spotLineSeries.applyOptions(i),ivLineSeries.applyOptions(o)}isLargerATMLabel&&(g.layout.fontSize=18),straddleIVChartObject=LightweightCharts.createChart(i,g),straddleIVChartObject.timeScale().applyOptions({borderColor:b,timeVisible:!0,secondsVisible:!1}),straddleLineSeries=straddleIVChartObject.addSeries(LightweightCharts.LineSeries,{priceScaleId:"right",priceLineSource:1,priceLineVisible:!1,lineType:0,lastValueVisible:!1,crosshairMarkerVisible:!0,lineColor:y,lineWidth:2,axisLabelVisible:!0,title:"",color:"#13dda0"}),ivLineSeries=straddleIVChartObject.addSeries(LightweightCharts.LineSeries,{priceScaleId:"leftSpot",priceLineVisible:!0,lineType:0,lineStyle:0,lastValueVisible:!0,crosshairMarkerVisible:!0,lineColor:y,lineWidth:2,axisLabelVisible:!1,title:"IV",color:"#ddb813"}),spotLineSeries=straddleIVChartObject.addSeries(LightweightCharts.LineSeries,{priceScaleId:"left",priceLineVisible:!0,lineType:0,lineStyle:1,lastValueVisible:!0,crosshairMarkerVisible:!0,lineColor:y,lineWidth:2,axisLabelVisible:!0,title:"Spot",color:"#dd1390ff",priceFormat:{type:"price",precision:0,minMove:1}}),currentStraddleLine=straddleLineSeries.createPriceLine({price:0,color:"#13dda0",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:""}),new ResizeObserver((e=>{straddleIVChartObject.timeScale().fitContent()})).observe(i),_fadda9f(i,straddleIVChartObject,straddleLineSeries,activeIvChartSymbol),h(),await delay(250),m.style.display="flex"}let ivChartAwaitTimeOut,isIndexChartPlotInit=!1;async function _fbfa9b3(){_fb61f35(),document.addEventListener("kc_OnConfigChange",(function(e){"prefATMChartFeaturesKey"==e.detail.configName&&(e.detail.configValue&&!isIndexChartPlotInit?_f6cc519():0==e.detail.configValue&&isIndexChartPlotInit?indexMetaChartRootParent.classList.toggle("disabledIndexMetaChart",!0):1==e.detail.configValue&&isIndexChartPlotInit&&indexMetaChartRootParent.classList.toggle("disabledIndexMetaChart",!1))})),_f6cc519()}async function _f6cc519(){if(!prefATMChartFeatures.key)return;isIndexChartPlotInit=!0,await _fbe09ae();let e=!1;e=await _fb3ac9d("prefAllIndicesKey",e);let t=e?5:mainUnderlyingCount;for(let e=0;e<Math.min(underlyingMapping.length,t);e++){const t=underlyingMapping[e];let o=_f7086f4(t.FoName);0!=o.length&&(ivExpirySymbolList.push({foName:t.FoName,expiry:o[0]}),_f576391(t.FoName,o[0]),await delay(50))}await _f2bfe7a(),lastIndexMetaCleanTime=await _fb3ac9d("lastIndexMetaCleanTimeKey",lastIndexMetaCleanTime);let o=getISTTimeStamp();if(o>lastIndexMetaCleanTime+864e5){lastIndexMetaCleanTime=o;let e=new Date(o);e.setUTCHours(8,15,0),lastIndexMetaCleanTime=e.getTime(),await setSyncStorage("lastIndexMetaCleanTimeKey",lastIndexMetaCleanTime),chartIndexMetaObject={},await setSyncStorage("chartIndexMetaObjectKey",chartIndexMetaObject)}chartIndexMetaObject=await _fb3ac9d("chartIndexMetaObjectKey",chartIndexMetaObject),isChartIndexMetaObjectLoaded=!0;for(let e=0;e<ivExpirySymbolList.length;e++){const t=ivExpirySymbolList[e].foName;indexMetaSymbolSelector.add(new Option(t,e)),null==chartIndexMetaObject[t]&&(chartIndexMetaObject[t]=[])}let i=indexMetaChartRootParent.querySelector(".atmChartTimeFrameSelect");i.value=currentAtmChartTimeFrame,i.addEventListener("input",(async function(){currentAtmChartTimeFrame=i.value,await _f4d90b9(activeIvChartSymbol),await setSyncStorage("currentAtmChartTimeFrame",currentAtmChartTimeFrame)})),ivExpirySymbolList.length>0&&(null==ivExpirySymbolList.find((e=>e.foName==activeIvChartSymbol))&&(activeIvChartSymbol=ivExpirySymbolList[0].foName),indexMetaSymbolSelector.value=ivExpirySymbolList.findIndex((e=>activeIvChartSymbol==e.foName)),_f4d90b9(activeIvChartSymbol)),indexMetaSymbolSelector.addEventListener("input",(function(){activeIvChartSymbol!=indexMetaSymbolSelector.value&&""!=indexMetaSymbolSelector.value&&_f4d90b9(ivExpirySymbolList.find((e=>e.foName==ivExpirySymbolList[indexMetaSymbolSelector.value].foName)).foName)}))}function _fc1dd91(e,t){let o=e.options();o.price=t,e.applyOptions(o)}async function _f4d90b9(e){activeIvChartSymbol=e,await setSyncStorage("activeIvChartSymbolKey",activeIvChartSymbol),null!=ivChartAwaitTimeOut&&(isChartTicking=!1,ivChartAwaitTimeOut.cancel(),await delay(1)),isChartTicking=!0;let t=Object.keys(chartIndexMetaObject);for(let e=0;e<t.length;e++){let o=t[e];if(o==activeIvChartSymbol){let e=[],t=[],i=[];if(chartIndexMetaObject[o].length>0){let a=_fec35c8(chartIndexMetaObject[o],currentAtmChartTimeFrame);for(let o=0;o<a.length;o++){const n=a[o];if(n.straddlePrice>0){let o={value:n.straddlePrice,time:n.time};e.push(o);let a={value:n.ivPrice<0?0:n.ivPrice,time:n.time};t.push(a);const r=null!==n.spotPrice&&void 0!==n.spotPrice&&!isNaN(n.spotPrice)&&n.spotPrice>=0?n.spotPrice:0;0!==r&&i.push({value:r,time:n.time})}o==a.length-1&&_fc1dd91(currentStraddleLine,n.straddlePrice)}}straddleLineSeries.setData(e),ivLineSeries.setData(t),spotLineSeries.setData(i)}}await delay(2),straddleIVChartObject.timeScale().fitContent(),_f448284()}function _fec35c8(e,t=5){const o=60*t,i=[];let a=null;return e.forEach((e=>{const t=Math.floor(e.time/o)*o;a&&a.time===t||a&&i.push(a),a={...e,time:t}})),a&&i.push(a),i}let isChartTicking=!1,lastIndexMetaSaveMinute=null;async function _f448284(){for(;isAppActive&&isChartTicking;){const e=getISTTimeStamp(),t=Math.floor(e/(1e3*chartTimeLength));let o=!0;const i=new Date(e),a=60*i.getUTCHours()+i.getUTCMinutes();(a<540||a>930)&&(o=!1);const n=ivExpirySymbolList.map((e=>_f8de329(e.foName,e.expiry))),r=await Promise.all(n);for(let e=0;e<ivExpirySymbolList.length;e++){const i=ivExpirySymbolList[e].foName,a=r[e];if(!o&&chartIndexMetaObject[i]?.length)continue;if(-1===a||!a.isReady||0===a.straddlePrice)continue;const n={straddlePrice:a.straddlePrice,ivPrice:a.atmIV,spotPrice:a.spotPrice,atmStrike:a.atmStrike,cePrice:a.cePrice,pePrice:a.pePrice,time:t*chartTimeLength},s=n.time,l=chartIndexMetaObject[i].findIndex((e=>e.time===s));if(-1!==l?chartIndexMetaObject[i][l]=n:chartIndexMetaObject[i].push(n),i===activeIvChartSymbol&&straddleLineSeries){const e=60*currentAtmChartTimeFrame,t=Math.floor(s/e)*e;straddleLineSeries.update({time:t,value:n.straddlePrice}),_fc1dd91(currentStraddleLine,n.straddlePrice),ivLineSeries&&ivLineSeries.update({time:t,value:n.ivPrice>0?n.ivPrice:0}),spotLineSeries&&spotLineSeries.update({time:t,value:n.spotPrice>0?n.spotPrice:0})}}lastIndexMetaSaveMinute!==t&&(lastIndexMetaSaveMinute=t,setSyncStorage("chartIndexMetaObjectKey",chartIndexMetaObject)),ivChartAwaitTimeOut=delayFlex(1e3),await ivChartAwaitTimeOut.promise}}function _fadda9f(e,t,o,i){let a=document.createElement("div");a.classList.add("metaChartTooltipStyle"),e.appendChild(a);let n=_f36e004("metaChartTooltip"),r=function(t){if(_f2898b7(t))a.style.display="none";else{a.style.display="block";const i=t.seriesData.get(o),r=t.seriesData.get(ivLineSeries),s=t.seriesData.get(spotLineSeries),l=chartIndexMetaObject[activeIvChartSymbol].find((e=>e.time===t.time)),c=void 0!==l?.atmStrike?l.atmStrike:"N/A";let u="N/A",f="N/A",d="N/A",p=0;if(null==i)return;p=void 0!==i.value?i.value:i.close,u=p.toFixed(2),null!=r&&(f=void 0!==r.value?r.value.toFixed(2):r.close.toFixed(2)),null!=s&&(d=void 0!==s.value?s.value.toFixed(2):s.close.toFixed(2));let m=n.replace("$indexName",activeIvChartSymbol);m=m.replace("$time",getFormattedTimeForChart(t.time)),m=m.replace("$straddlePrice",u),m=m.replace("$ivPrice",f),m=m.replace("$spotPrice",d),m=m.replace("$atmStrike",c),a.innerHTML=m;const _=o.priceToCoordinate(p);let y=t.point.x-110;if(null===_)return;y=Math.max(0,Math.min(e.clientWidth-250,y));const b=Math.max(0,Math.min(e.clientHeight-150-20,_+20));a.style.left=y+"px",a.style.top=b+"px"}};return t.subscribeCrosshairMove(r),{crosshairMoveHandler:r,toolTip:a}}var prefCompactView={key:!1},prefTiledOrderWindow={key:!1},prefAvailableCash={key:!1},prefColorizeStrikes={key:!0},prefLiquidOption={key:!1},prefATMChartFeatures={key:!0},prefMTMChartFeatures={key:!0},prefStraddleIVInfo={key:!0},prefFloatingPriceWindow={key:!1},prefGroupExpiryWise={key:!0},prefGroupViewStraddleInfo={key:!0},prefGroupViewCallPutInfo={key:!1},prefAutoTotp={key:!1},prefPositionRowDeltaInfo={key:!1},prefStrikeOrderFormat={key:"PE"},prefNotificationSound={key:!1},prefForceNeoTradeAPI={key:!1},prefTOTPHash={key:""},prefOptionChainType={key:"OTM"},prefTotalStrikes={key:"48"},prefITMStrikes={key:"0"},prefFontFamily={key:"Default"};const configChangeEvent=new CustomEvent("kc_OnConfigChange",{detail:{configName:"",configValue:""}});async function _fe76b42(){isPrem&&(await _f9d96c9("#idPrefCompactView","null","checkBox","change","prefCompactViewKey",prefCompactView),await _f9d96c9("#idPrefTiledOrderWindow","null","checkBox","change","prefTiledOrderWindowKey",prefTiledOrderWindow),await _f9d96c9("#idPrefAvailableCash","null","checkBox","input","prefAvailableCashKey",prefAvailableCash),await _f9d96c9("#idPrefMTMChartFeatures","null","checkBox","input","prefMTMChartFeatures",prefMTMChartFeatures),await _f9d96c9("#idPrefATMChartFeatures","null","checkBox","input","prefATMChartFeaturesKey",prefATMChartFeatures),await _f9d96c9("#idPrefFloatingPriceWindow","null","checkBox","input","prefFloatingPriceWindowKey",prefFloatingPriceWindow),await _f9d96c9("#idPrefStraddleIVInfo","null","checkBox","input","prefStraddleIVInfoKey",prefStraddleIVInfo),await _f9d96c9("#idPrefColorizeStrikes","null","checkBox","input","prefColorizeStrikesKey",prefColorizeStrikes),await _f9d96c9("#idPrefAutoTotp","null","checkBox","input","prefAutoTotpKey",prefAutoTotp),await _f9d96c9("#idPrefTOTPHash","null","textBox","input","prefTOTPHashKey",prefTOTPHash),await _f9d96c9("#idPrefOptionChainType","null","textBox","input","prefOptionChainTypeKey",prefOptionChainType),await _f9d96c9("#idPrefTotalStrikes","null","textBox","input","prefTotalStrikesKey",prefTotalStrikes),await _f9d96c9("#idPrefITMStrikes","null","textBox","input","prefITMStrikesKey",prefITMStrikes),await _f9d96c9("#idPrefFontFamily","null","textBox","input","prefFontFamilyKey",prefFontFamily),await _f9d96c9("#idPrefCE","strikesFormat","radio","change","prefStrikeOrderFormatKey",prefStrikeOrderFormat),await _f9d96c9("#idPrefPE","strikesFormat","radio","change","prefStrikeOrderFormatKey",prefStrikeOrderFormat),await _f9d96c9("#idPrefNotificationSound","null","checkBox","input","prefNotificationSoundKey",prefNotificationSound),await _f9d96c9("#idPrefForceNeoTradeAPI","null","checkBox","input","prefForceNeoTradeAPIKey",prefForceNeoTradeAPI))}async function _fa0a2f9(){await _f9d96c9("#idPrefGroupExpiryWise","null","checkBox","input","prefGroupExpiryWise",prefGroupExpiryWise),await _f9d96c9("#idPrefGroupViewStraddleInfo","null","checkBox","input","prefGroupViewStraddleInfoKey",prefGroupViewStraddleInfo),await _f9d96c9("#idPrefGroupViewCallPutInfo","null","checkBox","input","prefGroupViewCallPutInfoKey_2",prefGroupViewCallPutInfo),await _f9d96c9("#idPrefPositoinGreeks","null","checkBox","input","prefPositionDeltaKey",prefPositionRowDeltaInfo)}async function _f9d96c9(e,t,o,i,a,n){n.key=await _fb3ac9d(a,n.key),"checkBox"==o?document.querySelector(e).checked=n.key:"textBox"==o?document.querySelector(e).value=n.key:"radio"==o&&document.querySelector(e).value==n.key&&(document.querySelector(e).checked=!0),_fb80829(e,t,o,i,a,n)}function _fb80829(e,t,o,i,a,n){document.querySelector(e).addEventListener(i,(async function(){if("checkBox"==o)n.key=document.querySelector(e).checked;else if("textBox"==o)n.key=document.querySelector(e).value;else if("radio"==o){let e="input[type=radio][name="+t+"]:checked";n.key=document.querySelector(e).value}await setSyncStorage(a,n.key),configChangeEvent.detail.configName=a,configChangeEvent.detail.configValue=n.key,document.dispatchEvent(configChangeEvent),onConfigChanged(!1)}))}async function _fb3ac9d(e,t){return new Promise((async(o,i)=>{let a=await fetchSyncStorage(e);null==a&&(setSyncStorage(e,t),a=t),o(a)}))}let globalStatus,cfURL="https://kiteplus.radiuscraft-tech.workers.dev/";var isCommodity,licenseStatus="Expired",instanceCounter=0,lastReloadTime=new Date(Date.now()-864e5),isPrem=!1,versionTestPassed=!1,isWatchListFeatureEnabled=!0,isMTMStopLossFeature=!1,isBasketFeature=!0,isAPIMode=!0;let isFirstPagePosition=!0,isTiledFeature=!0,isTradingHours=!1,isAppActive=!0;var utilityContainer,orderDiv,container,stickyOpenButton,stickyCloseButton,lockFrame,extraHTMLFileText;let noticeLayerElement,noticeMessageElement,isReal=!0,isPos=!1,isInitDone=!1,currentPage=window.location.pathname,configPrefix="KOTAK_",CURRENT_BROKER="KOTAK",APP_NAME="NeoPlus";const ZERODHA_BROKER="ZERODHA",KOTAK_BROKER="KOTAK",JAINAM_BROKER="JAINAM",EMPTY_ARRAY=Object.freeze([]);let BUY_LEG_WAIT=150,SELL_LEG_WAIT=50;const orderLimiter=new RateLimiter(10,1e3);let isNeoTerminalMode=!1,isNeoHybridlMode=!1;async function _f25d0d6(){if(globalStatus=await fetchSyncStorage("kiteGlobalStatus"),null==globalStatus&&(await setSyncStorage("kiteGlobalStatus",!0),globalStatus=!0),globalStatus){if(window.location.href.includes("radiuscraft")&&currentPage.toLocaleLowerCase().includes("terminal")&&(isNeoTerminalMode=!0,configPrefix="KOTAK_T_",await delay(10),await _f366090(),_f2ed661(),await _f9fd387()),window.location.href.includes("jainam")){if(window.location.pathname.includes("contract")||window.location.pathname.includes("apidocs"))return;for(;isAppActive&&"/"==window.location.pathname;)await delay(50);CURRENT_BROKER=JAINAM_BROKER,APP_NAME="JAINAM PLUS",configPrefix="JAINAM_"}if(!isNeoTerminalMode)for(isNeoHybridlMode=!0;isAppActive&&window.location.pathname.toLowerCase().includes("login");)await delay(200);if(isNeoTerminalMode)for(;isAppActive&&!isValidNeoTradeSession;)await delay(10);logMessageWithTime("after global status"),await delay(10),window.onpagehide=e=>{e.persisted||(isAppActive=!1)},await _f83c2f3(),logMessageWithTime("after load stored values"),_fd8ef07(),_f525971()}}async function _f525971(){CURRENT_BROKER==KOTAK_BROKER?_fb3699e():CURRENT_BROKER==JAINAM_BROKER&&initJainamAPI(),_fd9263a(),_fdc1859(),_fcfb3ad()}async function _fdc1859(){let e=(new Date).getTime(),t=await _fb3ac9d("lastAuthTime",0);(e-new Date(t))/36e5<6&&_fc80430(!0)}async function _fdeeb01(e){}async function _fa114af(){let e=(new Date).getTime(),t=(new Date).getTime();t-=864e5,await setSyncStorage("lastUserID",kitePlusUserInfo.userID),await setSyncStorage("expiryDate",expiryDate.getTime()),await setSyncStorage("latestVersion",latestVersion),await setSyncStorage("minVersion",minVersion),await setSyncStorage("forcedStatus",forcedStatus),await setSyncStorage("forcedMessage",forcedMessage),await setSyncStorage("isAPIMode",isAPIMode);let o="Active"==licenseStatus||"FreeNoUser"==licenseStatus||"FreeUser"==licenseStatus;o?await setSyncStorage("lastAuthTime",e):await setSyncStorage("lastAuthTime",t),await setSyncStorage("subType",subType),o||!initPremStatus||fetchNetworkBlocked||location.reload();let i=200==basketModeCode;i!=isBasketFeature&&(isBasketFeature=i,await setSyncStorage("isBasketFeature",isBasketFeature),location.reload());let a=200==mtmStopLossCode;a!=isMTMStopLossFeature&&(isMTMStopLossFeature=a,await setSyncStorage("isMTMStopLossFeature",isMTMStopLossFeature),location.reload()),"501"==forcedStatus?isInitDone&&versionTestPassed&&_f6a974b():(currentVersion<minVersion&&versionTestPassed&&_f6a974b(),currentVersion>=minVersion&&isInitDone&&!versionTestPassed&&_f6a974b())}async function _f6a974b(){((new Date).getTime()-lastReloadTime)/1e3>3&&(lastReloadTime=new Date,await setSyncStorage("lastReloadTime",lastReloadTime.getTime()),location.reload())}_f25d0d6();let initPremStatus=!1;async function _fc80430(e){isInitDone||(initPremStatus=e,isInitDone=!0,(isPrem=e)||(isWatchListFeatureEnabled=!1),_f0cc646())}let isStyleSheetsInit=!1;async function _f2ed661(){if(isStyleSheetsInit)return;isStyleSheetsInit=!0;let e=await fetch(chrome.runtime.getURL("Blocks/ExtraBlocks.html"));extraHTMLFileText=await e.text(),lockFrame=_f36e004("lockFrame");let t=document.querySelector("head"),o=[];o.push(chrome.runtime.getURL("Styles/commonStyle.css")),o.push(chrome.runtime.getURL("Styles/style.css")),o.push(chrome.runtime.getURL("Styles/coreStrip.css")),o.push(chrome.runtime.getURL("Styles/basketStyle.css")),o.push(chrome.runtime.getURL("Styles/neoStyle.css")),CURRENT_BROKER==JAINAM_BROKER&&o.push(chrome.runtime.getURL("Styles/jainamStyle.css")),o.push(chrome.runtime.getURL("Styles/chartStyle.css")),o.push(chrome.runtime.getURL("Styles/chartStyleIndexMeta.css")),o.push(chrome.runtime.getURL("Styles/utilityPageStyle.css")),o.push(chrome.runtime.getURL("Styles/orderPlacementStyle.css")),o.push(chrome.runtime.getURL("Styles/debugStyle.css")),o.push(chrome.runtime.getURL("Styles/torpedoStyle.css"));for(let e=0;e<o.length;e++){let i=document.createElement("link");i.href=o[e],i.type="text/css",i.rel="stylesheet",t.append(i)}t.insertAdjacentHTML("afterend",_f36e004("fontAwesomeLink")),t.insertAdjacentHTML("afterend",_f36e004("googleFont"))}async function _f0cc646(){currentVersion<minVersion||"501"==forcedStatus||(versionTestPassed=!0),await _f2ed661(),await _f366090(),logMessageWithTime("before checking valid session"),CURRENT_BROKER==KOTAK_BROKER&&await _fa31220(),logMessageWithTime("after checking valid session"),CURRENT_BROKER==KOTAK_BROKER&&_f5f1eb1();let e=await async function(){(await querySelectWait(document,"html")).setAttribute("data-theme","dark");var e=await querySelectWait(document,"body");e.classList.toggle("app",!0),e.classList.toggle("kBroker",!0);let t=torpedoRoot;const o=await fetch(chrome.runtime.getURL("Blocks/StatusBar.html"));let i=document.createElement("div");if(i.innerHTML=await o.text(),t.appendChild(i),"501"==forcedStatus){let e=_f36e004("MinVersionStatusBlock");return i.innerHTML=e,i.querySelector("#forcedMessage").style.display="block",void(i.querySelector("#forcedMessage").innerHTML=forcedMessage)}if(currentVersion<minVersion){let e=_f36e004("MinVersionStatusBlock");i.innerHTML=e,minVersion>latestVersion?i.querySelector("#notAvailableVersion").style.display="block":i.querySelector("#notSupportedVersion").style.display="block";let t=document.querySelector("#versionCloseBtn"),o=document.querySelector("#statusRootDiv");return void t.addEventListener("click",(function(){o.style.display="none",document.body.style.setProperty("--statusBarHeight","0px")}))}versionTestPassed=!0,await _fbe09ae(),_fc851de();let a=await _fb3ac9d("prefNoTiledWindowKey",!isTiledFeature);isTiledFeature=!a;let n=_f36e004("NoticeLayer");t.insertAdjacentHTML("beforeend",n),noticeLayerElement=t.querySelector("#customNoticeLayer"),noticeMessageElement=t.querySelector("#plusMessage");let r=document.querySelector("body");isPrem&&r.classList.add("prem"),isWatchListFeatureEnabled&&r.classList.add("watchListFeature"),(utilityContainer=document.createElement("div")).id="utilityContainer",t.appendChild(utilityContainer),isWatchListFeatureEnabled||utilityContainer.classList.add("watchListLocked"),isPrem||utilityContainer.classList.add("noSub");const s=await fetch(chrome.runtime.getURL("Blocks/UtilityWindow.html"));utilityContainer.innerHTML+=await s.text();var l=document.querySelector("#utilityBG");utilityContainer.style.display="none",l.addEventListener("click",(function(){utilityContainer.style.display="none"})),_fd08f52(),_fc80fde(),_f733cfb(document);let c=utilityContainer.querySelector("#aboutSectionLogo"),u=utilityContainer.querySelector("#updateAvail");currentVersion>=latestVersion&&(u.style.display="none"),c.src=chrome.runtime.getURL("Arts/OnlyLogo_Square.png"),document.querySelector("#reloadFreshInstruments").addEventListener("click",(async function(e){await setSyncStorage("lastInstLoadTime",0),await setSyncStorage("lastFreezeQuantityLoadTime",0),await setSyncStorage("lastEquityLoadTime",0),location.reload()})),document.querySelector("#settingBtn").addEventListener("click",(function(e){if(!isReal){if(e.ctrlKey&&e.altKey)return void chrome.storage.local.clear();if(e.altKey)return void _f3e017a();if(e.altKey)return void _f3e017a()}let t="#tabToggle01";isPrem||(t="#tabToggle03"),document.querySelector(t).checked=!0,utilityContainer.style.display="block",_f8be915()}));const f=await fetch(chrome.runtime.getURL("Styles/fontList.txt"));let d=(await f.text()).split("\n");const p=document.querySelector("#idPrefFontFamily");return d.forEach((e=>{let t=e.trim();if(!t.startsWith("//")){let e=new Option(t,t);p.add(e)}})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&"block"==utilityContainer.style.display&&(utilityContainer.style.display="none")}),!1),await _fe76b42(),!0}();CURRENT_BROKER==KOTAK_BROKER&&isNeoHybridlMode&&_f9fd387(),e&&(_fa6c293(),_f48007a(),CURRENT_BROKER==KOTAK_BROKER?(_f3be641(),_fa65c23()):CURRENT_BROKER==JAINAM_BROKER&&(_fbe3ad9(),jainam_create_orderSocket()),isPrem&&_fad1dcd(),_f8be45a((async e=>{await delay(500),_f82fe18(),_f5da7d8(),_fd328d7(),_fc1aa8e(),_f8e57df(),_f39fe77(),_f526eed()})),onConfigChanged(!0),function(){let e=torpedoRoot.querySelectorAll(".appLogo");for(let t=0;t<e.length;t++)e[t].src=chrome.runtime.getURL("Arts/OnlyLogo_Square.png");document.querySelectorAll(".kitePricingLink").forEach((e=>{e.href=_f2c3813(CURRENT_BROKER)}));let t=document.querySelectorAll(".targetAppName"),o=document.querySelectorAll(".firstAppText"),i=document.querySelectorAll(".secondAppText"),a=(document.querySelectorAll(".thirdAppText"),document.querySelector("#idBrokerIDHeader"));CURRENT_BROKER==KOTAK_BROKER?(t.forEach((e=>{e.innerText=APP_NAME})),o.forEach((e=>{e.innerText="NEO"})),i.forEach((e=>{e.innerText="PLUS"})),a.innerText="Kotak Neo ID:"):CURRENT_BROKER==JAINAM_BROKER&&(t.forEach((e=>{e.innerText=APP_NAME})),o.forEach((e=>{e.innerText="JAINAM"})),i.forEach((e=>{e.innerText="PLUS"})),a.innerText="Jainam User ID:")}())}async function _ff6b652(){prefTiledOrderWindow.key&&isPrem?(lastStickyStatus=!0,_f1faf39(isFirstPagePosition)):(lastStickyStatus=!1,_f1faf39(!1)),document.addEventListener("kc_OnConfigChange",(function(e){"prefTiledOrderWindowKey"==e.detail.configName&&(e.detail.configValue&&isPrem?(lastStickyStatus=!0,_f1faf39(!0)):(lastStickyStatus=!1,_f1faf39(!1)))}))}async function _fcfb3ad(){let e=new Date(getISTTimeStamp());e.setUTCHours(8,15,0);let t=e.getTime();if(!(getISTTimeStamp()>t))for(;;)getISTTimeStamp()>t&&_f6a974b(),await delay(3e3)}async function _ff7cf01(){if(null==document.querySelector(".container-left #watchListButtonDiv")){let e=document.querySelector(".container-left .omnisearch");if(null!=e){let t=document.createElement("div");t.id="watchListButtonDiv",e.appendChild(t),t.innerHTML=_f36e004("watchListBlock"),initWatchListFeature()}}}var lastStickyStatus=!1;function _f9307a0(e){lastStickyStatus=e,_fa333aa(e),_f1faf39(e)}function _fa333aa(e){isTiledFeature&&isPrem&&null!=stickyOpenButton&&(stickyOpenButton.style.display="none",stickyCloseButton.style.display="none",isPos&&(e?stickyCloseButton.style.display="block":stickyOpenButton.style.display="block"))}const onConfigChanged=async function(e){let t;document.querySelector("body"),document.querySelector("#orderFrame"),t=document,1==prefAvailableCash.key?document.querySelector("#availTD").style.visibility="visible":document.querySelector("#availTD").style.visibility="hidden";let o=document.querySelector("body");prefFontFamily.key.includes("Default")?CURRENT_BROKER==KOTAK_BROKER||CURRENT_BROKER==JAINAM_BROKER?torpedoRoot.style.fontFamily="Open Sans":o.style.fontFamily="Open Sans":CURRENT_BROKER==KOTAK_BROKER||CURRENT_BROKER==JAINAM_BROKER?(torpedoRoot.style.fontFamily=prefFontFamily.key,torpedoRoot.style.setProperty("font-family",prefFontFamily.key,"important")):(o.style.fontFamily=prefFontFamily.key,o.style.setProperty("font-family",prefFontFamily.key,"important")),_f076009()};function _f1faf39(e){if(null==orderDiv)return;let t=document.querySelector("body");_fa333aa(e),orderDiv.style.visibility=e?"visible":"collapse",t.classList.toggle("enabledTiledWindow",e),t.classList.toggle("disabledTiledWindow",!e)}async function _f3e017a(){await delay(5e3);let e=document.querySelector("#orderFrame"),t=await querySelectFrameWait(e,".orderbook",5),o=await fetch(chrome.runtime.getURL("Blocks/OrderBookTestBlock.html")),i=await o.text(),a="";for(let e=0;e<250;e++)a+=i;t.innerHTML=a}async function _f66b985(){await delay(1e3);let e=document.querySelector("#orderFrame").contentDocument.querySelector('.page-nav a[href="/orders');null!=e&&e.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}var prefMTMChart={key:!1},prefPositionGroupOption={key:!1};async function _f8053dd(){if(!isPrem)return;if(isPrem){let e=document.querySelector("#idPrefMTMChartFeatures");null!=e&&e.addEventListener("change",(function(){let e=document.querySelector("#MTMChartCheckBoxDiv");if(prefMTMChartFeatures.key&&!isChartInit)location.reload();else if(prefMTMChartFeatures.key&&isChartInit)null!=e&&(e.style.display="flex");else if(0==prefMTMChartFeatures.key){let t=document.querySelector("#idPrefMTMChart");null!=t&&t.checked&&t.click(),null!=e&&(e.style.display="none")}}))}let e;for(await delay(10);null==e&&isAppActive;)e=document.querySelector(".open-positions"),await delay(10);let t=e.querySelector(".toolbar .search");if(null==t)return;let o=_f36e004("GroupCheckBox");if(t.insertAdjacentHTML("beforebegin",o),_fb865be(),1==prefMTMChartFeatures.key)isPrem&&(prefMTMChart.key=await _fb3ac9d("prefMTMChartKey",prefMTMChart.key),e.querySelector("#idPrefMTMChart").checked=prefMTMChart.key,e.querySelector("#idPrefMTMChart").addEventListener("input",(async function(){prefMTMChart.key=e.querySelector("#idPrefMTMChart").checked,await setSyncStorage("prefMTMChartKey",prefMTMChart.key),_fa1a722(prefMTMChart.key)})),_f55aa32(),_fa1a722(prefMTMChart.key));else{let e=document.querySelector("#MTMChartCheckBoxDiv");null!=e&&(e.style.display="none")}}function _f36e004(e){return getSubBlockHTML(extraHTMLFileText,e)}var prefExtraFloatingSymbol={key:!1},prefIndexMetaSymbol="NIFTY",prefIndexMetaExpiry=void 0,prefIndexMetaToggle={key:!0};let isPremiumDifferenceShow=!1;async function _f392c18(){}let mdo={};async function _f68aabb(){let e=document.createElement("div");torpedoRoot.appendChild(e),e.id="marketDepthWindow";let t=_fa44a57("marketDepthWindow");e.innerHTML=t,makeDraggable(e.querySelector(".modal-container"));let o=e.querySelector(".closeBtn");mdo.symbolHeaderNameElement=e.querySelector(".symbolHeaderName"),mdo.symbolPriceElement=e.querySelector(".symbolPrice"),mdo.symbolChangeElement=e.querySelector(".symbolChange"),mdo.instOpenElement=e.querySelector(".instOpenValue"),mdo.instCloseElement=e.querySelector(".instCloseValue"),mdo.instLowElement=e.querySelector(".instLowValue"),mdo.instHighElement=e.querySelector(".instHighValue"),e.style.display="none",o.addEventListener("click",(async function(){e.style.display="none"})),mdo.updateMarketDepthInstrument=async(t,o)=>{e.style.display="block",mdo.symbolHeaderNameElement.innerText=t,mdo.instrument_token=o,null!=mdo.ltpCalTimeOut&&(mdo.ltpCalTimeOut.cancel(),await delay(1)),async function(){for(;isAppActive;){let e=await _f1d31cd(mdo.instrument_token);if(-1!=e&&null!=e){let t=e.last_price.toFixed(2);mdo.ltp=e.last_price,mdo.symbolPriceElement.innerText=t;let o=e.last_price-e.ohlc.close,i=o.toFixed(2);mdo.symbolPriceElement.classList.toggle("text-green",o>=0),mdo.symbolPriceElement.classList.toggle("text-red",o<0),mdo.symbolChangeElement.innerText=i,mdo.instOpenElement.innerText=e.ohlc.open.toFixed(2),mdo.instLowElement.innerText=e.ohlc.low.toFixed(2),mdo.instHighElement.innerText=e.ohlc.high.toFixed(2),mdo.instCloseElement.innerText=e.ohlc.close.toFixed(2)}mdo.ltpCalTimeOut=delayFlex(500),await mdo.ltpCalTimeOut.promise}}()}}async function _ffb880f(){await _fbe09ae(),_fbc37f9(),_f68aabb();let e=[];for(let r=0;r<underlyingMapping.length;r++)e.push(underlyingMapping[r].InstrumentToken);_f7d8e25(POSITION_TOKEN_KEY,e);let t=document.querySelector(".indicesPriceParent"),o=t.querySelector(".indicesPriceSet");for(let s=0;s<5;s++){const l=o.cloneNode(!0);o.parentElement.appendChild(l)}let i=t.querySelectorAll(".indicesPriceSet"),a=[];for(let c=0;c<underlyingMapping.length;c++){const u=underlyingMapping[c];let f=_f7086f4(JSON.stringify(u.FoName)),d=(Date.parse(f[0])-getISTTimeStamp())/36e5;d+=3;let p=Math.ceil(d/24);p<0&&(p=0);let m=i[c].querySelector(".indicesNameRow"),_=i[c].querySelector(".indicesPriceRow");m.innerText=u.FoName;let y=i[c].querySelector(".indicesPrice"),b=i[c].querySelector(".indicesChange"),g=i[c].querySelector(".indicesChangePercent");async function n(e){let t;for(t=CURRENT_BROKER==KOTAK_BROKER?e.InstrumentToken:JSON.parse(e.InstrumentToken);isAppActive;){let e=await _f1d31cd(t);if(null!=e&&-1!=e){let t=e.last_price.toFixed(2);if(y.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,o=(t/e.ohlc.close*100).toFixed(2)+"%",i=t.toFixed(2);y.classList.toggle("text-green",t>=0),y.classList.toggle("text-red",t<0),b.innerText=i,g.innerText=o}}await delay(500)}}m.addEventListener("click",(async function(){let e=_f282674(u.FoName);_f1a7719(e,e.lot_size)})),_.addEventListener("click",(async function(){_f282674(u.FoName),mdo.updateMarketDepthInstrument(u.FoName,u.InstrumentToken)})),a.push({row:i[c],days:p}),n(u)}}let indexMetaWindowParent,floatingPLElement,slElement,targetElement,floatingSLMessageElement,floatingStopLossWindow,isIndexMetaInit=!1,symbolObjects=[];async function _fbc37f9(){let e;await delay(250);let t="marketwatch-sidebar";for(CURRENT_BROKER!=ZERODHA_BROKER&&(t=".straddleIVSection");null==e&&isAppActive;)e=document.querySelector(t),await delay(10);isIndexMetaInit=!0,prefIndexMetaSymbol=await _fb3ac9d("prefIndexMetaSymbolKey",prefIndexMetaSymbol),prefIndexMetaExpiry=await _fb3ac9d("prefIndexMetaExpiryKey",prefIndexMetaExpiry),prefIndexMetaToggle.key=await _fb3ac9d("prefIndexMetaToggleKey",prefIndexMetaToggle.key),e.classList.toggle("indexMetaData",!0),indexMetaWindowParent=document.createElement("div"),indexMetaWindowParent.id="indexMetaDataWindowParent";let o=await querySelectWait(document,t);o.insertBefore(indexMetaWindowParent,o.firstChild);let i=_f36e004("indexMetaData");indexMetaWindowParent.innerHTML=i,_f733cfb(indexMetaWindowParent);let a,n,r,s,l,c,u,f,d,p,m,_,y,b,g,h,S,T,w,M,k=!1,E=[],C="",P="";basketHeaderElement=indexMetaWindowParent.querySelector(".row"),r=indexMetaWindowParent.querySelector(".basketSearchDiv"),c=indexMetaWindowParent.querySelector(".ulParentDiv"),l=indexMetaWindowParent.querySelector(".searchButtonSymbol"),indexPriceRow=indexMetaWindowParent.querySelector(".indexPrice").parentElement,f=indexMetaWindowParent.querySelector(".indexPrice"),d=indexMetaWindowParent.querySelector(".indexChange"),p=indexMetaWindowParent.querySelector(".syntheticValue"),y=indexMetaWindowParent.querySelector(".straddleValue").querySelector(".mainPart"),b=indexMetaWindowParent.querySelector(".straddleValue").querySelector(".subPart"),g=indexMetaWindowParent.querySelector(".atmStrikeValue"),S=indexMetaWindowParent.querySelector(".cePrice").querySelector(".mainPart"),w=indexMetaWindowParent.querySelector(".cePrice").querySelector(".subPart"),T=indexMetaWindowParent.querySelector(".pePrice").querySelector(".mainPart"),M=indexMetaWindowParent.querySelector(".pePrice").querySelector(".subPart"),thetaElement=indexMetaWindowParent.querySelector(".thetaValue"),m=indexMetaWindowParent.querySelector(".indexMetaExpiry"),_=m.querySelector("select"),h=indexMetaWindowParent.querySelector(".atmIV"),s=indexMetaWindowParent.querySelector(".searchClose"),u=indexMetaWindowParent.querySelector("input"),_.addEventListener("input",(async function(){n=E[_.value],prefIndexMetaExpiry=n,await setSyncStorage("prefIndexMetaExpiryKey",prefIndexMetaExpiry),A()})),indexMetaWindowParent.querySelector("#indexMetaDataWindow"),indexPriceRow.addEventListener("click",(async()=>{let e=_f282674(P);_f1a7719(e,e.lot_size)}));let N=prefIndexMetaToggle.key,O=indexMetaWindowParent.querySelector(".floatingToggle"),I=indexMetaWindowParent.querySelector(".downArrowBtn"),L=indexMetaWindowParent.querySelector(".upArrowBtn");function R(){e.classList.toggle("hiddenIndexMeta",!N),e.classList.toggle("indexMetaData",N),L.style.display=N?"block":"none",I.style.display=N?"none":"block"}O.addEventListener("click",(async()=>{N=!N,prefIndexMetaToggle.key=N,R(),await setSyncStorage("prefIndexMetaToggleKey",prefIndexMetaToggle.key)})),R(),""==P&&(P="");let v=!1,x=!0;async function A(){let e=C;_f02bf8f(),_f2ac924(e,n),null!=a&&(k=!1,a.cancel(),await delay(1)),_f9da2f3(),k=!0;let t=!1;for(;isAppActive&&k;){let o=50,i=await _f8de329(e,n);if(-1!=i.baseTickData&&null!=i.baseTickData){let e=i.baseTickData,t=e.last_price?.toFixed(2)??"N/A";if(f.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,o=t.toFixed(2);f.classList.toggle("text-green",t>=0),f.classList.toggle("text-red",t<0),d.innerText=o}}else f.innerText="N/A";if(-1!=i&&i.isReady){o=500;let e=i.price.toFixed(2);if(isPremiumDifferenceShow){let t=-1==i.price?0:i.price-i.baseTickData.last_price,o=t>0?"+"+t.toFixed(2):t.toFixed(2);p.innerText=(-1==i.price?"N/A":e)+" ("+o+")"}else p.innerText=-1==i.price?"N/A":e;let a=-1==i.straddlePrice?"N/A":i.straddlePrice.toFixed(2),n=-1==i.straddlePrice?"N/A":i.thetaPrice.toFixed(2),r=-1==i.cePrice?"N/A":i.cePrice.toFixed(2),s=-1==i.pePrice?"N/A":i.pePrice.toFixed(2),l=-1==i.ceTheta?"N/A":i.ceTheta.toFixed(2),c=-1==i.peTheta?"N/A":i.peTheta.toFixed(2);y.innerText=a,b.innerText=n,g.innerText=-1==i.atmStrike?"N/A":i.atmStrike,S.innerText=r,w.innerText=l,T.innerText=s,M.innerText=c,h.innerText=-1==i.atmIV?"N/A":i.atmIV.toFixed(2),t||(t=!0)}else p.innerText="N/A",y.innerText="N/A",b.innerText="N/A",y.innerText="N/A",g.innerText="N/A",S.innerText="N/A",w.innerText="N/A",T.innerText="N/A",M.innerText="N/A",h.innerText="N/A";a=delayFlex(o),await a.promise}}_f8be45a((o=>{!async function(){let o=0,i=(document.querySelector(t),6),a=r.querySelector("ul"),f=[];for(let e=0;e<i;e++){let e=document.createElement("li");a.appendChild(e),f.push(e),e.addEventListener("click",(t=>{d(e.innerText)}))}async function d(e){"-"!=e?(y(!1),p(),P!=e&&(P=e,u.value=P,async function(e){for(let e=0;e<symbolObjects.length;e++)symbolObjects[e].runningStatus=!1;let t,o=symbolObjects.filter((t=>t.symbol==e));o.length>0?(t=o[0],t.runningStatus=!0):(t={symbol:e,runningStatus:!0},symbolObjects.push(t)),C=t.symbol,await async function(e){let t=e.symbol;E=_f7086f4(t,"OPT"),n=E.length>0?E[0]:void 0,prefIndexMetaExpiry=n,await setSyncStorage("prefIndexMetaExpiryKey",prefIndexMetaExpiry),_.options.length=0;let o=getISTTimeStamp();for(let e=0;e<E.length;e++){let t=E[e],i=new Date(t),a="";a=(i.getTime()-o)/864e5<365?i.getDate()+" "+monthConst[i.getMonth()]:monthConst[i.getMonth()]+"-"+i.getFullYear(),_.add(new Option(a,e))}let i=E.indexOf(n);_.selectedIndex=i}(t),A()}(e)),u.value=P,prefIndexMetaSymbol=P,await setSyncStorage("prefIndexMetaSymbolKey",prefIndexMetaSymbol)):m()}function p(){for(let e=0;e<i;e++)f[e].innerText="",f[e].style.display="none"}function m(){u.value=P,y(!1),p(),u.blur()}function y(t){o=(new Date).getTime(),v=t,s.style.visibility=t?"visible":"hidden",l.style.visibility=t?"hidden":"visible",e.classList.toggle("searchOpen",v),c.style.visibility=t?"visible":"hidden"}function b(e,t){f[e].innerText=t,f[e].style.display="block"}function g(){f.forEach(((e,t)=>{e.classList.toggle("active",t===S)}))}function h(){u.value="",T=0,S=-1,g(),function(){y(!0),p();for(let e=0;e<defaultSearchInstruments.length;e++)T++,b(e,defaultSearchInstruments[e]);let e=recentBasketSearches.getSearches(),t=0;for(let o=defaultSearchInstruments.length;o<i;o++)""!=e[t]&&null!=e[t]&&(b(o,e[t]),T++),t++}()}document.addEventListener("click",(async()=>{x&&(await delay(50),(new Date).getTime()-o<400||v&&m())})),l.addEventListener("click",(e=>{u.focus(),u.value=""})),s.addEventListener("click",(()=>{m()})),u.addEventListener("keydown",(e=>{27==e.keyCode&&m()}),!0),u.addEventListener("change",(()=>{""==u.value&&(u.value=P)})),u.addEventListener("mouseup",(async()=>{await delay(10),x=!0})),u.addEventListener("mousedown",(async()=>{x=!1})),u.addEventListener("focus",(e=>{h()}));let S=-1,T=0;window.addEventListener("keydown",(e=>{if(v)if("ArrowDown"===e.key)S=(S+1)%T,g(),e.preventDefault();else if("ArrowUp"===e.key)S=(S-1+T)%T,g(),e.preventDefault();else if("Enter"===e.key){if(S>=0){const e=f[S];""!=e.innerText.trim()&&(d(e.innerText),m()),S=-1,g()}e.preventDefault()}}),!0),u.addEventListener("focus",(e=>{h()})),u.addEventListener("input",(e=>{let t=u.value.toUpperCase();if(T=0,y(!1),""==t.trim())return void y(!1);y(!0),p(),y(!0);let o=eqFOKeys.filter((e=>e.includes(t))),a=Math.min(o.length,i);for(let e=0;e<a;e++)b(e,o[e]);for(let e=0;e<i;e++)e<o.length?(T++,b(e,o[e])):b(e,"-");e.stopImmediatePropagation()}),!0),d(prefIndexMetaSymbol)}()}))}let tbodyObserver,isFloatingStoplossVisible=!0,floatingSL_PNL=0,isFloatingInit=!1,lifeSlUpdateCounter=0,currentSlUpdateCounter=0,floatingStopLossSetTime=0,slTriggerObject={isTrigger:!1,instanceNumber:0},floatingStopLossObject={stoploss:0,target:0,isStopLossActive:!1,isTargetActive:!1},floatingStopLossPreference={prefNoBuy:!1,prefNoEquity:!1},floatingUIElements={slElement:void 0,targetElement:void 0,slCheckBox:void 0,targetCheckBox:void 0,prefNoBuyToggle:void 0,prefNoEquityToggle:void 0,setUIElements:function(){this.slCheckBox.checked=floatingStopLossObject.isStopLossActive,this.targetCheckBox.checked=floatingStopLossObject.isTargetActive,this.prefNoBuyToggle.checked=floatingStopLossPreference.prefNoBuy,this.prefNoEquityToggle.checked=floatingStopLossPreference.prefNoEquity,_fa310e0(this.slElement,floatingStopLossObject.stoploss),_fa310e0(this.targetElement,floatingStopLossObject.target),_fae520c()}};async function _fd99fc6(){let e=await fetchSyncStorage("lifeSlUpdateCounter");return null!=e?e:0}async function _f82f8eb(){let e=await fetchSyncStorage("slTriggerObject");return null!=e?e:slTriggerObject}async function _f5f4faa(){if(await delay(500),!isPrem)return;if(!isMTMStopLossFeature)return;let e=await fetchSyncStorage("floatingStopLossSetTime");if(null!=e){let t=new Date(e);new Date(getISTTimeStamp()).getUTCDate()!=t.getUTCDate()&&(_f9aef9b(),_f6b1da5())}lifeSlUpdateCounter=await _fd99fc6(),currentSlUpdateCounter=lifeSlUpdateCounter;let t=await fetch(chrome.runtime.getURL("Blocks/JsonData/mtmWarning.json")),o=await t.json(),i=document.createElement("div");(await querySelectWait(document,".app")).appendChild(i),i.id="StopLossWarningWindowParent";let a=_f36e004("floatingStopLossWarningWindow");i.innerHTML=a;let n=document.querySelector("#stopLossWarningWindow");i.style.display="none";let r=n.querySelector("ul");for(let e=0;e<o.length;e++){const t=o[e];let i=document.createElement("li");i.innerText=t.Warning,r.appendChild(i)}let s=document.querySelector("#MTM").parentElement;floatingStopLossWindow=document.createElement("div"),s.appendChild(floatingStopLossWindow),floatingStopLossWindow.id="floatingStopLossWindow";let l=_f36e004("floatingStopLossWindow");floatingStopLossWindow.innerHTML=l,floatingPLElement=floatingStopLossWindow.querySelector("#floatingPL"),floatingSLMessageElement=floatingStopLossWindow.querySelector(".stopLossMessage");let c=floatingStopLossWindow.querySelector(".floatingStopLossToggle"),u=floatingStopLossWindow.querySelector(".downArrowBtn"),f=floatingStopLossWindow.querySelector(".upArrowBtn");function d(){isFloatingStoplossVisible=!isFloatingStoplossVisible,floatingStopLossWindow.classList.toggle("hiddenSL",!isFloatingStoplossVisible),u.style.display=isFloatingStoplossVisible?"block":"none",f.style.display=isFloatingStoplossVisible?"none":"block",isFloatingStoplossVisible||_f297262("","error"),isFloatingStoplossVisible||(p=!1,S())}c.addEventListener("click",(()=>d()));let p=!1,m=!1,_=floatingStopLossWindow.querySelector(".floatingWarningBtn"),y=n.querySelector(".floatingWarningCloseBtn"),b=n.querySelector(".buttonExecute"),g=floatingStopLossWindow.querySelector(".floatingSLSettingBtn"),h=floatingStopLossWindow.querySelector(".floatingSettingCloseBtn");function S(){g.style.setProperty("visibility",p?"hidden":"visible"),floatingStopLossWindow.classList.toggle("settingVisible",p)}function T(){i.style.display=m?"block":"none",n.style.setProperty("visibility",m?"visible":"hidden")}g.addEventListener("click",(async function(){p=!0,S()})),h.addEventListener("click",(async function(){p=!1,S()})),_.addEventListener("click",(async function(){m=!0,T()})),y.addEventListener("click",(async function(){m=!1,T()})),b.addEventListener("click",(async function(){m=!1,T()})),T(),d(),floatingUIElements.targetCheckBox=floatingStopLossWindow.querySelector("#floatingTargetCheckbox"),floatingUIElements.slCheckBox=floatingStopLossWindow.querySelector("#floatingSLCheckbox"),floatingUIElements.slElement=floatingStopLossWindow.querySelector(".floatingSLInput"),floatingUIElements.targetElement=floatingStopLossWindow.querySelector(".floatingTargetInput"),floatingUIElements.prefNoBuyToggle=floatingStopLossWindow.querySelector("#floatingStopLossNoBuy"),floatingUIElements.prefNoEquityToggle=floatingStopLossWindow.querySelector("#floatingStopLossNoEquity"),floatingUIElements.prefNoBuyToggle.addEventListener("input",(async function(){floatingStopLossPreference.prefNoBuy=floatingUIElements.prefNoBuyToggle.checked,_f9aef9b(),_f6b1da5()})),floatingUIElements.prefNoEquityToggle.addEventListener("input",(async function(){floatingStopLossPreference.prefNoEquity=floatingUIElements.prefNoEquityToggle.checked,_f9aef9b(),_f6b1da5()})),floatingUIElements.targetCheckBox.addEventListener("change",(async function(){if(_f1e0533(),await delay(10),floatingStopLossObject.target<floatingSL_PNL&&floatingUIElements.targetCheckBox.checked)return floatingUIElements.targetCheckBox.checked=!1,void _f297262("Target should be greater than current MTM","error");floatingStopLossObject.isTargetActive=floatingUIElements.targetCheckBox.checked,slTriggerObject.isTrigger=!1,await setSyncStorage("slTriggerObject",slTriggerObject),_f9aef9b(),_fae520c(),_f6b1da5()})),floatingUIElements.slCheckBox.addEventListener("change",(async function(){if(_f1e0533(),await delay(10),floatingStopLossObject.stoploss>floatingSL_PNL&&floatingUIElements.slCheckBox.checked)return floatingUIElements.slCheckBox.checked=!1,void _f297262("Stoploss should be less than current MTM","error");floatingStopLossObject.isStopLossActive=floatingUIElements.slCheckBox.checked,slTriggerObject.isTrigger=!1,await setSyncStorage("slTriggerObject",slTriggerObject),_f9aef9b(),_fae520c(),_f6b1da5()})),_fa2ddb2(floatingUIElements.slElement,!0),_fa2ddb2(floatingUIElements.targetElement,!1),isFloatingInit=!0;let w=await fetchSyncStorage("floatingStopLossObject");null!=w&&(floatingStopLossObject=w),w=await fetchSyncStorage("floatingStopLossPreference"),null!=w&&(floatingStopLossPreference=w),floatingUIElements.setUIElements(),_f660bf3()}function _fa2ddb2(e,t){e.addEventListener("input",(function(){let t=e.value,o=t.slice(0,1);o=o.replace(/[^0-9.-]/g,"");let i=t.substring(1,t.length);i=i.replace(/[^0-9, ]/,""),e.value=o+i})),e.addEventListener("keydown",(t=>{27==t.keyCode&&(e.blur(),floatingUIElements.setUIElements())})),e.addEventListener("focus",(t=>{e.value="",e.classList.toggle("text-Zero",!0),e.classList.toggle("text-Negative",!1),e.classList.toggle("text-Positive",!1),_f1e0533()})),e.addEventListener("focusout",(e=>{floatingUIElements.setUIElements()})),e.addEventListener("change",(o=>{isNaN(parseFloat(e.value))&&(e.value="0");let i=parseFloat(e.value);if(t){if(i>floatingSL_PNL&&floatingUIElements.slCheckBox.checked)return e.blur(),void _f297262("Stoploss should be less than current MTM","error");floatingStopLossObject.stoploss=i}else{if(i<floatingSL_PNL&&floatingUIElements.targetCheckBox.checked)return e.blur(),void _f297262("Target should be greater than current MTM","error");floatingStopLossObject.target=i}e.blur(),floatingUIElements.setUIElements(),_f9aef9b()}))}async function _f6b1da5(){let e=getISTTimeStamp();await setSyncStorage("floatingStopLossSetTime",e)}async function _f9aef9b(){lifeSlUpdateCounter++,currentSlUpdateCounter++,await setSyncStorage("floatingStopLossObject",floatingStopLossObject),await setSyncStorage("floatingStopLossPreference",floatingStopLossPreference),await setSyncStorage("lifeSlUpdateCounter",lifeSlUpdateCounter)}async function _f660bf3(){for(;isAppActive;){let e=floatingStopLossObject;lifeSlUpdateCounter=await _fd99fc6(),currentSlUpdateCounter!=lifeSlUpdateCounter&&(currentSlUpdateCounter=lifeSlUpdateCounter,e=await fetchSyncStorage("floatingStopLossObject"),floatingStopLossObject=e,e=await fetchSyncStorage("floatingStopLossPreference"),floatingStopLossPreference=e,floatingUIElements.setUIElements()),e.isStopLossActive&&null!=e.stoploss&&floatingSL_PNL<e.stoploss&&(e.isStopLossActive=!1,_fa994f0(!0)),e.isTargetActive&&null!=e.target&&floatingSL_PNL>e.target&&(e.isTargetActive=!1,_fa994f0(!1)),await delay(300)}}function _fae520c(){let e=floatingStopLossObject.isStopLossActive||floatingStopLossObject.isTargetActive;floatingStopLossWindow.classList.toggle("SLActive",e)}async function _f297262(e,t){floatingSLMessageElement.classList.toggle("text-Negative","error"==t),floatingSLMessageElement.classList.toggle("text-Zero","info"==t),floatingSLMessageElement.style.setProperty("display","none"),await delay(20),floatingSLMessageElement.innerText=e,floatingSLMessageElement.style.setProperty("display","inline")}function _f1e0533(){floatingSLMessageElement.style.setProperty("display","none")}function _fa310e0(e,t){null==t||isNaN(t)?e.value="N/A":(e.value=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),e.classList.toggle("text-Zero",0==t),e.classList.toggle("text-Positive",t>0),e.classList.toggle("text-Negative",t<0)),_f932b0d()}async function _f932b0d(){}async function _f1f6f84(e){isFloatingInit&&(floatingSL_PNL=e,floatingPLElement.classList.toggle("text-Positive",e>=0),floatingPLElement.classList.toggle("text-Negative",e<0),floatingPLElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}))}async function _fa994f0(e){floatingStopLossObject.isStopLossActive=!1,floatingStopLossObject.isTargetActive=!1,floatingUIElements.setUIElements(),_f9aef9b(),await delay(Math.random(50*Math.random())+10);let t=await _f82f8eb("slTriggerObject");if(t.isTrigger)return;let o=new Date(getISTTimeStamp()),i=e?"StopLoss triggered at":"Target achieved at";i+=" "+getUTCTimeFormat(o),_f297262(i,"info"),t.isTrigger=!0,t.instanceNumber=instanceCounter,await setSyncStorage("slTriggerObject",t);let a=activePositions.map((e=>e));floatingStopLossPreference.prefNoBuy&&(a=a.filter((e=>1==e.isSell))),floatingStopLossPreference.prefNoEquity&&(a=a.filter((e=>kitePlusFOExchanges.includes(e.exchange)))),_f1b0029(a)}async function _f1b0029(e){await delay(10),e=e.sort(((e,t)=>e.isSell===t.isSell?0:e.isSell?1:-1));let t=[];for(let o=0;o<e.length;o++){let i=e[o],a=i.freezeLimit,n=Math.abs(i.quantity);if(n>a&&null!=a){let e=i.inst.lot_size,o=Math.floor(n/e),r=Math.ceil(n/a),s=distributeNumber(o,r);for(let o=0;o<s.length;o++){let a=JSON.parse(JSON.stringify(i));a.quantity=s[o]*e,t.push(a)}}else t.push(i)}for(let e=0;e<t.length;e++){const o=t[e];if(0==o.quantity)continue;let i=0,a=!1,n=1;if("MCX"==o.inst.exchange&&(n=_f9b6bef(o.inst.name)),a){let e=o.ltp,t=o.ltp;o.isSell?t=getSimpleProtectedSellPrice(-1!=o.bestBid?o.bestBid:t):e=getSimpleProtectedBuyPrice(-1!=o.bestAsk?o.bestAsk:e),i=roundToTick(o.isSell?t:e).toFixed(2)}let r={variety:"regular",inst:o.inst,multiplier:n,exchange:o.exchange,tradingsymbol:o.tradingsymbol,transaction_type:o.isSell?"BUY":"SELL",order_type:a?"LIMIT":"MARKET",quantity:Math.abs(o.quantity),price:i,product:o.product,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID};await orderLimiter.acquire();let s=await _fd25cf4(r);null!=s.ok&&s.ok||(await s.json(),showPlusMessage(document,"Error Exiting Positions","error")),await delay(15)}showPlusMessage(document,"Exited all the positions","info")}let quantityObserver,positionCountElement,posUtilityBlock,payoffTooltipBlockHTML,groupBlockHTML,premiumBlockHTML,positionGroupCheckbox,positionGroupExpiryCheckbox,activeGroups=[],payOffGraphStatus=new Set,isGroupSettingEnabled=!1,groupFunctionStatus=[],functionCallCounter=0,currentTotalProjected=0,isTableExist=!1,bufferCounter=0,rowDetails=[],rowsGroupDivPool=[],isPayOffDisabled=!1,isLightGroupCreation=!1,isCacheRowFeature=!1,isProjectProfitFeature=!0,groupInfoObjects=[],groupTargetSetObject=[],groupTargetUISet=[],lastGroupTargetCleanTime=0,isGroupStopLossFeature=!1,isGroupMarginFeature=!0,lifeGroupSlCounter=0,currentGroupSlCounter=0;const groupViewChangeEvent=new CustomEvent("kc_OnGroupViewChange",{detail:{groupType:""}});async function _f15b9be(){posUtilityBlock=_f36e004("positionUtility"),groupBlockHTML=_f36e004("GroupHeader"),payoffTooltipBlockHTML=_f36e004("PayoffTooltip"),premiumBlockHTML=_f36e004("PremiumDisplayBlock"),isLightGroupCreation=!0,isProjectProfitFeature=await _fb3ac9d("prefGroupViewStraddleInfoKey",isProjectProfitFeature),isGroupCallPutInfoFeature=await _fb3ac9d("prefGroupViewCallPutInfoKey_2",isGroupCallPutInfoFeature),isGroupStopLossFeature=isMTMStopLossFeature,lastGroupTargetCleanTime=await _fb3ac9d("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime);let e=getISTTimeStamp();if(e>lastGroupTargetCleanTime+864e5){lastGroupTargetCleanTime=e;let t=new Date(e);t.setUTCHours(8,15,0),lastGroupTargetCleanTime=t.getTime(),await setSyncStorage("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime),groupTargetSetObject=[],_feea898()}let t=document.querySelector("#idPrefGroupViewStraddleInfo");null!=t&&t.addEventListener("change",(function(){isProjectProfitFeature=t.checked,_fe48249(!1)}));let o=document.querySelector("#idPrefGroupViewCallPutInfo");null!=o&&o.addEventListener("change",(function(){isGroupCallPutInfoFeature=o.checked,_fe48249(!1)})),groupTargetSetObject=await _fb3ac9d("groupTargetSetObjectKey",groupTargetSetObject),_f8c9a54(),_f5619d1()}async function _fb865be(){let e=document.querySelector(".open-positions");prefPositionGroupOption.key=await _fb3ac9d("prefPositionGroupOptionKey",prefPositionGroupOption.key),positionGroupCheckbox=e.querySelector("#idPrefPositionGroupOption"),positionGroupCheckbox.checked=prefPositionGroupOption.key,positionGroupExpiryCheckbox=document.querySelector("#idPrefGroupExpiryWise"),positionGroupExpiryCheckbox.addEventListener("input",(async function(){groupTargetSetObject=[],_f0279c0(!0),_fe48249(!1)})),positionGroupCheckbox.addEventListener("input",(async function(){prefPositionGroupOption.key=e.querySelector("#idPrefPositionGroupOption").checked,await setSyncStorage("prefPositionGroupOptionKey",prefPositionGroupOption.key),_f0279c0(!0),_fe48249(!1)})),_fe48249(!1)}async function _feea898(){await setSyncStorage("groupTargetSetObjectKey",groupTargetSetObject)}function _fd264da(){for(let e=0;e<rowsGroupDivPool.length;e++){const t=rowsGroupDivPool[e];if(1==t.status)return t.status=!1,t}}async function _fe48249(e){lastGroupCreateTime=Date.now(),null!=tbodyObserver&&tbodyObserver.disconnect(),null!=quantityObserver&&quantityObserver.disconnect(),bufferCounter++,await delay(e?400:50),bufferCounter--,0==bufferCounter&&_feb1225(prefPositionGroupOption.key)}async function _f0279c0(e){if(e)for(let e=0;e<groupTargetSetObject.length;e++){const t=groupTargetSetObject[e];t.isStopLossActive=!1,t.isTargetActive=!1}_feea898();for(let e=0;e<groupTargetUISet.length;e++)groupTargetUISet[e].setUIElements();_f2aa0bb()}async function _f6c4a5b(e,t){for(let o=0;o<groupTargetUISet.length;o++){const i=groupTargetUISet[o];if(i.groupName==e.groupName&&i.expiry.value==e.expiry.value)return void i.onSlTargetActivated(t)}}async function _fa268ec(e){for(let t=0;t<groupInfoObjects.length;t++){const o=groupInfoObjects[t];if(o.groupStringyName==e.name&&(o.expiry.value==e.expiry||null==e.expiry))return void o.updateCallPutInfo(e)}}async function _f6a411b(e){for(let t=0;t<groupInfoObjects.length;t++){const o=groupInfoObjects[t];if(o.groupStringyName==e.name&&(o.expiry.value==e.expiry||null==e.expiry))return void o.updateCalPnl(e.profit)}}async function _f8c9a54(){}async function _f2aa0bb(){currentGroupSlCounter++,lifeGroupSlCounter++,await setSyncStorage("lifeGroupSlCounterKey",lifeGroupSlCounter)}let lastGroupCreateTime=0;async function _f5619d1(){for(;isAppActive;){if((Date.now()-lastGroupCreateTime)/1e3>5&&isTableExist){let e=document.querySelector(".open-positions tbody");if(null!=e){let t=e.querySelectorAll(":scope > tr:not(.groupDiv)");for(let e=0;e<t.length;e++)if(null==t[e].querySelector(".select-cell .posUtility")){lastGroupCreateTime=Date.now(),_fe48249(!0);break}}lastGroupCreateTime=Date.now()}await delay(500)}}async function _feb1225(e){groupInfoObjects=[],groupTargetSetObject=await _fb3ac9d("groupTargetSetObjectKey",groupTargetSetObject),groupFunctionStatus=groupFunctionStatus.map((e=>!1)),_fa93f63("processing groups and token lengths "+tokenSet_Global.length),groupFunctionStatus.push(!0),null!=quantityObserver&&quantityObserver.disconnect(),quantityObserver=new MutationObserver((e=>_ff8f5a6())),null!=tbodyObserver&&tbodyObserver.disconnect(),functionCallCounter++;let t,o=functionCallCounter-1;for(activeGroups=[],groupTargetUISet=[],isGroupSettingEnabled=e;null==t&&groupFunctionStatus[o];)t=document.querySelector(".open-positions tbody"),await delay(10);if(null==t||null==t)return;positionCountElement=document.querySelector(".open-positions .page-title .count"),currentTotalProjected=0,lastGroupCreateTime=Date.now(),isTableExist=!0,t.classList.toggle("groupedBody",e),document.querySelectorAll(".open-positions tfoot .text-right").forEach((e=>{e.style.setProperty("visibility",isGroupSettingEnabled?"hidden":"visible")}));let i=t.querySelectorAll(".groupDiv");for(let h=0;h<i.length;h++)i[h].remove();for(let S=0;S<rowsGroupDivPool.length;S++)rowsGroupDivPool[S].status=!0;rowDetails=[];let a=t.querySelectorAll(":scope > tr:not(.groupDiv)"),n=groupBlockHTML;if(a.forEach((e=>{let t=e.querySelector(".instrument"),i=e.querySelector(".product"),a=e.querySelector(".exchange"),n=e.querySelector(".quantity"),r=e.querySelector(".average-price"),s=e.querySelector(".last-price"),l=e.querySelector(".pnl"),c=t.querySelector(".tradingsymbol").innerText,u="",f=!1;t.classList.contains("open")&&(f=!0);let d="",p="",m=1,_=0,y=-1,b=i.innerText.replace(/[\s]/g,""),g=a.innerText.replace(/[\s]/g,""),h=parseFloat(n.innerText.replace(/,/g,"")),S=parseFloat(r.innerText.replace(/,/g,"")),T=parseFloat(s.innerText.replace(/,/g,"")),w=parseFloat(l.innerText.replace(/,/g,"")),M=c.split(/\s+/);{null!=n&&quantityObserver.observe(n,{subtree:!0,characterData:!0});let e="",t="0";1==M.length?(d=M[0],e="EQ"):4==M.length?(d=M[0]+""+M[1],t=M[2],e=M[M.length-1],u=M[1]):3==M.length?(d=M[0]+""+M[1],u=M[1],e=M[M.length-1]):(d=M[0]+""+M[1]+""+M[2],t=M[3],u=M[1]+""+M[2],e=M[M.length-1]),"CE"==e.toLocaleUpperCase()?y=1:"PE"==e.toLocaleUpperCase()?y=2:"FUT"==e.toLocaleUpperCase()?y=3:"EQ"==e.toLocaleUpperCase()&&(y=4),3!=y&&(_=parseFloat(t.replace(/,/g,""))),3!=y&&4!=y||(_=S)}0==prefGroupExpiryWise.key&&(d=c.replace(/ .*/,"")),"MCX"==g&&(m=_f9b6bef(JSON.stringify(M[0]))),p=d.replace(/[^a-zA-Z0-9 ]/g,""),p=p.replace(/\s/g,"");let k={name:d,product:b,exchange:g,instFullName:c,strikeNumber:_,callPutType:y,isOpen:f,id:p,expiry:u,quantity:f?h:0,quantityMultiplier:m,averagePrice:S,ltp:T,row:e,pnlElement:l,pnl:w,targetInst:void 0};if(async function(){for(;isAppActive&&groupFunctionStatus[o];){let e=_f4d7678(k.name.split(/\s(.+)/)[0],k.strikeNumber,k.callPutType,k.averagePrice,k.expiry);if(null!=e){k.targetInst=e;break}await delay(50)}for(;isAppActive&&groupFunctionStatus[o]&&-1==m;)m=_f9b6bef(JSON.stringify(M[0])),await delay(100)}(),rowDetails.push(k),isBasketFeature){let t=e.querySelector(".select-cell .posUtility"),o=e.querySelector(".posUtility");if(!t&&o&&o.remove(),null==t){let o=e.querySelector(".select-cell"),i=e.querySelector(".su-checkbox-group"),a=document.createElement("div");a.classList.add("posUtilityParent"),t=document.createElement("div"),t.classList.add("posUtility"),o.appendChild(t),t.innerHTML=posUtilityBlock;let n=e.querySelector(".positionEdit"),r=e.querySelector(".positionAdd");o.append(a),a.append(i),a.append(t),_f733cfb(a),async function(e){}(),r.addEventListener("click",(async function(t){if(t.stopPropagation(),isBasketWindowOpen){let e=1;if(t.ctrlKey&&(e=-1),null!=_f9ceac1(k.targetInst,k.quantity*e))return}await delay(5),e.dispatchEvent(new Event("mouseover"));let o=e.querySelector(".icon-more-vertical");if(null==o)return;o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})),await delay(5);let i=e.querySelector('[data-label="Add"]');null!=i?(i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})),await delay(5)):showPlusMessage(document,"Quick add quantities not available! Add manually from dropdown menu","error"),o.dispatchEvent(new MouseEvent("mouseleave",{view:window,bubbles:!0,cancelable:!0}))}),!0),n.addEventListener("click",(async function(e){e.stopPropagation();let t,o=!1,i=rowDetails.findIndex((e=>e.instFullName==k.instFullName&&e.product==k.product));if(-1!=i&&(t=rowDetails[i]),null!=t){let e=_f4d7678(d.split(/\s(.+)/)[0],t.strikeNumber,t.callPutType,t.averagePrice,t.expiry);null==e?o=!0:_f8481e6(e,t.quantity,b)}else o=!0;o&&showPlusMessage(document,"Try Again","info")}))}if(null!=t){let e=t.querySelector(".posBasketUtility");e.style.visibility=1==y||2==y?"visible":"hidden","MCX"!=g&&"CDS"!=g||(e.style.visibility="hidden")}}})),!isPrem)return;if(!isGroupSettingEnabled&&rowDetails.length>0){rowDetails.sort((function(e,t){var o=e.instFullName,i=t.instFullName;return e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen?1:o===i?-1:o>i?1:-1}));for(let T=0;T<rowDetails.length;T++)t.appendChild(rowDetails[T].row)}if(!isGroupSettingEnabled)return;let r=groupBy(rowDetails,"name"),s=Object.keys(r);for(let w=0;w<s.length;w++){const M=r[s[w]];M.sort((function(e,t){return e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen||e.instFullName>t.instFullName?1:-1}));for(let k=0;k<M.length;k++)t.appendChild(M[k].row)}let l=[];for(let E=0;E<s.length;E++){let C=s[E],P=C.split(/(\s+)/)[0];const N=r[C];let O=E,I=N[0].id,L=N[0].exchange,R={value:void 0},v=!1;l.push(0);let x,A=N.some((e=>1==e.callPutType||2==e.callPutType));payOffGraphStatus.has(C)&&(v=!0);let D,B={},F=!1,K=!0;if(isCacheRowFeature)if(x=_fd264da(),null!=x)x.row.id=I,x.row.classList.toggle("hiddenChart",v),N[0].row.parentElement.insertBefore(x.row,N[0].row),F=!0;else{let H=n.replace("targetGroupID",I);N[0].row.insertAdjacentHTML("beforebegin",H);let Y=t.querySelector("#"+I);B={row:Y,status:!1},D=_fbe1ba6(Y,".ktGroupProjected"),rowsGroupDivPool.push(B)}else{let J=n.replace("targetGroupID",I);N[0].row.insertAdjacentHTML("beforebegin",J);let z=t.querySelector("#"+I);D=_fbe1ba6(z,".ktGroupProjected")}let W=t.querySelector("#"+I);W.classList.toggle("hiddenChart",!v);let U=W.querySelector(".groupName");U.innerText=s[E]+": ",U.addEventListener("dblclick",(async function(){N.forEach((async e=>{if(0!=e.quantity){let t=e.row.querySelector(".su-checkbox-group input");if(null!=t){t.dispatchEvent(new MouseEvent("input",{view:window,bubbles:!0,cancelable:!0})),await delay(5);let e=document.querySelector(".open-positions tfoot button");null!=e&&e.dispatchEvent(new MouseEvent("click"))}}}))}));let G=W.querySelector(".groupProfit");activeGroups.push({groupElements:r[s[E]],groupProfitElement:G});let j=!1;if(0==prefGroupExpiryWise.key){let Q=N.filter((e=>e.isOpen=!0)),X=groupBy(Q,"expiry");Object.keys(X).length>1&&(W.classList.add("hiddenPL"),j=!0)}function c(){W.querySelector(".groupMetaDetails").classList.toggle("hiddenGroupMetaDetails",!isProjectProfitFeature||j||!K),W.querySelector(".groupCallPutInfoParent").classList.toggle("hiddenGroupMetaDetails",!isGroupCallPutInfoFeature||!A)}if(c(),isPositionCorrupt&&N.filter((e=>!kitePlusExchanges.includes(e.exchange))).length>0&&(W.classList.add("hiddenPL"),j=!0),j)R.value="";else{async function u(e){for(;isAppActive&&groupFunctionStatus[o];){if(null!=N[0].targetInst){R.value=N[0].targetInst.expiry;break}await delay(50)}}u()}let V=W.querySelector(".groupSLTarget");V.style.visibility="collapse";let q={groupName:P,groupStringyName:JSON.stringify(P),expiry:R,currentPNL:0,groupCalProfitElement:W.querySelector(".groupCalProfit"),callPremiumElement:W.querySelector(".groupMetaCallPremium"),putPremiumElement:W.querySelector(".groupMetaPutPremium"),callPNLElement:W.querySelector(".groupMetaCallPNL"),putPNLElement:W.querySelector(".groupMetaPutPNL"),updateCalPnl(e){this.groupCalProfitElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})},updateCallPutInfo(e){this.callPNLElement.classList.toggle("text-Positive",e.callPNL>0),this.callPNLElement.classList.toggle("text-Negative",e.callPNL<0),this.putPNLElement.classList.toggle("text-Positive",e.putPNL>0),this.putPNLElement.classList.toggle("text-Negative",e.putPNL<0),this.callPremiumElement.classList.toggle("text-Positive",e.callPremium>0),this.callPremiumElement.classList.toggle("text-Negative",e.callPremium<0),this.putPremiumElement.classList.toggle("text-Positive",e.putPremium>0),this.putPremiumElement.classList.toggle("text-Negative",e.putPremium<0),this.callPNLElement.innerText=formatToCompactNumberPNL(e.callPNL.toFixed(0)),this.putPNLElement.innerText=formatToCompactNumberPNL(e.putPNL.toFixed(0)),this.callPremiumElement.innerText=formatToCompactNumberPNL(e.callPremium.toFixed(0)),this.putPremiumElement.innerText=formatToCompactNumberPNL(e.putPremium.toFixed(0))}};if(groupInfoObjects.push(q),isGroupStopLossFeature){async function f(){for(;isAppActive&&groupFunctionStatus[o]&&null==R.value;)await delay(50);if(V.style.visibility=isGroupStopLossFeature?"visible":"collapse",!groupFunctionStatus[o])return;let e;for(let t=0;t<groupTargetSetObject.length;t++){const o=groupTargetSetObject[t];if(o.groupName==P&&o.expiry.value==R.value){e=o;break}}null==e&&(e={groupName:P,expiry:R,currentPNL:0,stoploss:0,target:0,isStopLossActive:!1,isTargetActive:!1},groupTargetSetObject.push(e));let t={groupName:P,expiry:R,slElement:cloneRemoveEventListeners(W.querySelector(".groupStopLossInput")),targetElement:cloneRemoveEventListeners(W.querySelector(".groupTargetInput")),slCheckBox:cloneRemoveEventListeners(W.querySelector(".groupStopLossCheckBox")),targetCheckBox:cloneRemoveEventListeners(W.querySelector(".groupTargetCheckBox")),messageDiv:cloneRemoveEventListeners(W.querySelector(".groupMessage")),onSlTargetActivated:async function(e){let t=new Date(getISTTimeStamp()),o=e?"Target achieved at":"StopLoss triggered at";o+=" "+getUTCTimeFormat(t),i(o,e?"success":"error")},setUIElements:async function(){this.slCheckBox.checked=e.isStopLossActive,this.targetCheckBox.checked=e.isTargetActive,a(this.slElement,e.stoploss),a(this.targetElement,e.target)}};async function i(e,o){"error"==o?t.messageDiv.classList.add("text-Negative"):"info"==o?t.messageDiv.classList.add("text-Zero"):"success"==o&&t.messageDiv.classList.add("text-Positive"),t.messageDiv.innerText=e}function a(e,t){null==t?e.value="N/A":(e.value=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),e.classList.toggle("text-Zero",0==t),e.classList.toggle("text-Positive",t>0),e.classList.toggle("text-Negative",t<0))}function n(o,a){o.addEventListener("input",(function(){let e=o.value,t=e.slice(0,1);t=t.replace(/[^0-9.-]/g,"");let i=e.substring(1,e.length);i=i.replace(/[^0-9, ]/,""),o.value=t+i})),o.addEventListener("keydown",(e=>{27==e.keyCode&&(o.blur(),t.setUIElements())})),o.addEventListener("focus",(e=>{o.value="",o.classList.toggle("text-Zero",!0),o.classList.toggle("text-Negative",!1),o.classList.toggle("text-Positive",!1),async function(){t.messageDiv.innerText=""}(),s()})),o.addEventListener("focusout",(e=>{t.setUIElements()})),o.addEventListener("change",(n=>{isNaN(parseFloat(o.value))&&(o.value="0");let s=parseFloat(o.value);if(a){if(s>e.currentPNL&&t.slCheckBox.checked)return o.blur(),void i("Stoploss should be less than current MTM","error");e.stoploss=s}else{if(s<e.currentPNL&&t.targetCheckBox.checked)return o.blur(),void i("Target should be greater than current MTM","error");e.target=s}o.blur(),t.setUIElements(),r()})),t.setUIElements()}async function r(){await _feea898(),_f2aa0bb()}function s(){floatingSLMessageElement.style.setProperty("display","none")}groupTargetUISet.push(t),t.targetCheckBox.addEventListener("change",(async function(){if(s(),await delay(10),e.target<e.currentPNL&&t.targetCheckBox.checked)return t.targetCheckBox.checked=!1,void i("Target should be greater than current MTM","error");e.isTargetActive=t.targetCheckBox.checked,r()})),t.slCheckBox.addEventListener("change",(async function(){if(_f1e0533(),await delay(10),e.stoploss>e.currentPNL&&t.slCheckBox.checked)return t.slCheckBox.checked=!1,void i("Stoploss should be less than current MTM","error");e.isStopLossActive=t.slCheckBox.checked,r()})),n(t.slElement,!0),n(t.targetElement,!1)}f()}if(!j){let $=W.querySelector(".groupMaxProfit"),Z=W.querySelector(".groupMaxLoss"),ee=W.querySelector(".projectedHeader"),te=W.querySelector(".groupProjected"),oe=W.querySelector(".groupMetaSyntheticPrice"),ie=W.querySelector(".groupMetaStraddlePrice"),ae=W.querySelector(".groupMetaATMIVPrice"),ne=W.querySelector(".groupMetaDeltaPrice"),re=W.querySelector(".groupMetaMarginUsed");async function d(){for(;isAppActive&&groupFunctionStatus[o];){let e=!0;for(let t=0;t<N.length;t++){const o=N[t];if(null==o.targetInst||null==o.targetInst.exchange){e=!1;break}}if(e){if(isGroupMarginFeature){let e=[];for(let t=0;t<N.length;t++){const o=N[t];0!=o.quantity&&e.push({exchange:o.targetInst.exchange,order_type:"MARKET",price:o.averagePrice,product:o.product,quantity:Math.abs(o.quantity),tradingsymbol:o.targetInst.tradingsymbol,transaction_type:o.quantity<0?"SELL":"BUY",variety:"regular"})}let t=await kite_getBasketMargin(JSON.stringify(e));-1!=t&&(re.innerText=formatToCompactNumber(t.final.total.toFixed(0)))}break}await delay(50)}}async function p(){for(;isAppActive&&groupFunctionStatus[o]&&null==R.value;)await delay(50);if(""==R.value)return K=!1,void c();for(_f9cd7f8(P,R.value),await delay(50);isAppActive&&groupFunctionStatus[o];){let e=await _f8de329(P,R.value);if(-1!=e&&-1!=e.price){let t=-1==e.straddlePrice?"N/A":e.straddlePrice.toFixed(2),o=e.price.toFixed(2);ae.innerText=-1==e.atmIV?"N/A":e.atmIV.toFixed(2),oe.innerText=-1==e.price?"N/A":o,ie.innerText=t;let i=0;for(let t=0;t<N.length;t++){const o=N[t];let a=e.price,n=parseFloat(o.strikeNumber),r=e.yearDiff,s=.07365;if(1==o.callPutType||2==o.callPutType){let e=_fa83168(1==o.callPutType,a,n,r,s,o.ltp);null!=e&&(i+=e*o.quantity)}else i+=o.quantity}ne.innerText=i.toFixed(2)}await delay(1e3)}}_f733cfb(W),isProjectProfitFeature&&K&&(p(),d()),isProjectProfitFeature||(ee.style.display="none",te.style.display="none");let se=0,le=0,ce=[];ce.push({sampleStrike:0,targetProfit:0}),N.forEach((e=>{0!=e.quantity&&(1==e.callPutType?se+=e.quantity:2==e.callPutType?le+=e.quantity:3!=e.callPutType&&4!=e.callPutType||(se+=e.quantity,le-=e.quantity),ce.push({sampleStrike:e.strikeNumber,targetProfit:0}))})),ce.forEach((e=>{let t=0;N.forEach((o=>{let i=o.callPutType,a=o.quantity,n=-1==o.quantityMultiplier?0:o.quantityMultiplier,r=o.averagePrice,s=o.ltp,l=o.pnl-(s-r)*a*n;t+=0==a?l:l+1*n*a*GetStrikeProfitY(e.sampleStrike,o.strikeNumber,i,r)})),e.targetProfit=t}));const ue=ce.reduce(((e,t)=>e.targetProfit>t.targetProfit?e:t)),fe=ce.reduce(((e,t)=>e.targetProfit<t.targetProfit?e:t));let de="",pe="";if($.innerText=rupeeZeroDecimalFormatter.format(ue.targetProfit),Z.innerText=rupeeZeroDecimalFormatter.format(fe.targetProfit),$.classList.toggle("text-Positive",ue.targetProfit>=0||se>0),$.classList.toggle("text-Negative",ue.targetProfit<0&&se<=0),Z.classList.toggle("text-Positive",fe.targetProfit>=0&&se>=0),Z.classList.toggle("text-Negative",fe.targetProfit<0||se<0),se<0?(Z.innerText="Unlimited",pe="<span class='text-Negative'>Unlimited  loss at the upside</span>"):pe="Max loss if <span class='toolTipSpan'>"+P+"</span> expires at level of <span class='toolTipSpan'>"+fe.sampleStrike+"</span> .",se>0?($.innerText="Unlimited",de="<span class='text-Positive'>Unlimited profit at the upside</span>"):de="Max profit if <span class='toolTipSpan'>"+P+"</span> expires at level of <span class='toolTipSpan'>"+ue.sampleStrike+"</span> .",_fc0b7b4(W,".ktMaxProfit",de),_fc0b7b4(W,".ktMaxLoss",pe),isPayOffDisabled&&(W.querySelector(".payoffButton").style.display="none"),!isPayOffDisabled){let me,_e,ye,be,ge=W.querySelector(".payoffChart"),he=W.querySelector(".payoffButton"),Se={foIndexName:P};if(he=cloneRemoveEventListeners(he),he.addEventListener("click",(function(){W.classList.contains("hiddenChart")?y(!0):y(!1)})),F&&null!=x.payoffChartObject)_e=x.payoffChartObject,ye=x.payOffAreaSeries,be=x.volumeSeries,_e.unsubscribeCrosshairMove(x.handler.crosshairMoveHandler),x.handler.toolTip.remove(),x.handler=_f01a090(ge,_e,ye,P),me=_fda88a8(P,L);else{let Te=W.querySelector("#payoffZoomIn"),we=W.querySelector("#payoffZoomOut");Te.addEventListener("click",(function(){let e=_e.timeScale().getVisibleRange(),t=e.from,o=e.to;_e.timeScale().setVisibleRange({from:t+500,to:o-500})})),we.addEventListener("click",(function(){let e=_e.timeScale().getVisibleRange(),t=e.from,o=e.to;_e.timeScale().setVisibleRange({from:t-500,to:o+500})})),_e=LightweightCharts.createChart(ge,_f44c586()),ye=_e.addBaselineSeries(_f7633f1()),be=_e.addHistogramSeries({priceFormat:{type:"volume"},lastValueVisible:!1,crosshairMarkerVisible:!1,axisLabelVisible:!1,priceLineVisible:!1,priceScaleId:""}),be.priceScale().applyOptions({scaleMargins:{top:0,bottom:0}}),me=_fda88a8(P,L);let Me=_f01a090(ge,_e,ye,P);isCacheRowFeature&&(B.payoffChartObject=_e,B.payOffAreaSeries=ye,B.volumeSeries=be,B.instToken=me,B.indexInfo=Se,B.handler=Me)}async function m(){let e=[],t=N.reduce(((e,t)=>e.strikeNumber>t.strikeNumber?e:t)),o=N.reduce(((e,t)=>e.strikeNumber<t.strikeNumber?e:t)),i=t.strikeNumber+t.averagePrice,a=o.strikeNumber-o.averagePrice;middlePoint=(i+a)/2;let n=middlePoint-.03*middlePoint,r=middlePoint+.03*middlePoint;n*=.95,r*=1.05;let s=!1,l=N.filter((function(e){return 3==e.callPutType||4==e.callPutType}));s=l.length>0,s&&(middlePoint=l[0].ltp,n=.9*middlePoint,r=1.1*middlePoint);let c=await _f2907f8(me);-1==c||s||(middlePoint=c,n=Math.min(.95*c,.97*a),r=Math.max(1.05*c,1.03*i));let u=.0012*middlePoint,f=(r-n)/u;if(u=findClosest(indexPriceSnapArray,u),n=u*Math.ceil(n/u),r=u*Math.ceil(r/u),f>350){let e=middlePoint-n,t=r-middlePoint,o=350/f;n=middlePoint-e*o,r=middlePoint+t*o,n=u*Math.ceil(n/u),r=u*Math.ceil(r/u)}let d=n;for(;d<r;){let t=0;N.forEach((e=>{t+=_(e,d)})),e.push({time:d,value:Math.round(t)}),d+=u}ye.setData(e),_e.timeScale().fitContent()}function _(e,t){let o=0,i=e.callPutType,a=e.quantity,n=e.quantityMultiplier,r=e.averagePrice,s=e.ltp,l=e.pnl-(s-r)*a*n;return o=0==e.quantity?l:l+n*a*GetStrikeProfitY(t,e.strikeNumber,i,r),o}function y(e){e&&W.classList.contains("hiddenChart")?(payOffGraphStatus.add(C),W.classList.remove("hiddenChart"),m()):W.classList.contains("hiddenChart")||(payOffGraphStatus.delete(C),W.classList.add("hiddenChart"))}async function b(){for(await _fdb88a4(me);isAppActive&&groupFunctionStatus[o];){let e=-1,t=await _f8de329(P,void 0),o=await _f1d31cd(me);if(-1!=t&&-1!=t.price?e=t.price:-1!=o&&-1!=o.last_price&&(e=o.last_price),-1!=e){let t=[];t.push({time:e,value:5e4,color:"#3b6feb"}),be.setData(t);let o=0;N.forEach((t=>{o+=_(t,e)})),isProjectProfitFeature&&(l[O]=o,te.innerText=rupeeZeroDecimalFormatter.format(o),te.classList.toggle("text-Positive",o>0),te.classList.toggle("text-Negative",o<0),null!=D&&(D.content="Projected profit if <span class='toolTipSpan'>"+P+"</span> expires at current level of <span class='toolTipSpan'>"+e+"</span> ."),g())}await delay(1500)}}new ResizeObserver((e=>{_e.timeScale().fitContent()})).observe(ge),y(v),v&&m(),_e.timeScale().fitContent(),b()}}}function g(){currentTotalProjected=0;for(let e=0;e<l.length;e++){let t=l[e];currentTotalProjected+=t}}_fb56bc7(),tbodyObserver=new MutationObserver((e=>function(e){isLightGroupCreation?(_fa93f63("new child added by count Element"),_fe48249(isAPIMode)):e.forEach((e=>{if(e.addedNodes.length>0)return _fa93f63("new child added"),void _fe48249(isAPIMode)}))}(e))),isLightGroupCreation?tbodyObserver.observe(positionCountElement,{subtree:!0,characterData:!0}):tbodyObserver.observe(t,{childList:!0})}async function _ff8f5a6(){_fe48249(!0),_fa93f63("quantity change")}async function _fb56bc7(){if(isGroupSettingEnabled&&0!=activeGroups.length)for(let e=0;e<activeGroups.length;e++){const t=activeGroups[e],o=t.groupElements;let i=0;for(let e=0;e<o.length;e++)i+=parseFloat(o[e].pnlElement.innerText.replace(/,/g,""));let a=i.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2});i>0&&(a="+"+a),t.groupProfitElement.innerText=a,t.groupProfitElement.classList.toggle("text-Positive",i>=0),t.groupProfitElement.classList.toggle("text-Negative",i<0)}}function _f01a090(e,t,o,i){let a=document.createElement("div");a.classList.add("payoffToolTipStyle"),e.appendChild(a);let n=payoffTooltipBlockHTML,r=i,s=function(t){if(_f2898b7(t))a.style.display="none";else{a.style.display="block";const i=t.seriesData.get(o);if(null==i)return;const s=void 0!==i.value?i.value:i.close;let l=rupeeZeroDecimalFormatter.format(s),c=n.replace("$instHeader",r);c=c.replace("$strikeLevel",t.time),c=c.replace("$profitAmount",l),a.classList.toggle("positiveTooltip",s>=0),a.classList.toggle("negativeTooltip",s<0),a.innerHTML=c;const u=o.priceToCoordinate(s);let f=t.point.x/1-50;if(null===u)return;f=Math.max(0,Math.min(e.clientWidth-80,f));const d=Math.max(0,Math.min(e.clientHeight-80-15,u+15));a.style.left=1*f+"px",a.style.top=1*d+"px"}};return t.subscribeCrosshairMove(s),{crosshairMoveHandler:s,toolTip:a}}let freezeMapping=[],underlyingMapping=[],eqFOKeys=[],equityInstruments=[],localMcxMultiplierMapping=[],mcxMultiplierMapping=[],mcxFutureInstruments=[],instLoaded=!1,rawInstruments=[],isForcedUpdate=!1,allowedCommodity=["COPPER","CRUDEOIL","CRUDEOILM","SILVERM","GOLDM","GOLD","NATURALGAS","NATGASMINI","SILVER","ZINK"],currentAppInstVersion=1,lastInstVersion="",equityFileName="",mutliplierMappingFileName="mcxMultiplierMapping.json",foFileName="";const eqMapByToken=new Map,eqMapByName=new Map,mapByToken=new Map,mapByName=new Map,mapByNameExpiryCE=new Map,mapByNameExpiryPE=new Map,mapByNameExpiryFUT=new Map,mapByInstTypeAndName=new Map,combinedNameExpiryCache=new Map,expiryListCacheMap=new Map;async function _ffd5abc(){mapByToken.clear(),mapByName.clear(),mapByNameExpiryCE.clear(),mapByNameExpiryPE.clear(),mapByNameExpiryFUT.clear(),mapByInstTypeAndName.clear(),combinedNameExpiryCache.clear(),expiryListCacheMap.clear();for(let e=0;e<rawInstruments.length;e++){const t=rawInstruments[e],o=t.expiry,i=t.name,a=t.instrument_type,n=t.instrument_token;mapByToken.set(n,t),mapByName.has(i)||mapByName.set(i,[]),mapByName.get(i).push(t),mapByInstTypeAndName.has(a)||mapByInstTypeAndName.set(a,new Map);const r=mapByInstTypeAndName.get(a);r.has(i)||r.set(i,[]),r.get(i).push(t);const s=i+"|"+o;"CE"===a?(mapByNameExpiryCE.has(s)||mapByNameExpiryCE.set(s,[]),mapByNameExpiryCE.get(s).push(t)):"PE"===a?(mapByNameExpiryPE.has(s)||mapByNameExpiryPE.set(s,[]),mapByNameExpiryPE.get(s).push(t)):"FUT"===a&&(mapByNameExpiryFUT.has(s)||mapByNameExpiryFUT.set(s,[]),mapByNameExpiryFUT.get(s).push(t))}for(const e of mapByNameExpiryCE.values())e.sort(((e,t)=>e.strike-t.strike));for(const e of mapByNameExpiryPE.values())e.sort(((e,t)=>e.strike-t.strike));rawInstruments.length=0,lastInstVersion=currentAppInstVersion,await setSyncStorage("lastInstVersion",lastInstVersion)}async function _fa30aaa(){eqMapByToken.clear(),eqMapByName.clear();for(let e=0;e<equityInstruments.length;e++){const t=equityInstruments[e];t.tradingsymbol=t.tradingsymbol.replace(/"/g,"");const o=t.tradingsymbol,i=t.instrument_token;eqMapByToken.set(i,t),eqMapByName.has(o)||eqMapByName.set(o,t)}}function _ff682a4(e){return mapByName.get(e)||[]}function _f2960dd(e,t){const o=e+"|"+t;return[...mapByNameExpiryCE.get(o)||EMPTY_ARRAY,...mapByNameExpiryPE.get(o)||EMPTY_ARRAY]}function _fd70ac7(e,t){const o=e+"|"+t;if(combinedNameExpiryCache.has(o))return combinedNameExpiryCache.get(o);const i=mapByNameExpiryCE.get(o)||EMPTY_ARRAY,a=mapByNameExpiryPE.get(o)||EMPTY_ARRAY,n=[...mapByNameExpiryFUT.get(o)||EMPTY_ARRAY,...i,...a];return combinedNameExpiryCache.set(o,n),n}function _f9fc74f(e,t){const o=mapByInstTypeAndName.get(e);return o&&o.get(t)||[]}async function _f758b99(){if(CURRENT_BROKER==KOTAK_BROKER?equityFileName="kotakEquity.json":CURRENT_BROKER==JAINAM_BROKER&&(equityFileName="jainamEquity.json",foFileName="jainamFO.json"),lastInstVersion=await _fb3ac9d("lastInstVersion",lastInstVersion),isForcedUpdate=currentAppInstVersion!=lastInstVersion,mcxMultiplierMapping=await _fb3ac9d("mcxMultiplierMapping",mcxMultiplierMapping),0==mcxMultiplierMapping.length){let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/mcxMultiplierMapping.json"));mcxMultiplierMapping=await e.json()}let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/underlying_mapping.json")),t=await e.json();CURRENT_BROKER==KOTAK_BROKER?underlyingMapping=t.Kotak:CURRENT_BROKER==JAINAM_BROKER&&(underlyingMapping=t.Jainam),_f17c98d();let o=[],i=0,a=!1;if(_fa12edb(),!isForcedUpdate){let e=(new Date).getTime(),t=await _fb3ac9d("lastInstLoadTime",0);i=(e-new Date(t))/36e5;let r=await fetchSyncStorage("foInstruments");null!=r&&null!=r&&i<96?(o=r,a=!0,n()):i=0}if(i>12||!a)if(CURRENT_BROKER==KOTAK_BROKER){let[e,t,i]=await Promise.all([_f603dc4("NFO"),_f603dc4("BFO"),_f603dc4("MCX")]);-1!==e&&-1!==t&&-1!==i&&(currentTime=(new Date).getTime(),await setSyncStorage("lastInstLoadTime",currentTime),o=[...e,...t,...i],await setSyncStorage("foInstruments",o),n())}else if(CURRENT_BROKER==JAINAM_BROKER){let e=await fetch(cfURL+foFileName);if(e.ok){let t=await e.json();null!=t&&(currentTime=(new Date).getTime(),await setSyncStorage("lastEquityLoadTime",currentTime),o=t,await setSyncStorage("foInstruments",o),n())}}function n(){rawInstruments=o;const e=new Set,t=new Set(mcxMultiplierMapping.map((e=>e.symbol)));mcxFutureInstruments=[];for(let i=0;i<o.length;i++){const a=o[i];a.name=a.name.replace(/"/g,""),a.strike=Number(a.strike),"MCX"!==a.exchange?e.add(a.name):(_f6bd5ff(a.name)&&e.add(a.name),"FUT"==a.instrument_type&&t.has(a.name)&&mcxFutureInstruments.push(a))}eqFOKeys=[...e],_ffd5abc(),instLoaded=!0}}async function _fa12edb(){let e=await fetchSyncStorage("equityInstruments");if(null==e||isForcedUpdate){let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/"+equityFileName));equityInstruments=await e.json(),await setSyncStorage("equityInstruments",equityInstruments)}else equityInstruments=e;_fa30aaa();let t=!0,o=(new Date).getTime(),i=await fetchSyncStorage("lastEquityLoadTime");if(null==i||null==i||isForcedUpdate||(o-new Date(i))/36e5<96&&(t=!1),t){let e=await fetch(cfURL+equityFileName);if(e.ok){let t=await e.json();null!=t&&(equityInstruments=t,o=(new Date).getTime(),await setSyncStorage("equityInstruments",equityInstruments),await setSyncStorage("lastEquityLoadTime",o),_fa30aaa())}let t=await fetch(cfURL+mutliplierMappingFileName);t.ok&&(mcxMultiplierMapping=await t.json(),await setSyncStorage("mcxMultiplierMapping",mcxMultiplierMapping))}}async function _f17c98d(){let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/FreezeOutput.json"));freezeMapping=await e.json(),freezeMapping=await _fb3ac9d("freezeQuantityJson",freezeMapping);let t=!0,o=(new Date).getTime(),i=await fetchSyncStorage("lastFreezeQuantityLoadTime");if(null==i||null==i||isForcedUpdate||(o-new Date(i))/36e5<96&&(t=!1),t){let e=await fetch(cfURL+"freezeLimits.json");if(e.ok){let t=await e.json();null!=t&&(await setSyncStorage("freezeQuantityJson",t),freezeMapping=await _fb3ac9d("freezeQuantityJson",t),o=(new Date).getTime(),await setSyncStorage("lastFreezeQuantityLoadTime",o))}}}async function _fbe09ae(){for(;!instLoaded;)await delay(10);return!0}function _f585a16(e,t,o){let i=e+"",a=mapByToken.get(i);return a||(a=eqMapByToken.get(i)),a||void 0}function _f41274d(e,t){const o=e,i=_f7086f4(o,"OPT"),a=void 0===t?i[0]:t,n=o+"|"+a,r=mapByNameExpiryCE.get(n),s=mapByNameExpiryPE.get(n);if(r&&0!==r.length)return{ceList:r,peList:s,expiry:a}}function _fed54b2(e,t,o){return{CE:_f80bbd0(e,o),PE:_f80bbd0(t,o)}}function _f954b23(e,t,o){const i=e,a=_f7086f4(i,"OPT"),n=void 0===o?a[0]:o,r=i+"|"+n,s=mapByNameExpiryCE.get(r),l=mapByNameExpiryPE.get(r);if(s&&0!==s.length)return{expiry:n,CE:_f80bbd0(s,t),PE:_f80bbd0(l,t)}}function _f80bbd0(e,t){if(!e||0===e.length)return;let o=e[0],i=Math.abs(Number(o.strike)-t);for(let a=1;a<e.length;a++){const n=Number(e[a].strike),r=Math.abs(n-t);r<i&&(o=e[a],i=r)}return o}function _f9e6bd5(e,t,o){if(!e)return"Unknown";if(!e.instrument_type)return e.Name;let i="",a="",n="",r=e.name;if(e.expiry&&"FUT"!==e.instrument_type){const o=new Date(e.expiry);a=t?o.getDate()+"<span class='numberOrdinal'>"+ordinal_suffix_of(o.getDate())+"</span>":o.getDate()+ordinal_suffix_of(o.getDate()),n=o.toLocaleString("en-US",{month:"short"}).toUpperCase(),i+=`${r} ${a} ${n} ${e.strike%1==0?Math.trunc(e.strike):e.strike} ${e.instrument_type}`}else"FUT"===e.instrument_type?i+=`${r} ${new Date(e.expiry).toLocaleString("en-US",{month:"short"}).toUpperCase()} FUT`:i+=e.tradingsymbol;return o&&(i+='<span class="exchange text-xxsmall span-text-right">'+e.exchange+"</span>"),i}function _fda88a8(e,t){const o=e;let i=underlyingMapping.find((t=>t.FoName==e));if(null!=i)return i.InstrumentToken;if("MCX"!=t&&"SILVER"!=e){const e=eqMapByName.get(o);if(void 0!==e)return e.instrument_token}return i=_f282674(o),null!=i?i.instrument_token:void 0}function _ffd9157(e){let t=freezeMapping.find((t=>t.Name==e));if(null!=t)return t.FreezeQuantity}function _fac2369(e){let t=underlyingMapping.find((t=>t.Name==e));return null!=t?t.FoName:e}function _f19a49c(e){const t=_f9fc74f("FUT",e);if(t&&0!==t.length)return t.sort(((e,t)=>new Date(e.expiry)-new Date(t.expiry))),t}function _f282674(e){const t=_f9fc74f("FUT",e);if(t&&0!==t.length)return t.sort(((e,t)=>new Date(e.expiry)-new Date(t.expiry))),t[0]}function _f6bd5ff(e){if(!mcxMultiplierMapping||!Array.isArray(mcxMultiplierMapping))return!1;const t=mcxMultiplierMapping.find((t=>t.symbol===e));return!(!t||!t.hasOptions)}function _f7086f4(e,t){const o=e+"|"+t,i=expiryListCacheMap.get(o);if(i)return i;const a=getISTTimeStamp(),n=new Set;if("FUT"===t){const t=mapByInstTypeAndName.get("FUT");if(t){const o=t.get(e);if(o)for(let e=0;e<o.length;e++){const t=o[e].expiry;(new Date(t).getTime()-a)/36e5>=-27&&n.add(t)}}}else{const t=mapByInstTypeAndName.get("CE"),o=mapByInstTypeAndName.get("PE"),i=t?t.get(e):null,r=o?o.get(e):null;if(i)for(let e=0;e<i.length;e++){const t=i[e].expiry;(new Date(t).getTime()-a)/36e5>=-27&&n.add(t)}if(r)for(let e=0;e<r.length;e++){const t=r[e].expiry;(new Date(t).getTime()-a)/36e5>=-27&&n.add(t)}}const r=Array.from(n).sort();return expiryListCacheMap.set(o,r),r}async function _fb5b18c(e,t){for(let o=0;o<localMcxMultiplierMapping.length;o++){const i=localMcxMultiplierMapping[o];if(i.name==e)return void(i.multiplier!=t&&(i.multiplier=t,await setSyncStorage("commodityMultiplierMappingKey",localMcxMultiplierMapping)))}localMcxMultiplierMapping.push({name:e,multiplier:t})}function _f9b6bef(e){for(let t=0;t<localMcxMultiplierMapping.length;t++){const o=localMcxMultiplierMapping[t];if(o.name==e)return o.multiplier}for(let t=0;t<mcxMultiplierMapping.length;t++){const o=mcxMultiplierMapping[t];if(o.symbol==e){const e=parseFloat(o.mcxMultiplier);return Number.isFinite(e)&&e>0?e:1}}return 1}function _f7817ef(e,t){let o=[],i=_ff682a4(e),a=new Date(t);for(let e=0;e<i.length;e++){const t=i[e];let n=new Date(t.expiry);a.getMonth()==n.getMonth()&&o.push(t)}return o}function _f67f12c(e,t,o){return o?_f2960dd(e,t):_fd70ac7(e,t)}let tickSocket,tokenExchangeCache=[];function _fbb4a42(e){for(let t=0;t<tokenExchangeCache.length;t++)if(tokenExchangeCache.instrument_token==e){if(CURRENT_BROKER==KOTAK_BROKER)return tokenExchangeCache.neoExchange;if(CURRENT_BROKER==JAINAM_BROKER)return tokenExchangeCache.exchange}let t=underlyingMapping.find((t=>t.InstrumentToken==e));if(null!=t)return t.Exchange;let o=_f585a16(e);if(o){if(CURRENT_BROKER==KOTAK_BROKER)return tokenExchangeCache.push({instrument_token:o.instrument_token,neoExchange:o.neoExchange}),o.neoExchange;if(CURRENT_BROKER==JAINAM_BROKER)return tokenExchangeCache.push({instrument_token:o.instrument_token,exchange:o.exchange}),o.exchange}}let lastMessageTime=0,tokenSet_PendingUnSub=[],tokenSet_Global=[],tokenSet_Positions=[],tokenSet_Baskets=[],tokenSet_OrderPlacement=[],tokenSet_IndexMeta=[],tokenSet_Watchlist=[];function _f1aa9f7(){tokenSet_Global=Object.values(tokenMapping).flat(),_f1b4de4()}function _f022acf(){return!0}function _fe35a90(e,t){if(!isReal)for(let t=0;t<e.length;t++)_f585a16(e[t],"",null)}let tokenMapping={},POSITION_TOKEN_KEY="positionToken",BASKET_TOKEN_KEY="basketToken",INDEX_META_TOKEN_KEY="indexToken",WATCHLIST_TOKEN_KEY="watchlistToken",CUSTOM_WATCHLIST_TOKEN_KEY="customWatchlistToken",ORDER_PLACEMENT_TOKEN_KEY="orderPlacementToken";function _fa6c293(){tokenMapping[POSITION_TOKEN_KEY]=[],tokenMapping[BASKET_TOKEN_KEY]=[],tokenMapping[INDEX_META_TOKEN_KEY]=[],tokenMapping[WATCHLIST_TOKEN_KEY]=[],tokenMapping[CUSTOM_WATCHLIST_TOKEN_KEY]=[],tokenMapping[ORDER_PLACEMENT_TOKEN_KEY]=[]}function _f948f43(e,t){const o=new Set;for(const[t,i]of Object.entries(tokenMapping))if(t!==e)for(const e of i)o.add(e);return t.filter((e=>!o.has(e)))}function _f1b3dea(){let e=JSON.parse(JSON.stringify(tokenMapping));tokenMapping={},_fa6c293(),Object.keys(e).forEach((t=>{_f7d8e25(t,e[t])}))}function _f7d8e25(e,t){if(!_f022acf()||0==t.length)return;let o=(t=[...new Set(t)]).filter((t=>!tokenMapping[e].includes(t)));tokenMapping[e].push(...o),e==ORDER_PLACEMENT_TOKEN_KEY&&_fbf5033(o);let i=_f948f43(e,o),a=t.filter((e=>!i.includes(e))),n=[];for(let e=0;e<a.length;e++)_f902c2b(a[e])||n.push(a[e]);n.length>0&&i.push(...n),_f1aa9f7(),0!=i.length&&(_facd64c(i,modeFull),_fe4bff2(i),_fe35a90(i,!0))}function _f7ff8c5(e,t){if(!_f022acf())return;let o=[];o=null==t?tokenMapping[e]:t,e==ORDER_PLACEMENT_TOKEN_KEY&&(_f7b02de(),_feb7b6a(tokenMapping[e]));let i=_f948f43(e,o);tokenSet_PendingUnSub=[...tokenSet_PendingUnSub,...i],tokenMapping[e]=tokenMapping[e].filter((e=>!o.includes(e))),_f1aa9f7(),_f544c9d(i),_f2653ea(i),_fe35a90(i,!1)}async function _f92cdb0(){for(;isAppActive;){if(_f022acf()){const e=Object.values(tokenMapping).flat();let t=tokenSet_PendingUnSub.filter((t=>!e.includes(t))),o=[...new Set(t)];t.length>0&&(_f544c9d(o),_f2653ea(o),_fe35a90(o,!1),_f1aa9f7()),tokenSet_PendingUnSub=[]}await delay(5e3)}}const marginSetUpdate=new Event("kc_MarginSetUpdate"),orderSetUpdateEvent=new Event("kc_OrderSetUpdate"),positionUpdateEvent=new Event("kc_PositionUpdate"),orderUpdateEvent=new CustomEvent("kc_OrderUpdate",{detail:{data:""}}),riskFreeInterest=0,kiteEquityCashFreezeLimit=1e5,mainUnderlyingCount=3,kitePlusFOExchanges=["NFO","BFO","MCX"],kitePlusExchanges=["NSE","BSE","NFO","BFO","MCX"],defaultSearchInstruments=["NIFTY","BANKNIFTY","SENSEX","FINNIFTY","MIDCPNIFTY","BANKEX"],enumNFO="NFO",enumBFO="BFO",enumNSE="NSE",modeFull="full",modeQuote="quote",modeLTP="ltp",mSubscribe="subscribe",mUnSubscribe="unsubscribe",mSetMode="mode",NEO_CASH_ORDER_TYPES=[{name:"CNC",displayName:"CASH"},{name:"MIS",displayName:"MIS"},{name:"MTF",displayName:"MTF"}],NEO_FO_ORDER_TYPES=[{name:"NRML",displayName:"NRML"},{name:"MIS",displayName:"MIS"}],JAINAM_CASH_ORDER_TYPES=[{name:"CNC",displayName:"CNC"},{name:"MIS",displayName:"MIS"},{name:"MTF",displayName:"MTF"}],JAINAM_FO_ORDER_TYPES=[{name:"NRML",displayName:"NRML"},{name:"MIS",displayName:"MIS"}];let ACTIVE_CASH_ORDER_TYPES,ACTIVE_FO_ORDER_TYPES;const monthConst=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],NseCM=1,NseFO=2,NseCD=3,BseCM=4,BseFO=5,BseCD=6,McxFO=7,McxSX=8,Indices=9;let keyToken="",uID="",isOrderSetUpdating=!1,orderSetBufferCounter=0,positionSetBufferCounter=0,marginSetBufferCounter=0,totalCounter=0;function _fd8ef07(){CURRENT_BROKER==KOTAK_BROKER?(ACTIVE_CASH_ORDER_TYPES=NEO_CASH_ORDER_TYPES,ACTIVE_FO_ORDER_TYPES=NEO_FO_ORDER_TYPES):(ACTIVE_CASH_ORDER_TYPES=JAINAM_CASH_ORDER_TYPES,ACTIVE_FO_ORDER_TYPES=JAINAM_FO_ORDER_TYPES)}function _fad67f2(e){const t=ACTIVE_CASH_ORDER_TYPES.find((t=>t.name===e));if(t)return t.displayName;const o=ACTIVE_FO_ORDER_TYPES.find((t=>t.name===e));return o?o.displayName:e}async function _f66a6ca(){totalCounter++,0==orderSetBufferCounter&&(document.dispatchEvent(orderSetUpdateEvent),_fa93f63("updating order Set Zero")),orderSetBufferCounter++,await delay(1e3),orderSetBufferCounter--,1==orderSetBufferCounter&&(document.dispatchEvent(orderSetUpdateEvent),_fa93f63("updating order Set Zero"))}async function _fa455bb(){0==positionSetBufferCounter&&document.dispatchEvent(positionUpdateEvent),positionSetBufferCounter++,await delay(400),positionSetBufferCounter--,1==positionSetBufferCounter&&document.dispatchEvent(positionUpdateEvent)}async function _ff7b78b(){marginSetBufferCounter++,await delay(1e3),marginSetBufferCounter--,0==marginSetBufferCounter&&document.dispatchEvent(marginSetUpdate)}async function _fbc7eab(e){orderUpdateEvent.detail.message="new order",document.dispatchEvent(orderUpdateEvent)}async function _fd9263a(){for(;isAppActive;){let e=getISTTimeStamp(),t=new Date(e),o=60*t.getUTCHours()+t.getUTCMinutes();isTradingHours=!(o<540||o>930),await delay(1e4)}}const kNotificationQueue=[],MAX_VISIBLE_NOTIFICATIONS=3;let visibleNotifications=0;function _f2d3a88(e,t,o="info",i=4e3){const a={header:e,message:t,type:o,duration:i};kNotificationQueue.push(a),_f065c34()}function _f065c34(){if(visibleNotifications>=MAX_VISIBLE_NOTIFICATIONS||0===kNotificationQueue.length)return;const{header:e,message:t,type:o,duration:i}=kNotificationQueue.shift();visibleNotifications++;const a=document.getElementById("kNotificationContainer");a.insertAdjacentHTML("beforeend",notificationBlock);let n=a.querySelector(".just-added");n.classList.toggle(o,!0),n.querySelector(".k-close-btn").onclick=()=>{n.style.opacity="0",setTimeout((()=>a.removeChild(n)),300)},n.querySelector(".k-header").textContent=e,n.querySelector(".k-message").innerHTML=t,n.classList.toggle("just-added",!1),setTimeout((()=>{a.contains(n)&&_f12df70(n)}),i)}function _f12df70(e){const t=document.getElementById("kNotificationContainer");e.style.opacity="0",setTimeout((()=>{t.contains(e)&&(t.removeChild(e),visibleNotifications--,_f065c34())}),300)}let currentCharges=-1,lastHoldingFetchTimeStamp=0,lastOrderFetchTimeStamp=0,lastPositionFetchTimeStamp=0;async function _f603dc4(e){if(CURRENT_BROKER==KOTAK_BROKER)return _f7d8133(e)}async function _fa04073(e,t){return CURRENT_BROKER==KOTAK_BROKER?_ff45324(e,t):CURRENT_BROKER==JAINAM_BROKER?jainam_getBasketMargin(e,t):void 0}async function _f5da7d8(){return CURRENT_BROKER==KOTAK_BROKER?_fde86a2():CURRENT_BROKER==JAINAM_BROKER?jainam_getPositions():void 0}async function _fd328d7(){return CURRENT_BROKER==KOTAK_BROKER?_f7e3997():CURRENT_BROKER==JAINAM_BROKER?jainam_getOrders():void 0}async function _fd25cf4(e){return CURRENT_BROKER==KOTAK_BROKER?_f54d4c8(e):CURRENT_BROKER==JAINAM_BROKER?jainam_placeOrder(e):void 0}async function _fd75076(e){return CURRENT_BROKER==KOTAK_BROKER?_fe91e8e(e):CURRENT_BROKER==JAINAM_BROKER?jainam_modify(e):void 0}async function _f02bd32(e){return CURRENT_BROKER==KOTAK_BROKER?_f3e2dbf(e):CURRENT_BROKER==JAINAM_BROKER?jainam_cancelOrder(e):void 0}async function _f209348(){return CURRENT_BROKER==KOTAK_BROKER?_f47f643():CURRENT_BROKER==JAINAM_BROKER?jainam_getMargin():void 0}function _fbf5033(e){if(CURRENT_BROKER==KOTAK_BROKER)return _f6269f1(e)}function _f7b02de(){if(CURRENT_BROKER==KOTAK_BROKER)return _f6a32e8()}function _fe798c9(e,t){return CURRENT_BROKER==KOTAK_BROKER?{series:"EQ"==e.inst.segment?"EQ":"",exgSeg:e.inst.neoExchange,readableExpiryDate:"EQ"==e.inst.instrument_type?null:convertDateToMMMFormat(e.inst.expiry),strikePrice:"EQ"==e.inst.instrument_type?0:e.inst.strike,optType:e.inst.instrument_type,direction:e.isSell?"SELL":"BUY",unitPrice:e.ltp,qty:e.isSell?-Math.abs(e.quantity):Math.abs(e.quantity),ltp:e.ltp,exgIdentifier:JSON.parse(e.inst.instrument_token),isMktOrder:!0,symbol:e.inst.name,productType:t?"NRML":"MIS"}:CURRENT_BROKER==JAINAM_BROKER?{exchange:e.inst.exchange,openOrderQty:Math.abs(e.quantity),orderFlag:"NEW",orderType:"Regular",price:e.ltp,product:t?"NRML":"MIS",priceType:"MKT",qty:Math.abs(e.quantity),stopLoss:0,token:e.inst.instrument_token,tradingSymbol:e.inst.jaiTradeSymbol,transType:e.isSell?"S":"B",triggerPrice:0}:void 0}function _fec7436(e){return CURRENT_BROKER==KOTAK_BROKER?{series:"EQ"==e.inst.segment?"EQ":"",exgSeg:e.inst.neoExchange,readableExpiryDate:"EQ"==e.inst.instrument_type?null:convertDateToMMMFormat(e.inst.expiry),strikePrice:"EQ"==e.inst.instrument_type?0:e.inst.strike,optType:"EQ"==e.inst.instrument_type?null:e.inst.instrument_type,direction:e.isSell?"SELL":"BUY",unitPrice:e.ltp,qty:e.isSell?-Math.abs(e.quantity):Math.abs(e.quantity),ltp:e.ltp,exgIdentifier:JSON.parse(e.inst.instrument_token),isMktOrder:!0,symbol:e.inst.name,productType:e.dayOrderType}:CURRENT_BROKER==JAINAM_BROKER?{exchange:e.inst.exchange,openOrderQty:Math.abs(e.quantity),orderFlag:"NEW",orderType:"Regular",price:e.price,product:e.dayOrderType,priceType:convertOrderTypeToJainam(e.orderPriceType),qty:Math.abs(e.quantity),stopLoss:0,token:e.inst.instrument_token,tradingSymbol:e.inst.jaiTradeSymbol,transType:e.isSell?"S":"B",triggerPrice:e.triggerPrice}:void 0}function _fde8639(e){if(CURRENT_BROKER==KOTAK_BROKER)return{series:"",exgSeg:e.inst.neoExchange,readableExpiryDate:convertDateToMMMFormat(e.inst.expiry),strikePrice:e.inst.strike,optType:e.inst.instrument_type,direction:e.isSell?"SELL":"BUY",unitPrice:e.ltp,qty:e.isSell?-Math.abs(e.quantity):Math.abs(e.quantity),ltp:e.ltp,exgIdentifier:JSON.parse(e.inst.instrument_token),isMktOrder:!0,symbol:e.inst.name,productType:e.isNRML?"NRML":"MIS"}}let orderCheckCounter=0;async function _f7a2f20(e=!1){orderCheckCounter++;let t=orderCheckCounter;await delay(e?30:5e3),t==orderCheckCounter&&getISTTimeStamp()-lastOrderFetchTimeStamp>5e3&&_fd328d7()}let positionCheckCounter=0;async function _f6fae33(e=!1){positionCheckCounter++;let t=positionCheckCounter;await delay(e?30:5e3),t==positionCheckCounter&&getISTTimeStamp()-lastPositionFetchTimeStamp>5e3&&_f5da7d8()}let logMessageData=[],lastLogCleanTimeStamp=0,isLogEnabled=!1;async function _f0ac449(){isLogEnabled=await _fb3ac9d("prefLogMessageKey",isLogEnabled),logMessageData=await _fb3ac9d("logMessageDataKey",logMessageData),lastLogCleanTimeStamp=await _fb3ac9d("lastLogCleanTimeStampKey",lastLogCleanTimeStamp);let e=getISTTimeStamp();if(e>lastLogCleanTimeStamp+864e5){lastLogCleanTimeStamp=e;let t=new Date(e);t.setUTCHours(8,15,0),lastLogCleanTimeStamp=t.getTime(),await setSyncStorage("lastLogCleanTimeStampKey",lastLogCleanTimeStamp),logMessageData=[],await setSyncStorage("logMessageDataKey",logMessageData)}}async function _fa93f63(e){if(!isLogEnabled)return;let t=getTimeForLog(new Date)+","+instanceCounter+","+e;logMessageData.push(t),await setSyncStorage("logMessageDataKey",logMessageData)}let neo_root_url="https://mis.kotaksecurities.com/quick/user",neo_userMargins_endpoint="/limits",neo_userPositions_endpoint="/positions";const neo_order_placement_url_web="https://mis.kotaksecurities.com/quick/order/rule/ms/place?sId=",neo_cancel_order_url_web="https://mis.kotaksecurities.com/quick/order/cancel?sId=",neo_modify_order_url_web="https://mis.kotaksecurities.com/quick/order/vr/modify?sId=&";let neo_order_placement_url=neo_order_placement_url_web,neo_cancel_order_url=neo_cancel_order_url_web,neo_modify_order_url=neo_modify_order_url_web,neo_orderList_url="https://mis.kotaksecurities.com/quick/user/orders?sId=&requestId=",neo_holdings_url="https://neo.kotaksecurities.com/api/portfolio/v2/holdings",neo_basket_margin_url="https://neo.kotaksecurities.com/api/margin/v2?include_position=false&hsServerId=&dc=",neo_charges_url="https://neo.kotaksecurities.com/api/brokerage/charges";const neo_orders_socket_url="wss://mis.kotaksecurities.com/realtime?sId=",neo_price_socket_url="wss://cdtstream.kotaksecurities.com/mfeed",neo_instruments_file_url="https://gw-napi.kotaksecurities.com/Files/1.0/masterscrip/v2/file-paths",neo_base64KeyName="FlutterSecureStorage",neo_authTokenKeyName="FlutterSecureStorage.neo_user_token_key",neo_userDataCenterKeyName="FlutterSecureStorage.neo_user_data_center",neo_handShakeIDKeyName="FlutterSecureStorage.neo_hs_server_id_key",neo_requestIDKeyName="FlutterSecureStorage.neo_rid_key",neo_userDetailsKeyName="FlutterSecureStorage.neo_users_details",neo_sidKeyName="FlutterSecureStorage.neo_user_sid_key",neo_userIDKeyName="FlutterSecureStorage.neo_user_id_key",neo_userID_UCC_KeyName="FlutterSecureStorage.neo_user_id_ucc_key",neo_appVersionKeyName="flutter.appVersion";let neoTradeApi_token="5da23633-87ae-439f-826e-75ecd55f20d6",neo_AppVersion="2.0",neo_AuthToken="",neo_sid_value="",neo_requestID="2",neo_userID="",neo_userID_ucc="",neo_handShakeID="",neo_dataCenterID="",neo_accountId="",neo_KotakUserID="",neo_PhoneNumber="",neo_userDetails="",neo_stored_holdings=[],neoApiLoginCounter=0,isNeoTradeApiMode=!1;async function _f672f3c(e){return localStorage.getItem(e)}async function _ffa55c9(e){let t=localStorage.getItem(neo_base64KeyName),o=localStorage.getItem(e);try{return await _f90d669(o,t)}catch(e){return null}}async function _fa31220(){for(;!await _ff23d18();)await delay(10);return!0}async function _ff23d18(){if(isNeoTerminalMode)return isValidNeoTradeSession;{const e=await _ffa55c9(neo_authTokenKeyName);return"string"==typeof e&&""!==e.trim()&&(neo_AuthToken=e,!0)}}function _fef06af(){let e=neoTradeAuthObject.baseUrl;neo_root_url=e+"/quick/user",neo_userMargins_endpoint="/limits",neo_userPositions_endpoint="/positions",neo_order_placement_url=e+"/quick/order/rule/ms/place",neo_cancel_order_url=e+"/quick/order/cancel",neo_modify_order_url=e+"/quick/order/vr/modify",neo_orderList_url=e+"/quick/user/orders",neo_holdings_url=e+"/portfolio/v1/holdings",neo_basket_margin_url="https://neo.kotaksecurities.com/api/margin/v2?include_position=false&hsServerId=&dc=",neo_charges_url="https://neo.kotaksecurities.com/api/brokerage/charges"}function _fef3d30(){let e=neoTradeAuthObject.baseUrl;neo_order_placement_url=e+"/quick/order/rule/ms/place",neo_cancel_order_url=e+"/quick/order/cancel",neo_modify_order_url=e+"/quick/order/vr/modify"}function _f580b17(){neo_order_placement_url=neo_order_placement_url_web,neo_modify_order_url=neo_modify_order_url_web,neo_cancel_order_url=neo_cancel_order_url_web}async function _f31a0d6(){const e=new Date(getISTTimeStamp()),t=new Date(e);t.setUTCHours(23,59,59,999),e>t&&t.setUTCDate(t.getUTCDate()+1);const o=t-e+6e4;await delay(o),isAppActive&&location.reload()}async function _f5f1eb1(){for(_f31a0d6(),new Date(getISTTimeStamp()).getUTCDate();isAppActive;){let e=await _ff23d18();e||(await delay(2e3),e=await _ff23d18(),e||_f6a974b()),await delay(2e3)}}async function _fb50f02(){if(isNeoTerminalMode&&(neo_KotakUserID=neoTradeAuthObject.clientCode),isNeoTerminalMode)return;neo_AuthToken=await _ffa55c9(neo_authTokenKeyName),neo_sid_value=await _ffa55c9(neo_sidKeyName),neo_userID=await _ffa55c9(neo_userIDKeyName),neo_userID_ucc=await _ffa55c9(neo_userID_UCC_KeyName),neo_requestID=1,neo_handShakeID=await _ffa55c9(neo_handShakeIDKeyName),neo_dataCenterID=await _ffa55c9(neo_userDataCenterKeyName),neo_userDetails=await _ffa55c9(neo_userDetailsKeyName),neo_AppVersion=await _f672f3c(neo_appVersionKeyName);let e=JSON.parse(neo_userDetails),t=Object.keys(e);for(let o=0;o<t.length;o++){const i=t[o];i==neo_userID&&null!=e[i].userDetailsResponse&&(neo_accountId=i,neo_KotakUserID=e[i].userDetailsResponse.ucc,neo_PhoneNumber=e[i].userDetailsResponse.phone)}}async function _fb3699e(){_f758b99(),await _fa31220(),_f92cdb0(),await _fb50f02(),kitePlusUserInfo.userID=neo_KotakUserID,_fcef30f(),neoApiLoginCounter=await _fb3ac9d("neoApiLoginCounter",neoApiLoginCounter),lastHoldingFetchTimeStamp=await _fb3ac9d("lastHoldingFetchTimeStamp",lastHoldingFetchTimeStamp),neo_stored_holdings=await _fb3ac9d("neo_stored_holdings",neo_stored_holdings);let e=new Date(lastHoldingFetchTimeStamp);if(new Date(getISTTimeStamp()).getUTCDate()!=e.getUTCDate()||0==neo_stored_holdings.length){let e=await _ff05291();-1!=e&&(await setSyncStorage("lastHoldingFetchTimeStamp",getISTTimeStamp()),neo_stored_holdings=e.data,await setSyncStorage("neo_stored_holdings",neo_stored_holdings))}else!async function(){let e=await _ff05291();-1!=e&&(await setSyncStorage("lastHoldingFetchTimeStamp",getISTTimeStamp()),neo_stored_holdings=e.data,await setSyncStorage("neo_stored_holdings",neo_stored_holdings))}();return document.addEventListener("kc_OrderUpdate",(function(e){})),document.addEventListener("kc_PositionUpdate",(function(e){_f5da7d8()})),document.addEventListener("kc_OrderSetUpdate",(function(e){_fd328d7()})),!0}function _f265060(e){let t={accept:"*/*","content-type":"application/x-www-form-urlencoded",sid:neo_sid_value};return e?(t.Auth=neoTradeAuthObject.viewToken,t.sid=neoTradeAuthObject.sid,t["neo-fin-key"]="neotradeapi"):(t.authorization=neo_AuthToken,t.sid=neo_sid_value),t}async function _f47f643(e=0,t=5){const o=encodeURIComponent(JSON.stringify({seg:"ALL",exch:"ALL",prod:"ALL"}));let i,a=_f265060(isNeoTradeApiMode),n=neo_root_url+neo_userMargins_endpoint+"?sId=&requestId="+neo_requestID,r=`jData=${o}`;if(isNeoTradeApiMode?(n=neo_root_url+neo_userMargins_endpoint,i=await _f37910e(n,!0,a,r,!1)):i=await fetchNetworkCall(n,!0,a,r,!1),i.ok)return i.data;if(-1==await _f2ba398(i))return-1;if(e<t){const o=500;return await delay(o),await _f47f643(e+1,t)}return-1}async function _f3e2dbf(e){const t={on:e.orderID};let o,i=_f265060(isNeoTradeApiMode),a=neo_cancel_order_url+"&requestId="+neo_requestID,n=`jData=${encodeURIComponent(JSON.stringify(t))}`;if(isNeoTradeApiMode?(a=neo_cancel_order_url,o=await _f37910e(a,!0,i,n,!1)):(a=(neo_dataCenterID?neo_cancel_order_url_web.replace("mis.",neo_dataCenterID.toLowerCase()+"."):neo_cancel_order_url_web)+"&requestId="+neo_requestID,o=await fetchNetworkCall(a,!0,i,n,!1)),o.ok){const e=o.data;return _f7a2f20(),e}return await _f2ba398(o),-1}async function _fe91e8e(e){"MARKET"==e.order_type&&(e.price="0");const t={au:"open",sr:e.underlyingName,tk:e.instrument_token,fq:"0",pc:e.product,dd:"NA",dq:"0",ai:neo_accountId,vd:"DAY",ts:e.inst.neoTradeSymbol,tt:e.transaction_type.slice(0,1),pr:"string"==typeof e.price?e.price:String(e.price),tp:"0.0",no:e.orderID,qt:JSON.stringify(e.quantity),es:_fb7dbe4(e.exchange),pt:_fa185fb(e.order_type),od:"",mp:"0",rq:"1"};let o,i=_f265060(isNeoTradeApiMode||isNeoHybridlMode&&isValidNeoTradeSession),a=neo_modify_order_url+"&requestId="+neo_requestID,n=`jData=${encodeURIComponent(JSON.stringify(t))}`;if(isNeoTradeApiMode||isNeoHybridlMode&&isValidNeoTradeSession)a=neo_modify_order_url,o=await _f37910e(a,!0,i,n,!1);else{if(prefForceNeoTradeAPI.key)return{statusCode:301,message:"Not a valid Trade API sessoin token! Try loggin again."};a=(neo_dataCenterID?neo_modify_order_url_web.replace("mis.",neo_dataCenterID.toLowerCase()+"."):neo_modify_order_url_web)+"&requestId="+neo_requestID,o=await fetchNetworkCall(a,!0,i,n,!1)}let r={statusCode:301,message:"Error! Try again"};if(o.ok){const e=o.data;if(e.stCode&&200==e.stCode)return r.statusCode=200,_f7a2f20(),r}else if(-1==await _f2ba398(o))return r;return r}async function _f54d4c8(e){"MARKET"==e.order_type&&(e.price="0");const t={ai:neo_accountId,bc:"1",cf:"",dd:"NA",dq:"0",es:_fb7dbe4(e.exchange),mp:"0",mq:"0",nc:"",os:"WEB",pa:"BO:BO||CNC:CNC||CO:CO||NRML:NRML",pc:e.product,pf:"N",pr:"string"==typeof e.price?e.price:String(e.price),pt:_fa185fb(e.order_type),ot:"",qt:JSON.stringify(e.quantity*(e.multiplier??1)),rt:"DAY",tk:"",tp:e.trigger_price,ts:e.inst.neoTradeSymbol,tt:e.transaction_type.slice(0,1),ur:"",ut:"WEB",cl:"0",od:"",slv:"",sot:"",slt:"",sov:"",lat:"",tlt:"N",tsv:"0",ig:""};let o,i=_f265060(isNeoTradeApiMode||isNeoHybridlMode&&isValidNeoTradeSession),a=neo_order_placement_url+"&requestId="+neo_requestID,n=`jData=${encodeURIComponent(JSON.stringify(t))}`;if(isNeoTradeApiMode||isNeoHybridlMode&&isValidNeoTradeSession)a=neo_order_placement_url,o=await _f37910e(a,!0,i,n,!1);else{if(prefForceNeoTradeAPI.key)return{statusCode:301,message:"Not a valid Trade API sessoin token! Try loggin again."};a=(neo_dataCenterID?neo_order_placement_url_web.replace("mis.",neo_dataCenterID.toLowerCase()+"."):neo_order_placement_url_web)+"&requestId="+neo_requestID,o=await fetchNetworkCall(a,!0,i,n,!1)}let r={statusCode:301,message:"Error! Try again"};if(o.ok){if(200==o.data.stCode)return r.statusCode=200,_f7a2f20(),"MKT"==t.pt&&_f6fae33(),r}else try{if(null!=o.data){const e=o.data;"Not_Ok"===e.stat&&(r.message=e.errMsg)}}catch(e){}return r}async function _ff05291(e=5,t=1e3){for(let o=1;o<=e;o++){try{let e,t=_f265060(isNeoTradeApiMode),o=neo_holdings_url;if(e=isNeoTradeApiMode?await _f37910e(o,!1,t,!1,!1):await fetchNetworkCall(o,!1,t,!1,!1),e.ok)return e.data;{const t=e.data;if(424==t?.error?.[0]?.code)return-1}}catch(e){}o<e&&await new Promise((e=>setTimeout(e,t)))}return-1}let isApiChargesRunning=!1,lastParsedOrderList=[];async function _fd8e657(e=0,t=3){if(isApiChargesRunning)return null;isApiChargesRunning=!0;let o=[],i=[];try{for(let e=0;e<lastFetchedOrders.length;e++){const t=lastFetchedOrders[e];if("COMPLETE"!=t.status)continue;let a=[],n=t.exchange;"BFO"==t.exchange&&(n="BSE"),"NFO"==t.exchange&&(n="NSE");let r="OPT";""==t.optionType?r="":"FUT"==t.optionType&&(r="FUT"),o.push(t),a.push(""),a.push(JSON.stringify(t.average_price)),a.push(JSON.stringify(t.quantity)),a.push("XX"==t.series||"NA"==t.series?"DERIVATIVE":t.series),a.push(t.lotSize),a.push(r),a.push("DLV"),a.push(t.transaction_type),a.push(n),a.push(t.tradingsymbol),i.push(a)}if(lastParsedOrderList.length==i.length)return;const a=JSON.stringify({data:i,no_of_records:i.length,wlsrc:"NEOTRADEAPI"});let n,r=_f265060(isNeoTradeApiMode),s=neo_charges_url,l=`${a}`;if(n=isNeoTradeApiMode?await _f37910e(s,!0,r,l,!1):await fetchNetworkCall(s,!0,r,l,!1),n.ok){const e=n.data;if(5203==e.stCode)return isApiChargesRunning=!1,-1;let t=0;lastParsedOrderList=JSON.parse(JSON.stringify(i));for(let i=0;i<e.data.response_items.length;i++){const a=e.data.response_items[i];"ADMINCPPAPI_NEOTRADEAPI"==o[i].ordSrc&&(t+=1.18*a.value_static_rates[0])}let a=e.data.sum_total_charges[6];null!=a&&(currentCharges=a-t)}else if(-1==await _f2ba398(n))return-1;if(e<t){const o=1e3;return await delay(o),await _fd8e657(e+1,t)}}catch(e){}finally{isApiChargesRunning=!1}}let isApiGetOrdersRunning=!1,lastFetchedOrders=[];async function _f7e3997(e=0,t=5){if(isApiGetOrdersRunning)return null;isApiGetOrdersRunning=!0;try{const e=encodeURIComponent(JSON.stringify({userId:neo_userID}));let t,o=_f265060(isNeoTradeApiMode),i=neo_orderList_url+neo_requestID,a=`jData=${e}`;if(isNeoTradeApiMode?(i=neo_orderList_url,t=await _f37910e(i,!0,o,a,!1)):t=await fetchNetworkCall(i,!0,o,a,!1),t.ok){const e=t.data;if(5203==e.stCode)return isApiGetOrdersRunning=!1,-1==currentCharges&&(currentCharges=0),-1;const o=e.data.map((e=>{const t="mcx_fo"===e.exSeg?e.lotSz:1;return{placed_by:e.actId,order_id:e.nOrdNo,series:e.series,optionType:isAlphaNumericString(e.optTp)?e.optTp:"",exchange_order_id:""==e.exOrdId?e.nOrdNo:e.exOrdId,parent_order_id:"",status:"AMO"==e.ordGenTp?e.ordGenTp:_f59523e(e.stat),status_message:e.rejRsn,status_message_raw:e.rejRsn,order_timestamp:e.ordEntTm,exchange_update_timestamp:e.exCfmTm,exchange_timestamp:e.exCfmTm,variety:"regular",lotSize:e.lotSz,modified:!1,exchange:_f4fd211(e.exSeg),tradingsymbol:e.trdSym,instrument_token:e.tok,order_type:_ff8ffe2(e.prcTp),ordSrc:e.ordSrc,transaction_type:"B"==e.trnsTp?"BUY":"SELL",validity:e.vldt,product:e.prod,quantity:e.qty/t,disclosed_quantity:e.dclQty/t,price:parseFloat(e.prc),trigger_price:parseFloat(e.trgPrc),average_price:parseFloat(e.avgPrc),filled_quantity:e.fldQty/t,pending_quantity:1,cancelled_quantity:e.cnlQty/t,market_protection:e.mktPro,meta:"",tag:"",guid:e.GuiOrdId}}));return _fda5840(o),lastFetchedOrders=o,_fd8e657(),lastOrderFetchTimeStamp=getISTTimeStamp(),o}}catch(e){}finally{isApiGetOrdersRunning=!1}if(e<t){const o=1e3;return await delay(o),await _f7e3997(e+1,t)}return-1}async function _f522388(e=0,t=5){if(""==neoTradeAuthObject.baseUrl)return!1;let o,i=neoTradeAuthObject.baseUrl+"/quick/user/positions",a={accept:"*/*","content-type":"application/x-www-form-urlencoded",sid:neo_sid_value};if(a.Auth=neoTradeAuthObject.viewToken,a.sid=neoTradeAuthObject.sid,a["neo-fin-key"]="neotradeapi",o=await _f37910e(i,!0,a,!1,!1),o.ok)return o.data,!0;if(o?.data?.errMsg.includes("invalid"))return!1;if(e<t){const o=1e3;return await delay(o),await _f522388(e+1,t)}return!1}let isApiGetPositionsRunning=!1;async function _fde86a2(e=0,t=5){if(isApiGetPositionsRunning)return null;isApiGetPositionsRunning=!0,isFreshPositionLoaded=!1;try{const e=encodeURIComponent(JSON.stringify({userId:neo_userID}));let t,o=_f265060(isNeoTradeApiMode),i=neo_root_url+neo_userPositions_endpoint+"?sId=&requestId="+neo_requestID,a=`jData=${e}`;if(isNeoTradeApiMode?(i=neo_root_url+neo_userPositions_endpoint,t=await _f37910e(i,!0,o,!1,!1)):t=await fetchNetworkCall(i,!0,o,a,!1),t.ok){const e=t.data;if(5203==e.stCode){isApiGetPositionsRunning=!1;let e={day:[],net:[]};return isFreshPositionLoaded=!0,_fec0e46(e),e}isFreshPositionLoaded=!0;for(let t=0;t<e.data.length;t++){let o=e.data[t];for(let e=0;e<neo_stored_holdings.length;e++){const t=neo_stored_holdings[e];t.exchangeIdentifier==o.tok&&"NRML"==o.prod&&"EQUITY STOCK"!=t.securityType&&(o.cfSellAmt=0,o.cfBuyAmt=0,t.holdingCost<0?o.cfSellAmt=Math.abs(t.holdingCost):t.holdingCost>0&&(o.cfBuyAmt=Math.abs(t.holdingCost)))}}const o=e.data.map((e=>{const t="mcx_fo"===e.exSeg,o=t?e.lotSz:1;return{tradingsymbol:e.trdSym,exchange:_f4fd211(e.exSeg),neoExchange:e.exSeg,instrument_token:e.tok,product:e.prod,quantityMultiplier:t?1:parseFloat(e.multiplier),quantity:(parseFloat(e.cfBuyQty)+parseFloat(e.flBuyQty)-parseFloat(e.cfSellQty)-parseFloat(e.flSellQty))/o,overnight_quantity:(parseFloat(e.cfBuyQty)-parseFloat(e.cfSellQty))/o,overnight_price:0,overnight_value:(parseFloat(e.cfSellAmt)-parseFloat(e.cfBuyAmt))/o,multiplier:o,average_price:0,close_price:0,last_price:0,value:0,pnl:0,m2m:0,unrealised:0,realised:0,buy_quantity:(parseFloat(e.cfBuyQty)+parseFloat(e.flBuyQty))/o,buy_price:0,buy_value:parseFloat(e.buyAmt)+parseFloat(e.cfBuyAmt),buy_m2m:0,sell_quantity:(parseFloat(e.cfSellQty)+parseFloat(e.flSellQty))/o,sell_price:0,sell_value:parseFloat(e.sellAmt)+parseFloat(e.cfSellAmt),sell_m2m:0,day_buy_quantity:parseFloat(e.flBuyQty)/o,day_buy_price:0,day_buy_value:Math.max(parseFloat(e.buyAmt)-parseFloat(e.cfBuyAmt),0),day_sell_quantity:parseFloat(e.flSellQty)/o,day_sell_price:0,day_sell_value:Math.max(parseFloat(e.sellAmt)-parseFloat(e.cfSellAmt),0)}}));let i={day:o,net:o};return lastPositionFetchTimeStamp=getISTTimeStamp(),_fec0e46(i),e}}catch(e){}finally{isApiGetPositionsRunning=!1}if(e<t){const o=1e3;return await delay(o),await _fde86a2(e+1,t)}return-1}let storedMarginPositions=[];async function _f0058a0(){storedMarginPositions=[];for(let e=0;e<activePositions.length;e++){const t=activePositions[e];if(0==t.quantity)continue;let o=t.buy_quantity-t.sell_quantity,i=t.buy_value-t.sell_value,a=Math.abs(i/o);storedMarginPositions.push({series:"EQ"==t.inst.segment?"EQ":"",exgSeg:t.inst.neoExchange,readableExpiryDate:"EQ"==t.inst.instrument_type?null:convertDateToMMMFormat(t.inst.expiry),strikePrice:"EQ"==t.inst.instrument_type?0:t.inst.strike,optType:"EQ"==t.inst.instrument_type?null:t.inst.instrument_type,direction:t.isSell?"SELL":"BUY",unitPrice:a,qty:t.isSell?-Math.abs(t.quantity):Math.abs(t.quantity),ltp:a,exgIdentifier:JSON.parse(t.inst.instrument_token),isMktOrder:!0,symbol:t.inst.name,productType:t.product})}}async function _ff45324(e,t,o=0,i=3){let a=!0,n=e;t&&(n=[...e,...storedMarginPositions]);let r=n.reduce(((e,t)=>{let o=!1;for(let i=0;i<e.length;i++){let a=e[i];a.exgIdentifier===t.exgIdentifier&&(o=!0,a.qty+=t.qty,a.direction=a.qty<0?"SELL":"BUY")}return o||e.push(JSON.parse(JSON.stringify(t))),e}),[]);r=r.filter((e=>0!=e.qty));let s=n;s=r,await delay(10);let l=await fetch(neo_basket_margin_url+neo_dataCenterID,{headers:{accept:"*/*","content-type":"application/json",authorization:neo_AuthToken,sid:neo_sid_value},method:"POST",body:`${JSON.stringify(s)}`});if(l.ok){const e=await l.json();let o={final:{total:0}};return o.final.total=e.data.margin,o.isIncludeExistingPos=t,o}{let e=await _f2ba398(l);if("90501"==e.code&&(a=!1),-1==e)return-1}if(o<i){const t=500;return await delay(t),await _ff45324(e,a,o+1,i)}return-1}async function _f2ba398(e){try{if(null!=e.data){const t=e.data,o=t.error?.[0];return"10020"==o.code&&await _fb50f02(),o}return-1}catch(e){return-1}}async function _f7d8133(e,t=0,o=7){let i=t-3;const a=new Date((new Date).getTime()-24*(i<0?0:i)*60*60*1e3).toISOString().split("T")[0];let n,r="https://lapi.kotaksecurities.com/wso2-scripmaster/v1/prod/",s="";if("NSE"==e.toUpperCase()?s=r+a+"/transformed-v1/nse_cm-v1.csv":"BSE"==e.toUpperCase()?s=r+a+"/transformed-v1/bse_cm-v1.csv":"NFO"==e.toUpperCase()?s=r+a+"/transformed/nse_fo.csv":"BFO"==e.toUpperCase()?s=r+a+"/transformed/bse_fo.csv":"MCX"==e.toUpperCase()&&(s=r+a+"/transformed/mcx_fo.csv"),n=isNeoTradeApiMode?await _f37910e(s,!1,!1,s,!0):await fetch(s),n.ok){let t;t=isNeoTradeApiMode?n.data:await n.text();const o=Papa.parse(t,{header:!0,skipEmptyLines:!0,transformHeader:function(e){return e.replace(/^"|"$/g,"").replace(/;/g,"").trim()}});let i="NSE"==e||"BSE"==e;return o.data.filter((t=>{let o=t.pSymbolName.includes("NSETEST");return!("SO"==t.pInstType||!i&&o||i&&"EQ"!==t.pGroup||"BFO"==e&&"SF"==t.pInstType)})).map((e=>({instrument_token:e.pSymbol,tradingsymbol:i?e.pSymbolName:e.pTrdSymbol,name:e.pSymbolName,last_price:0,expiry:_f6be0bf(e.pExchSeg,e.lExpiryDate),strike:parseFloat(e.dStrikePrice)/100,tick_size:e.dTickSize,lot_size:"MCX"==e.pExchange?1:e.iLotSize,instrument_type:i?"EQ":"FO"!=e.pSegment&&"COM"!=e.pSegment||"XX"!=e.pOptionType?e.pOptionType:"FUT",segment:"EQ"==e.pGroup?"EQ":e.pInstType,exchange:_f4fd211(e.pExchSeg),neoExchange:e.pExchSeg,neoTradeSymbol:e.pTrdSymbol,freezeQty:e.lFreezeQty-1})))}if(t<o){const i=1e3;return await delay(i),await _f7d8133(e,t+1,o)}return-1}function _f6be0bf(e,t){if(-1==t)return"";let o=parseFloat(t);return"nse_fo"!=e&&"cde_fo"!=e||(o+=315513e3),new Date(1e3*o).toISOString().split("T")[0]}function _fb7dbe4(e){return"NFO"==e?"nse_fo":"BFO"==e?"bse_fo":"MCX"==e?"mcx_fo":"NSE"==e?"nse_cm":"BSE"==e?"bse_cm":e}function _f4fd211(e){return"nse_fo"==e?"NFO":"bse_fo"==e?"BFO":"mcx_fo"==e?"MCX":"nse_cm"==e?"NSE":"bse_cm"==e?"BSE":e}function _ff8ffe2(e){return"L"==e?"LIMIT":"MKT"==e?"MARKET":e}function _f59523e(e){return"complete"==e?"COMPLETE":"cancelled"==e?"CANCELLED":e}let socketOpenCounter=0;async function _fa65c23(){const e=new WebSocketManager(neo_orders_socket_url,{onOpen:t=>function(){let t=neo_AuthToken,o=neo_sid_value;isNeoTerminalMode&&(t=neoTradeAuthObject.viewToken,o=neoTradeAuthObject.sid);const i=`{type: cn, Authorization: ${t}, Sid: ${o}, src: WEB}`;e.send(i)}(),onConnect:()=>{},onReconnect:()=>{},onMessage:e=>function(e){if("connected"==e.msg)return 0!=socketOpenCounter&&(_fde86a2(),_f7e3997()),_ff7b78b(),void socketOpenCounter++;null!=e&&("position"==e.type?(_fa455bb(),logWithTime("updating positoins "+e)):(_f06c2a0(_f310787(e)),_f66a6ca(),_ff7b78b()))}(e),onDisconnect:()=>{},isBinaryMode:!1,heartbeatDelay:5e3,connectionTimeout:2e4,reconnectDelay:3e3,maxMissedPongs:2});e.connect()}function _f8a4ee2(e){const[t,o,i,a,n,r,s,l,c,u,f,d,p,m,_,y,b,g,h,S,T,w,M,k,E,C,P,N,O,I,L,R,v,x,A,D,B,F,K]=e;function W(t){const o="buy"===t?3:18,i=[];for(let t=0;t<5;t++){const a=e[o+3*t],n=e[o+3*t+1],r=e[o+3*t+2];i.push({price:a,quantity:n,orders:r})}return i}return{tradable:!0,mode:"full",instrument_token:t,last_price:i,total_buy_quantity:x,total_sell_quantity:A,last_trade_time:new Date(1e3*D).toISOString(),exchange_timestamp:new Date(1e3*D).toISOString(),depth:{buy:W("buy"),sell:W("sell")}}}function _f8b7270(e){const[t,o,i,a,n,r,s,l,c,u,f,d,p,m,_,y,b,g,h,S,T,w,M,k,E,C,P,N,O,I]=e;return{tradable:!0,mode:"full",instrument_token:t,last_price:s,average_traded_price:u,last_traded_quantity:h,total_buy_quantity:m,total_sell_quantity:_,volume_traded:y,change:T,oi:g,ohlc:{open:d,high:l,low:c,close:f},last_trade_time:new Date(1e3*S),exchange_timestamp:new Date(1e3*S),depth:{buy:[{price:i,quantity:a,orders:0}],sell:[{price:n,quantity:r,orders:0}]}}}function _f529782(e){return{tradable:!1,instrument_token:e[0],last_price:e[2],ohlc:{open:e[5],high:e[3],low:e[4],close:e[6]},change:e[10],last_trade_time:new Date(1e3*e[11])}}function _f310787(e){let t=e.data,o={token:t.tok,orderID:t.nOrdNo,orderType:_f26fc71(t.prcTp),product:t.prod,price:t.prc,averagePrice:t.avgPrc,segment:_f4fd211(t.exSeg),triggerPrice:t.trgPrc,buySellType:"S"==t.trnsTp?"SELL":"BUY",tradingSymbol:t.trdSym,validity:t.vldt,quantity:t.qty,unfilledSize:t.unFldSz,filledQuantity:t.fldQty,rejectReason:t.rejRsn,orderStatus:_f0270e4(t.ordSt)};return"OPEN"==o.orderStatus&&"MARKET"==o.orderType&&(o.orderStatus="SUCCESS"),o}async function _f90d669(e,t){const[o,i]=e.split("."),a=Uint8Array.from(atob(o),(e=>e.charCodeAt(0))),n=Uint8Array.from(atob(i),(e=>e.charCodeAt(0))),r=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),s=await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["decrypt"]),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},s,n);return(new TextDecoder).decode(l)}const signNumberFormatter=new Intl.NumberFormat("en-IN",{signDisplay:"always",minimumFractionDigits:2,maximumFractionDigits:2});function _f0270e4(e){return e.toUpperCase().includes("PENDING")?"SUCCESS":e.toUpperCase().includes("OPEN")?"PLACED":e.toUpperCase().includes("CANCELLED")?"CANCELLED":e.toUpperCase().includes("COMPLETE")?"COMPLETED":e.toUpperCase().includes("REJECTED")?"REJECTED":"SUCCESS"}function _f26fc71(e){return"L"==e?"LIMIT":"MKT"==e?"MARKET":void 0}function _fa185fb(e){return"LIMIT"==e?"L":"MARKET"==e?"MKT":"SL"==e?"SL":"SL-M"==e?"SL-M":void 0}function _f9c6a90(e){return"CE"==e?1:"PE"==e?2:"FUT"==e?3:4}function _f87d9c9(e,t){const o=document.elementFromPoint(e,t);if(!o)return;let i=1;const a=document.querySelector("flt-semantics-host");if(a){const e=getComputedStyle(a);if(e.transform&&"none"!==e.transform){const t=e.transform.match(/matrix\(([^,]+)/);t&&(i=parseFloat(t[1]))}}const n=e/i,r=t/i,s=new PointerEvent("pointerdown",{clientX:n,clientY:r,bubbles:!0,cancelable:!0,pointerType:"mouse",buttons:1}),l=new PointerEvent("pointerup",{clientX:n,clientY:r,bubbles:!0,cancelable:!0,pointerType:"mouse",buttons:0});o.dispatchEvent(s),o.dispatchEvent(l)}function _ff20b1e(e){const t=new Date(e),o=t.getDate();return`${o}${o%10==1&&11!==o?"st":o%10==2&&12!==o?"nd":o%10==3&&13!==o?"rd":"th"} ${t.toLocaleString("en-US",{month:"short"}).toUpperCase()}`}function _f845976(e){return!e||""===e.trim()}let neoPriceWebSocket,jainamPriceWebSocket,isSocketOpen=!1;async function _f8be45a(e){for(;!isSocketOpen;)await delay(50);e(!0)}async function _f3be641(){await async function(){let e={user:"",auth:isNeoTradeApiMode?neoTradeAuthObject.sid:neo_sid_value,source:"NEOWEB",platform:"Web",version:JSON.parse(neo_AppVersion)};neoPriceWebSocket=io("https://cdtstream.kotaksecurities.com/",{path:"/mfeed",transports:["websocket"],auth:e}),neoPriceWebSocket.on("connect",(()=>{isSocketOpen=!0,_f1b3dea()})),neoPriceWebSocket.on("authenticated",(async e=>{isSocketOpen=!0})),neoPriceWebSocket.on("depth",(e=>{_f3f5610(_f8a4ee2(e))})),neoPriceWebSocket.on("index",(e=>{_f3a987a(_f529782(e))})),neoPriceWebSocket.on("scrip",(e=>{_f3a987a(_f8b7270(e))})),neoPriceWebSocket.on("connect_error",(e=>{isSocketOpen=!1})),await delay(2e3)}()}async function _fbe3ad9(){let e;jainamPriceWebSocket=new WebSocketManager("wss://ws.jainam.in/NorenWSTP/",{onOpen:t=>async function(){jainamPriceWebSocket.send({susertoken:jainam_suserToken,t:"c",actid:jainam_userID+"_WEB",uid:jainam_userID+"_WEB",source:"WEB"}),clearInterval(e),e=setInterval((()=>{jainamPriceWebSocket.readyState===WebSocket.OPEN&&jainamPriceWebSocket.send({t:"h",k:""})}),5e4)}(),onConnect:()=>{},onReconnect:()=>{},onMessage:e=>function(e){let t;try{t=JSON.parse(e)}catch{return}switch(t.t){case"ck":"OK"==t.s&&(isSocketOpen=!0,_f1b3dea());break;case"tk":case"tf":case"dk":case"df":_f3a987a(parseJainamTickData(t))}}(e),onDisconnect:()=>{},isBinaryMode:!0,heartbeatDelay:-1,connectionTimeout:2e4,reconnectDelay:3e3,maxMissedPongs:2}),jainamPriceWebSocket.connect()}let tokenSet_OrderPlaceDepth=[];function _f6269f1(e){let t=e;tokenSet_OrderPlaceDepth.push(...t),_facd64c(t,"modeDepth")}function _f6a32e8(){let e="",t="";for(let o=0;o<tokenSet_OrderPlaceDepth.length;o++){const i=tokenSet_OrderPlaceDepth[o];let a=_fbb4a42(i);/^\d+$/.test(i)?e+=a+"|"+i+",":t+=a+"|"+i+","}e&&(e=e.slice(0,-1),neoPriceWebSocket.emit("unsubscribeDepth",{inputtoken:e,json:"false"})),tokenSet_OrderPlaceDepth=[]}function _facd64c(e,t){CURRENT_BROKER==KOTAK_BROKER?_f7220fa(e,t):CURRENT_BROKER==JAINAM_BROKER&&_f552833(e,t)}function _f7220fa(e,t){let o="",i="";for(let t=0;t<e.length;t++){const a=e[t];let n=_fbb4a42(a);/^\d+$/.test(a)?o+=n+"|"+a+",":i+=n+"|"+a+","}if(o){if(o=o.slice(0,-1),"modeDepth"==t)return void neoPriceWebSocket.emit("subscribeDepth",{inputtoken:o,json:"false"});neoPriceWebSocket.emit("subscribeScrips",{inputtoken:o,json:"false"})}i&&(i=i.slice(0,-1),neoPriceWebSocket.emit("subscribeIndices",{inputtoken:i,json:"false"}))}function _f552833(e,t){let o=[];for(let t=0;t<e.length;t++){const i=e[t],a=_fbb4a42(i);o.push(a+"|"+i)}const i={t:"d",k:o.join("#")};jainamPriceWebSocket.send(i)}function _f544c9d(e){CURRENT_BROKER==KOTAK_BROKER?_ff5235a(e):CURRENT_BROKER==JAINAM_BROKER&&_f25884b(e)}function _ff5235a(e){let t="",o="";for(let i=0;i<e.length;i++){const a=e[i];let n=_fbb4a42(a);/^\d+$/.test(a)?t+=n+"|"+a+",":o+=n+"|"+a+","}t&&(t=t.slice(0,-1),neoPriceWebSocket.emit("unsubscribeScrips",{inputtoken:t,json:"false"})),o&&(o=o.slice(0,-1),neoPriceWebSocket.emit("unsubscribeIndices",{inputtoken:o,json:"false"}))}function _f25884b(e){let t=[];for(let o=0;o<e.length;o++){const i=e[o],a=_fbb4a42(i);t.push(a+"|"+i)}const o={t:"u",k:t.join("#")};jainamPriceWebSocket.send(JSON.stringify(o))}let neoTradeAuthObject={isLoggedIn:!1,authToken:"",mobileNumber:"",clientCode:"",totp:"",viewToken:"",sid_s1:"",mpin:"",tradingToken:"",sid:"",qrKey:"",baseUrl:""},nTa={neoTradeAuthWindowParent:void 0,validSessionElement:void 0,inValidSessionElement:void 0,mobileNumberInputElement:void 0,clientCodeInputElement:void 0,totpInputElement:void 0,loginInputParent:void 0,warningErrorElement:void 0,neoTradeSubmitBtn:void 0,topRightLogoutBtn:void 0,loadingSpinner:void 0},allowedBaseKotakUrl=["cis.kotaksecurities","lapi.kotaksecurities","mis.kotaksecurities","neo.kotaksecurities"];async function _f9fd387(){for(;isAppActive&&!isPrem;)await delay(100);document.querySelector(".topMenuBar .topRightMenu").style.display="block";let e=!1;document.querySelector(".wp-site-blocks")?.style.setProperty("display","none");let t=document.createElement("div");nTa.neoTradeAuthWindowParent=t,t.id="neoTradeAuthWindowParent";let o=_fa44a57("neoTradeAuthWindow");t.innerHTML=o,torpedoRoot.appendChild(t);let i=t.querySelector(".neoAuthWindowBG"),a=t.querySelector(".neoTradeAuthTotp"),n=t.querySelector(".neoTradeAuthMpin"),r=t.querySelector(".neoTradeSubmit"),s=t.querySelector(".neoTradeQrKey"),l=t.querySelector(".getTotpBtn"),c=t.querySelector(".neoTradeClose"),u=s.parentElement,f=l.parentElement;nTa.loadingSpinner=t.querySelector(".loadingSpinner"),nTa.warningErrorElement=t.querySelector(".loginInputWarningMessage"),nTa.loginInputParent=t.querySelector(".loginInputParent"),nTa.neoTradeSubmitBtn=r,nTa.totpInputElement=a,_ff0239f(!1),neoTradeAuthObject.totp="",a.value="",a.addEventListener("input",(function(){a.value=a.value.replace(/[^0-9, ]/,""),a.value.length>6&&(a.value=a.value.slice(0,6)),6==a.value.length&&r.dispatchEvent(new Event("click"))})),a.addEventListener("keydown",(function(e){"Enter"===e.key&&r.dispatchEvent(new Event("click"))})),n.addEventListener("input",(function(){n.value=n.value.replace(/[^0-9, ]/,"")})),neoTradeAuthObject=await _fb3ac9d("neoTradeAuthObject",neoTradeAuthObject);let d=t.querySelector(".neoTradeAuthTokenInput");nTa.authTokenInputElement=d,d.value=neoTradeAuthObject.authToken,d.addEventListener("change",(async function(){neoTradeAuthObject.authToken=d.value.trim(),_ff0239f(!1),_faaa046()}));let p=t.querySelector(".neoTradeAuthMobileNumber");nTa.mobileNumberInputElement=p,p.value=neoTradeAuthObject.mobileNumber,p.addEventListener("change",(async function(){neoTradeAuthObject.mobileNumber=p.value.trim(),_ff0239f(!1),_faaa046()}));let m=t.querySelector(".neoTradeAuthClientCode");nTa.clientCodeInputElement=m,m.value=neoTradeAuthObject.clientCode,m.addEventListener("change",(async function(){isNeoHybridlMode&&(m.value=neoTradeAuthObject.clientCode),neoTradeAuthObject.clientCode=m.value.trim(),_ff0239f(!1),_faaa046()})),n.value=neoTradeAuthObject.mpin,n.addEventListener("change",(async function(){neoTradeAuthObject.mpin=n.value.trim(),_ff0239f(!1),_faaa046()})),s.value=neoTradeAuthObject.qrKey,s.addEventListener("change",(async function(){neoTradeAuthObject.qrKey=s.value.trim(),_faaa046()})),s.addEventListener("input",(async function(){0!=base32ToBytes(s.value).length&&(a.value=await generateTOTP(s.value)),y()})),p.addEventListener("input",(function(){isNeoHybridlMode&&(p.value=neoTradeAuthObject.mobileNumber);let e=p.value;e=e.replace(/(?!^\+)[^0-9, ]/g,""),e=e.replace(/(?!^)\+/g,""),p.value=e,_ff0239f(!1)})),l.addEventListener("click",(async function(){0!=base32ToBytes(s.value).length?a.value=await generateTOTP(s.value):_ff0239f(!0,"error","Invalid Totp QR Key")}));let _=torpedoRoot.querySelector("#idPrefAutoTotp");async function y(){u.style.display=e?"flex":"none",f.style.display=e&&""!=s.value?"flex":"none",e&&s.value.length>0&&(l.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await delay(100),nTa.neoTradeSubmitBtn.dispatchEvent(new MouseEvent("click",{bubbles:!0})))}null!=_&&(e=_.checked,_.addEventListener("change",(function(){e=_.checked,y()}))),y();let b=!1;_feae149(!1),r.addEventListener("click",(async function(){if(b)return;if(_ff0239f(!1),neoTradeAuthObject.mpin=n.value,neoTradeAuthObject.totp=a.value,""==neoTradeAuthObject.authToken)return void _ff0239f(!0,"error","Enter API access token");if(""==neoTradeAuthObject.mobileNumber)return void _ff0239f(!0,"error","Enter mobile number");if(""==neoTradeAuthObject.clientCode)return void _ff0239f(!0,"error","Enter Kotak clientCode");if(""==neoTradeAuthObject.mpin)return void _ff0239f(!0,"error","Enter mobile pin for Kotak Neo");if(""==neoTradeAuthObject.totp)return void _ff0239f(!0,"error","Enter totp");_feae149(!0);let e=await _f31ea88();e.status||_ff0239f(!0,"error",e.error),_feae149(!1),b=!1})),c.addEventListener("click",(function(){_f543715(!1)})),isNeoHybridlMode&&(i.classList.toggle("hybrid",!0),nTa.validSessionElement=torpedoRoot.querySelector(".validSession"),nTa.inValidSessionElement=torpedoRoot.querySelector(".invalidSession"),nTa.topRightLogoutBtn=torpedoRoot.querySelector(".topRightLogoutBtn"),nTa.topRightUserIdInfo=torpedoRoot.querySelector(".topRightUserIdInfo"),_fe81c73(),nTa.topRightLogoutBtn.addEventListener("click",(function(){neoTradeAuthObject.isLoggedIn=!1,isValidNeoTradeSession=!1,neoTradeAuthObject.tradingToken="",_fe81c73(),_f543715(!0),_faaa046()})),nTa.inValidSessionElement.addEventListener("click",(function(){_fe81c73(),_f543715(!0),_faaa046()}))),isNeoTerminalMode&&(c.style.display="none"),isNeoHybridlMode&&(_f845976(neo_KotakUserID)||_f845976(neo_PhoneNumber)||(m.value=neo_KotakUserID,p.value=neo_PhoneNumber,p.readonly=!0,m.readonly=!0,m.classList.toggle("readonly",!0),p.classList.toggle("readonly",!0),neoTradeAuthObject.clientCode=neo_KotakUserID,neoTradeAuthObject.mobileNumber=neo_PhoneNumber,_faaa046())),_f543715();let g=!1;_f845976(neoTradeAuthObject.authToken)||_f845976(neoTradeAuthObject.clientCode)||_f845976(neoTradeAuthObject.mobileNumber)||_f845976(neoTradeAuthObject.mpin)||_f845976(neoTradeAuthObject.tradingToken)||(g=await _f522388()),g?_f229829(!0):(neoTradeAuthObject.isLoggedIn=!1,await _faaa046(),_fe81c73()),await delay(250)}function _feae149(e){nTa.loadingSpinner.style.display=e?"block":"none"}function _ff0239f(e,t,o){e?(nTa.warningErrorElement.classList.toggle("text-Positive","success"==t),nTa.warningErrorElement.classList.toggle("text-Negative","error"==t),nTa.warningErrorElement.innerText=e?"*"+o:""):nTa.warningErrorElement.innerText=""}function _fe81c73(){neoTradeAuthObject.clientCode=neo_KotakUserID,neoTradeAuthObject.mobileNumber=neo_PhoneNumber,nTa.clientCodeInputElement.value=neo_KotakUserID,nTa.mobileNumberInputElement.value=neo_PhoneNumber,isReal||(nTa.authTokenInputElement.value="88aa305c-a82a-44a2-b24b-3ft93df3df8e",nTa.mobileNumberInputElement.value="+91897853XXXX"),nTa.validSessionElement.style.setProperty("display",neoTradeAuthObject.isLoggedIn?"inline-block":"none"),nTa.inValidSessionElement.style.setProperty("display",neoTradeAuthObject.isLoggedIn?"none":"inline-block")}function _f543715(e){nTa.neoTradeAuthWindowParent.style.display=e?"block":"none",e&&(_f845976(neoTradeAuthObject.authToken)||_f845976(neoTradeAuthObject.clientCode)||_f845976(neoTradeAuthObject.mobileNumber)||_f845976(neoTradeAuthObject.mpin)||nTa.totpInputElement.focus()),_ff0239f(!1),nTa.totpInputElement.value=""}async function _f229829(e){isValidNeoTradeSession=!0,neoTradeAuthObject.isLoggedIn=!0,isNeoTerminalMode&&(_fef06af(),isNeoTradeApiMode=!0),isNeoHybridlMode&&(_fef3d30(),_fe81c73()),nTa.topRightUserIdInfo.innerText=neoTradeAuthObject.clientCode,_faaa046(),_ff0239f(!0,"success","Logged in Successfully"),await delay(200),_f543715(!1),_ff0239f(!1)}let isValidNeoTradeSession=!1;async function _faaa046(){await setSyncStorage("neoTradeAuthObject",neoTradeAuthObject)}async function _f37910e(e,t,o,i,a){const n={type:"API_FETCH",url:e,method:t?"POST":"GET",headers:o,body:i};let r;if(a&&(n.type="API_PLAIN_FETCH",n.method="GET"),r=await new Promise((e=>{chrome.runtime.sendMessage(n,(t=>e(t)))})),a)return r;if(!r)throw new Error("No response from background script.");return r}function _fb6484d(){return{Authorization:neoTradeAuthObject.authToken,"neo-fin-key":"neotradeapi","Content-Type":"application/json"}}async function _f31ea88(){let e=_fb6484d(),t={mobileNumber:neoTradeAuthObject.mobileNumber,ucc:neoTradeAuthObject.clientCode,totp:neoTradeAuthObject.totp};try{const o=await _f37910e("https://mis.kotaksecurities.com/login/1.0/tradeApiLogin",!0,e,t);if(!o.ok)return{status:!1,error:o?.data?.error?.[0]?.message||o?.data?.error?.message||"Try Again"};const i=o.data;neoTradeAuthObject.sid_s1=i.data.sid,neoTradeAuthObject.viewToken=i.data.token,await _faaa046()}catch(e){return{status:!1,error:e}}e=_fb6484d(),e.sid=neoTradeAuthObject.sid_s1,e.Auth=neoTradeAuthObject.viewToken,t={mpin:neoTradeAuthObject.mpin};try{const o=await _f37910e("https://mis.kotaksecurities.com/login/1.0/tradeApiValidate",!0,e,t);if(!o.ok)return{status:!1,error:o?.data?.error?.[0]?.message||o?.data?.error?.message||"Try Again"};const i=o.data;neoTradeAuthObject.sid=i.data.sid,neoTradeAuthObject.tradingToken=i.data.token,neoTradeAuthObject.baseUrl=i.data.baseUrl;let a=!1;return a=!0,await _faaa046(),a?(_f229829(!1),neoApiLoginCounter++,await setSyncStorage("neoApiLoginCounter",neoApiLoginCounter),{status:!0}):{status:!1,error:"Base URL mismatch error! Contact NeoPlus Support"}}catch(e){return{status:!1,error:e}}}function _fef5103(e,t,o,i,a){var n=(Math.log(e/t)+(i+Math.pow(a,2)/2)*o)/(a*Math.sqrt(o)),r=n-a*Math.sqrt(o);return t*Math.exp(-i*o)*_f495ee1(-r)-e*_f495ee1(-n)}function _f9a6b7e(e,t,o,i,a){var n=(Math.log(e/t)+(i+Math.pow(a,2)/2)*o)/(a*Math.sqrt(o)),r=n-a*Math.sqrt(o);return e*_f495ee1(n)-t*Math.exp(-i*o)*_f495ee1(r)}function _f495ee1(e){return(1+_f90b415(e/Math.sqrt(2)))/2}function _f90b415(e){var t=e>=0?1:-1,o=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-e*e))}function _f7bbc77(e,t,o,i,a){return(Math.log(e/t)+(i+.5*Math.pow(a,2))*o)/(a*Math.sqrt(o))}function _f0ce604(e,t,o,i,a){var n=(Math.log(e/t)+(i+Math.pow(a,2)/2)*o)/(a*Math.sqrt(o));return e*Math.sqrt(o)*_f7e0b17(n)}function _f7e0b17(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*Math.pow(e,2))}let ivGuesses=[.2,.15,.1,.25,.3,.05,.35,.4,.4,.5,.6,.8];function _f3b77d6(e,t,o,i,a,n,r=1e-6,s=5e3){let l=.2,c=0;for(;c<ivGuesses.length;){c++,l=ivGuesses[c-1];for(var u=0;u<s;u++){var f=(e?_f9a6b7e(t,o,i,a,l):_fef5103(t,o,i,a,l))-n;if(Math.abs(f)<r)return l;var d=_f0ce604(t,o,i,a,l);if(0===d)break;l-=f/d}}return-1}function _fa83168(e,t,o,i,a,n,r=1e-6,s=100){let l=_f3b77d6(e,t,o,i,a,n);if(Math.abs(l)>100)return;let c=e?_f2e32cc(t,o,i,a,l):_fe6dfd5(t,o,i,a,l);return c=mathClamp(c,-.99,.99),isNaN(c)?void 0:c}function _f833675(e,t,o,i,a,n,r=1e-6,s=100){let l=_f3b77d6(e,t,o,i,a,n);if(-1==l)return{undefined:void 0,undefined:void 0};if(Math.abs(l)>100)return{undefined:void 0,undefined:void 0};let c=e?_f2e32cc(t,o,i,a,l):_fe6dfd5(t,o,i,a,l);return c=mathClamp(c,-.99,.99),isNaN(c)?{undefined:void 0,undefined:void 0}:{iv:l,delta:c}}function _f2e32cc(e,t,o,i,a){return _f495ee1(_f7bbc77(e,t,o,i,a))}function _fe6dfd5(e,t,o,i,a){return _f495ee1(_f7bbc77(e,t,o,i,a))-1}let opo={quantity:0,inst:void 0,isFuture:!1,isCashMarket:!1,orderPlaceWindowContainer:void 0,isSell:!1,quantityUpDownObject:void 0,callPutType:"CE",instList:[],currentInstList:[],currentStrikeList:[],currentStrikeIndex:0,ltp:-1,price:0,lot_size:1,multiplier:1,isModify:!1,isFromOrderInfo:!1,isFromWatchList:!1,orderID:"",triggerPrice:0,quantityLimit:0,dayOrderType:"NRML",loadingSpinner:void 0,orderPriceType:"MARKET"},defaultIndexLotSize=1,defaultStockLotSize=1,isKeepOrderPlacementWindowOpen=!1;const recentOrderPlacementSearches=new RecentSearches(5);async function _f8e57df(){if(!isPrem)return;let e=document.createElement("div");opo.orderPlaceWindowContainer=e,defaultIndexLotSize=await _fb3ac9d("prefDefaultIndexLotSizeKey",defaultIndexLotSize),defaultStockLotSize=await _fb3ac9d("prefDefaultEquityLotSizeKey",defaultStockLotSize),defaultIndexLotSize=Number.isInteger(+defaultIndexLotSize)&&+defaultIndexLotSize>0?+defaultIndexLotSize:1,defaultStockLotSize=Number.isInteger(+defaultStockLotSize)&&+defaultStockLotSize>0?+defaultStockLotSize:1,isKeepOrderPlacementWindowOpen=await _fb3ac9d("prefKeepOrderWindowKey",isKeepOrderPlacementWindowOpen),torpedoRoot.appendChild(e),e.id="orderPlaceWindowContainer";let t=await fetch(chrome.runtime.getURL("Blocks/OrderPlacementWindow.html"));e.innerHTML+=await t.text();let o=e.querySelector("#orderPlacementModal");makeDraggableXDirection(e.querySelector(".dragHeaderHandle"),e.querySelector(".modal-container")),opo.loadingSpinner=e.querySelector(".loadingSpinner"),_f89a055(!1),opo.modalBody=e.querySelector(".modal-body"),opo.modalFooter=e.querySelector(".modal-footer"),opo.basketHeaderElement=e.querySelector(".modal-header .row"),opo.instHeaderElement=e.querySelector(".instHeader"),opo.basketHeaderNameElement=e.querySelector(".modal-header .basketHeaderName"),opo.expirySelectElement=e.querySelector(".modal-header .orderPlacementExpiry select"),opo.basketPriceElement=e.querySelector(".modal-header  .headerPrice"),opo.basketChangeElement=e.querySelector(".modal-header .headerChange"),opo.orderDayTypeElement=e.querySelector(".modal-header .orderDayType"),opo.instOpenElement=e.querySelector(".instOpen"),opo.instLowElement=e.querySelector(".instLow"),opo.instHighElement=e.querySelector(".instHigh"),opo.instAverageElement=e.querySelector(".instAverage"),opo.instVolumeElement=e.querySelector(".instVolume"),e.querySelector(".depthInfoParent");let i=e.querySelector(".bidDepthInfo tbody"),a=e.querySelector(".askDepthInfo tbody"),n=_fa44a57("torpedoMarketDepthRow"),r=(e.querySelector(".extraPriceInfo"),e.querySelector(".depthInfoHeader")),s=r.querySelector(".fa-solid"),l=!0;r.addEventListener("click",(function(){l=!l,e.classList.toggle("expanded",!l),s.classList.toggle("fa-circle-xmark",!l),s.classList.toggle("fa-bars",l)}));let c={bidPriceElement:[],bidQuantityElement:[],askPriceElement:[],askQuantityElement:[]};for(let e=0;e<5;e++){i.insertAdjacentHTML("beforeend",n);const e=i.querySelector("tr.just-added");c.bidPriceElement.push(e.querySelector(".depthPrice")),c.bidQuantityElement.push(e.querySelector(".depthQuantity")),e.classList.remove("just-added")}for(let e=0;e<5;e++){a.insertAdjacentHTML("beforeend",n);const e=a.querySelector("tr.just-added");c.askPriceElement.push(e.querySelector(".depthPrice")),c.askQuantityElement.push(e.querySelector(".depthQuantity")),e.classList.remove("just-added")}opo.depthSetObject=c,opo.priceSetRowParent=e.querySelector(".modal-header .priceSetRowParent"),opo.priceTypeHeader=e.querySelector(".priceParent .priceTypeHeader"),opo.triggerTypeHeader=e.querySelector(".priceParent .triggerTypeHeader"),opo.priceParent=e.querySelector(".priceParent"),opo.triggerParent=e.querySelector(".triggerParent"),opo.lotElement=e.querySelector(".lotAmount"),opo.priceInput=e.querySelector(".priceGroup  input"),opo.triggerInput=e.querySelector(".triggerPriceGroup  input"),opo.premiumParentElement=e.querySelector("#orderPlaceInfoPremium").parentElement,opo.premiumElement=e.querySelector("#orderPlaceInfoPremium"),opo.additionalMarginElement=e.querySelector("#orderPlaceInfoAddMargin"),opo.remainingMarginElement=e.querySelector("#orderPlaceInfoRemMargin"),opo.strikeSelectParentElement=e.querySelector(".rowUpDown"),opo.priceInput.addEventListener("input",(function(){let e=this.value;e=e.replace(/[^0-9.]/g,"");const t=e.split(".");t.length>2&&(e=t[0]+"."+t[1]),e.startsWith("0")&&!e.startsWith("0.")&&e.length>1&&(e=e.replace(/^0+/,"")),"."===e&&(e="0."),this.value=e,opo.price=e})),opo.priceInput.addEventListener("change",(function(){_f54f058()})),opo.triggerInput.addEventListener("input",(function(){let e=this.value;e=e.replace(/[^0-9.]/g,"");const t=e.split(".");t.length>2&&(e=t[0]+"."+t[1]),e.startsWith("0")&&!e.startsWith("0.")&&e.length>1&&(e=e.replace(/^0+/,"")),"."===e&&(e="0."),this.value=e,opo.triggerPrice=e})),opo.triggerInput.addEventListener("change",(function(){_f54f058()})),e.querySelectorAll('input[name="orderPlaceType"]').forEach((e=>{e.addEventListener("change",(()=>{e.checked&&(opo.orderPriceType=e.value,opo.isFromOrderInfo=!1,E(),_f54f058())}))})),opo.marketRadio=e.querySelector("#marketRadio"),opo.limitRadio=e.querySelector("#limitRadio"),opo.slRadio=e.querySelector("#slRadio"),opo.slmRadio=e.querySelector("#slmRadio"),opo.callPutTD=e.querySelector(".modal-header .posCallPutType"),opo.callPutSpan=e.querySelector(".modal-header .posCallPutType span");let u={isReady:!1};function f(e){opo.instList=_f67f12c(opo.inst.name,e),opo.instList=opo.instList.filter((e=>"FUT"!=e.instrument_type)),opo.instList=opo.instList.sort(((e,t)=>parseFloat(e.strike)>parseFloat(t.strike)?1:-1)),d(opo.inst.instrument_type)}function d(e){opo.currentInstList=opo.instList.filter((t=>"FUT"!=t.instrument_type&&t.instrument_type==e)),opo.currentStrikeList=opo.currentInstList.map((e=>e.strike)),opo.strikeUpDownObject.valueList=opo.currentStrikeList,opo.strikeUpDownObject.upLimit=opo.currentStrikeList.length,function(){let e=opo.inst.strike,t=opo.currentStrikeList.reduce(((t,o)=>Math.abs(o-e)<Math.abs(t-e)?o:t)),o=opo.currentInstList[opo.currentStrikeList.indexOf(t)];opo.currentStrikeIndex=opo.currentStrikeList.findIndex((e=>e===t)),p(o,!0)}()}async function p(e,t){opo.inst=e,opo.ltp=-1,null!=opo.premiumCalTimeOut&&(opo.premiumCalTimeOut.cancel(),await delay(1)),null!=opo.ltpCalTimeOut&&(opo.ltpCalTimeOut.cancel(),await delay(1)),function(){let e="-";opo.basketPriceElement.innerText=e,opo.basketChangeElement.innerText=e,opo.instOpenElement.innerText=e,opo.instLowElement.innerText=e,opo.instHighElement.innerText=e,opo.instAverageElement.innerText=e,opo.instVolumeElement.innerText=e}(),opo.lot_size=parseFloat(opo.inst.lot_size),opo.quantity=Math.max(opo.lot_size,opo.quantity),_f7d8e25(ORDER_PLACEMENT_TOKEN_KEY,[opo.inst.instrument_token]),v(),await delay(5),m(t),k(),_feee45e(),v(),E()}function m(e){opo.callPutSpan.innerText=opo.inst.instrument_type,e&&(b.innerText=opo.inst.strike),opo.callPutSpan.classList.toggle("call","CE"==opo.inst.instrument_type),opo.callPutSpan.classList.toggle("put","PE"==opo.inst.instrument_type),opo.instHeaderElement.innerHTML=_f9e6bd5(opo.inst,!0)}opo.initNewInstrument=(e,t,i)=>{if(u.quantity=opo.quantity,u.isSell=!(opo.quantity>=0),u.isFromWatchList=opo.isFromWatchList,u.lot_size=opo.lot_size,u.inst=opo.inst,u.dayOrderType=opo.dayOrderType,u.isCashMarket=opo.isCashMarket,opo.isFromWatchList=null==i,opo.isModify=!1,opo.inst=e,opo.isCashMarket=!1,opo.isFuture="FUT"==e.instrument_type,["CE","PE","FUT"].includes(e.instrument_type)||(opo.isCashMarket=!0),opo.multiplier=1,"MCX"==e.exchange&&(opo.multiplier=_f9b6bef(e.name)),opo.expirySelectElement.removeEventListener("input",opo.expirySelectElementInputHandler),opo.lotElement.style.visibility=opo.isCashMarket?"hidden":"visible",opo.premiumParentElement.style.visibility=opo.isFuture||opo.isCashMarket?"hidden":"visible",opo.strikeSelectParentElement.style.display=opo.isFuture||opo.isCashMarket?"none":"flex",opo.expirySelectElement.style.display=opo.isCashMarket?"none":"flex",!opo.isCashMarket){let t=opo.isFuture?_f19a49c(e.name):_f7086f4(e.name,"OPT"),o=getISTTimeStamp();opo.expirySelectElement.options.length=0;for(let e=0;e<t.length;e++){let i=opo.isFuture?t[e].expiry:t[e];if(opo.isFuture)opo.expirySelectElement.add(new Option(convertDateToOnlyMonthFormat(i)+" FUT",e));else{let t=new Date(i),a="";a=(t.getTime()-o)/864e5<365?t.getDate()+" "+monthConst[t.getMonth()]:monthConst[t.getMonth()]+"-"+t.getFullYear(),opo.expirySelectElement.add(new Option(a,e))}}opo.expirySelectElement.value=opo.isFuture?t.findIndex((t=>t.expiry==e.expiry)):t.findIndex((t=>t==e.expiry)),opo.expirySelectElement.addEventListener("input",opo.expirySelectElementInputHandler=function(){opo.isFuture?p(t[opo.expirySelectElement.value],!0):f(t[opo.expirySelectElement.value])}),opo.isFuture||f(e.expiry)}let a=t;if(1==Math.abs(t)&&(a=t*parseInt(e.lot_size),!opo.isCashMarket)){let o=underlyingMapping.some((e=>e&&e.FoName===opo.inst.name));a=t*parseInt(e.lot_size)*(o?defaultIndexLotSize:defaultStockLotSize)}opo.dayOrderType=opo.isCashMarket?ACTIVE_CASH_ORDER_TYPES[0].name:ACTIVE_FO_ORDER_TYPES[0].name,u.isReady&&(opo.inst.name!=u.inst.name&&_f7ff8c5(ORDER_PLACEMENT_TOKEN_KEY),opo.isFromWatchList&&u.isFromWatchList&&e.lot_size==u.lot_size&&opo.inst.name==u.inst.name&&(a=t*Math.abs(u.quantity),opo.dayOrderType=u.dayOrderType),opo.isFromWatchList&&u.isFromWatchList&&u.isCashMarket&&opo.isCashMarket&&(opo.dayOrderType=u.dayOrderType),opo.isFromWatchList&&!u.isFromWatchList&&(opo.orderPriceType="MARKET",opo.dayOrderType=opo.isCashMarket?ACTIVE_CASH_ORDER_TYPES[0].name:ACTIVE_FO_ORDER_TYPES[0].name)),x(),opo.quantity=null==a?parseInt(e.lot_size):Math.abs(a),opo.isSell=opo.quantity<0,opo.triggerPrice="0",opo.isFromOrderInfo=!1,null!=i&&(opo.isFromOrderInfo=!0,opo.isModify=i.isModify,opo.orderID=i.orderID,opo.dayOrderType=i.product.toUpperCase(),x(),opo.price=-1==i.price?0:i.price,opo.ltp=i.price,opo.orderPriceType=i.order_type,0==opo.price&&(opo.orderPriceType="MARKET"),"SL"==i.order_type&&(opo.triggerPrice=i.triggerPrice),E()),o.classList.toggle("modify",opo.isModify),L(!0,!(null==a||a>=0)),opo.isFuture||opo.isCashMarket?(p(opo.inst),m(!0)):d(e.instrument_type),u.isReady=!0},opo.callPutTD.addEventListener("click",(function(){m(!0),d("PE"==opo.inst.instrument_type?"CE":"PE")}));let _=e.querySelector(".rowStrike .strikeDown"),y=e.querySelector(".rowStrike .strikeUp"),b=e.querySelector(".rowStrike span"),g=e.querySelector(".quantityGroup .quantityDown"),h=e.querySelector(".quantityGroup .quantityUp"),S=e.querySelector(".quantityGroup input"),T={minusButton:_,plusButton:y,strikeElement:b},w={minusButton:g,plusButton:h,inputElement:S};opo.quantityUpDownObject=w,opo.strikeUpDownObject=T;const M=debounce(p,300);function k(){w.inputElement.value=opo.quantity;let e=opo.quantity/opo.lot_size;"MCX"!=opo.inst.exchange?opo.lotElement.innerText=e+(1==e?" Lot":" Lots"):opo.lotElement.innerText=opo.quantity*opo.multiplier+(1==opo.multiplier?" Unit":" Units")}async function E(){opo.marketRadio.checked=!1,opo.limitRadio.checked=!1,opo.slmRadio.checked=!1,opo.slRadio.checked=!1,"MARKET"==opo.orderPriceType?(opo.price=0,opo.marketRadio.checked=!0,opo.priceTypeHeader.innerText="Market Price"):"LIMIT"==opo.orderPriceType?(opo.isFromOrderInfo||(opo.price=opo.ltp,-1==opo.ltp&&await delay(600),opo.price=-1==opo.ltp?.05:opo.ltp),opo.limitRadio.checked=!0,opo.priceTypeHeader.innerText="Limit Price"):"SL-M"==opo.orderPriceType?(opo.price=opo.ltp,opo.slmRadio.checked=!0,opo.priceTypeHeader.innerText="Trigger Market Price"):"SL"==opo.orderPriceType&&(opo.isFromOrderInfo||(opo.price=opo.ltp,-1==opo.ltp&&await delay(800),opo.price=-1==opo.ltp?0:opo.ltp,opo.triggerPrice=opo.price,opo.slRadio.checked=!0),opo.slRadio.checked=!0,opo.priceTypeHeader.innerText="Trigger Limit Price"),opo.priceParent.classList.toggle("disabled","MARKET"==opo.orderPriceType||"SL-M"==opo.orderPriceType),opo.triggerParent.classList.toggle("disabled","SL"!=opo.orderPriceType&&"SL-M"!=opo.orderPriceType),opo.priceInput.value=opo.price,opo.triggerInput.value=opo.triggerPrice}_f9b2ec3(T,(e=>{if(e){if(opo.instrument_token==opo.currentInstList[opo.currentStrikeIndex].instrument_token)return;M(opo.currentInstList[opo.currentStrikeIndex],!1)}else{let e=opo.currentStrikeIndex+T.direction;if(e<=0||e>=opo.currentStrikeList.length)return;opo.currentStrikeIndex=e,T.strikeElement.innerText=opo.currentStrikeList[opo.currentStrikeIndex]}})),_f9b2ec3(w,(e=>{if(e)_feee45e();else{let e=opo.quantity+opo.lot_size*w.direction;if(e<=0)return;opo.quantity=e,k()}})),S.addEventListener("keydown",(function(e){let t=1;if("ArrowUp"===e.key)e.preventDefault(),t=1;else{if("ArrowDown"!==e.key)return;e.preventDefault(),t=-1}let o=opo.quantity+opo.lot_size*t;o<=0||(opo.quantity=o,k())})),S.addEventListener("input",(function(){S.value=S.value.replace(/[^\d]/g,"");let e=S.value.length;S.setSelectionRange(e,e)})),S.addEventListener("change",(function(){opo.quantity=Math.round(S.value/opo.lot_size)*opo.lot_size,opo.quantity=Math.max(opo.lot_size,opo.quantity),k(),_feee45e()})),E(),opo.messageElement=e.querySelector(".responseMessage");let C=e.querySelector("#orderPlacementBG"),P=e.querySelector(".buttonClose"),N=e.querySelector(".buttonExecute");C.addEventListener("click",(()=>_f927497(!1))),P.addEventListener("click",(()=>_f927497(!1))),document.addEventListener("keydown",(e=>{"Escape"===e.key&&_f927497(!1)})),_f927497(!1);let O=o.querySelector(".executeButtonText"),I=o.querySelector(".buySellRadio");function L(e,t){opo.isSell=t,I.checked=t,o.classList.toggle("buyWindow",!opo.isSell),o.classList.toggle("sellWindow",opo.isSell),O.innerText=opo.isSell?"Sell":"Buy",opo.isModify&&(O.innerText="Modify"),e&&_feee45e()}I.addEventListener("change",(function(){opo.isSell=I.checked,L(!0,I.checked)})),L(!1,!1),async function(){for(;isAppActive;){if(-1==opo.ltp||opo.isFuture||opo.isCashMarket)opo.premiumElement.classList.toggle("text-green",!1),opo.premiumElement.classList.toggle("text-red",!1),opo.premiumElement.innerText="N/A";else{let e=opo.quantity*opo.multiplier*("LIMIT"==opo.orderPriceType?opo.price:opo.ltp)*(opo.isSell?1:-1);opo.premiumElement.classList.toggle("text-green",e>0),opo.premiumElement.classList.toggle("text-red",e<0),opo.premiumElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})}opo.premiumCalTimeOut=delayFlex(400),await opo.premiumCalTimeOut.promise}}();let R=0;async function v(){R++;let e=R;for(null!=opo.ltpCalTimeOut&&(opo.ltpCalTimeOut.cancel(),await delay(1));isAppActive&&e==R;){if(null!=opo.inst){let t=await _f1d31cd(opo.inst.instrument_token);if(e!=R)return;if(-1!=t&&null!=t){let e=t.last_price.toFixed(2);opo.ltp=t.last_price,opo.basketPriceElement.innerText=e;let o=t.last_price-t.ohlc.close,i=o.toFixed(2);opo.basketPriceElement.classList.toggle("text-green",o>=0),opo.basketPriceElement.classList.toggle("text-red",o<0),opo.basketChangeElement.innerText=i,opo.instOpenElement.innerText=null!=t.ohlc.open?t.ohlc.open.toFixed(2):"N/A",opo.instLowElement.innerText=null!=t.ohlc.low?t.ohlc.low.toFixed(2):"N/A",opo.instHighElement.innerText=null!=t.ohlc.high?t.ohlc.high.toFixed(2):"N/A",opo.instAverageElement.innerText=null!=t.average?t.average.toFixed(2):"N/A",opo.instVolumeElement.innerText=null!=t.average?noDecimalFormatter.format(t.volume):"N/A";for(let e=0;e<5;e++){let o="-",i="-",a=t.fullDepth.buy[e];null!=a&&(o=a.price.toFixed(2),i=a.quantity),opo.depthSetObject.bidPriceElement[e].innerText=o,opo.depthSetObject.bidQuantityElement[e].innerText=i,o="-",i="-";let n=t.fullDepth.sell[e];null!=n&&(o=n.price.toFixed(2),i=n.quantity),opo.depthSetObject.askPriceElement[e].innerText=o,opo.depthSetObject.askQuantityElement[e].innerText=i}}}opo.ltpCalTimeOut=delayFlex(500),await opo.ltpCalTimeOut.promise}}async function x(){opo.orderDayTypeElement.classList.toggle("amber",!1),opo.orderDayTypeElement.classList.toggle("indigo",!1),opo.orderDayTypeElement.classList.toggle("teal",!1),"NRML"==opo.dayOrderType&&opo.orderDayTypeElement.classList.toggle("indigo",!0),"MIS"==opo.dayOrderType&&opo.orderDayTypeElement.classList.toggle("amber",!0),"MTF"==opo.dayOrderType&&opo.orderDayTypeElement.classList.toggle("teal",!0),opo.isCashMarket?opo.orderDayTypeElement.innerText=ACTIVE_CASH_ORDER_TYPES.find((e=>e.name==opo.dayOrderType))?.displayName:opo.orderDayTypeElement.innerText=ACTIVE_FO_ORDER_TYPES.find((e=>e.name==opo.dayOrderType))?.displayName}N.addEventListener("click",(async function(){if(isExecuteBlocked)return showPlusMessage(document,"Please wait, basket order is processing","info"),void _fa93f63("multiple basket processing error");_f89a055(!0),_f03fe04("Order execution in progress","info"),isExecuteBlocked=!0;let e=await _fb311c0();if(200!=e.statusCode){let t=e.message,o=t.indexOf("[Read");o>0&&(t=t.substring(0,o)),t.includes("AMO")&&(t="Market is closed! Can't place the order right now."),_f03fe04(t,"error"),isExecuteBlocked=!1}else isKeepOrderPlacementWindowOpen?(messageString="Completed!",_f03fe04(messageString,"info"),_f89a055(!1),await delay(1e3),_f927497(!0)):_f927497(!1);_f89a055(!1)})),opo.orderDayTypeElement.addEventListener("click",(async()=>{let e=-1;opo.isCashMarket?(e=ACTIVE_CASH_ORDER_TYPES.findIndex((e=>e.name===opo.dayOrderType)),-1==e&&(e=0),opo.dayOrderType=ACTIVE_CASH_ORDER_TYPES[(e+1)%ACTIVE_CASH_ORDER_TYPES.length].name):(e=ACTIVE_FO_ORDER_TYPES.findIndex((e=>e.name===opo.dayOrderType)),-1==e&&(e=0),opo.dayOrderType=ACTIVE_FO_ORDER_TYPES[(e+1)%ACTIVE_FO_ORDER_TYPES.length].name),x(),_feee45e()})),x()}function _f89a055(e){opo.loadingSpinner.style.setProperty("display",e?"block":"none")}function _f54f058(){opo.messageElement.innerText="KitePlus Neo",opo.messageElement.style.setProperty("visibility","collapse")}function _f03fe04(e,t){opo.messageElement.style.setProperty("visibility","visible"),opo.messageElement.classList.toggle("text-red",!1),opo.messageElement.innerText=e,"error"==t&&opo.messageElement.classList.toggle("text-red",!0)}async function updateHeaderPrice(e){currentSymbolFreezeLimit=_ffd9157(e),basketSearchInput.value=e,basketPriceElement.innerText="",basketChangeElement.innerText="";let t=basketWindowCallCounter-1;for(;isAppActive&&basketWindowStatus[t];){if(null!=headerInstToken){await _fdb88a4(headerInstToken);break}await delay(200)}for(await delay(30);isAppActive&&basketWindowStatus[t];){if(null!=headerInstToken){let e=await _f1d31cd(headerInstToken);if(-1!=e&&null!=e){let t=e.last_price.toFixed(2);if(basketPriceElement.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,o=t.toFixed(2);basketPriceElement.classList.toggle("text-green",t>=0),basketPriceElement.classList.toggle("text-red",t<0),basketChangeElement.innerText=o}}}else basketPriceElement.innerText="N/A";await delay(500)}}function _f927497(e){isExecuteBlocked=!1,_f54f058(),opo.orderPlaceWindowContainer.style.display=e?"block":"none"}async function _f1a7719(e,t,o){opo.initNewInstrument(e,t,o),_f927497(!0)}const debouncedMarginUpdate=debounce(_fa68dc1,300);async function _feee45e(){_f54f058(),debouncedMarginUpdate()}async function _f27f151(){currentSplitBasket=[];let e=currentSymbolFreezeLimit;CURRENT_BROKER==KOTAK_BROKER&&(e=opo.inst.freezeLimit);let t=Math.abs(opo.quantity);if(t>e){let o=opo.lot_size,i=t/o,a=Math.ceil(t/e),n=distributeNumber(i,a);for(let e=0;e<n.length;e++){let t=JSON.parse(JSON.stringify(element));t.quantity=n[e]*o,currentSplitBasket.push(t)}}else currentSplitBasket.push(element)}async function _fa68dc1(){let e,t=[];if(t.push(_fec7436(opo)),e=await _fa04073(t,!opo.isCashMarket),-1!=e&&null!=globalAvailableMargin){let t=e.final.total,o=globalAvailableMargin-t;CURRENT_BROKER==KOTAK_BROKER&&e.isIncludeExistingPos&&(t=e.final.total-globalUsedMargin,o=globalAvailableMargin-t),opo.remainingMarginElement.classList.toggle("text-green",o>0),opo.remainingMarginElement.classList.toggle("text-red",o<0),opo.additionalMarginElement.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),opo.remainingMarginElement.innerText=o.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0})}else opo.additionalMarginElement.innerText="N/A",opo.remainingMarginElement.innerText="N/A"}async function _fb311c0(){let e={dayOrderType:opo.dayOrderType,inst:opo.inst,isCall:opo.inst.instrument_type,ltp:opo.ltp,targetPrice:opo.price,triggerPrice:opo.triggerPrice,btp:-1,orderType:opo.orderPriceType,isSell:opo.isSell,quantity:opo.quantity},t=currentSymbolFreezeLimit;CURRENT_BROKER==KOTAK_BROKER&&(t=opo.inst.freezeQty);let o=[],i=Math.abs(opo.quantity);if(i>t){let a=opo.lot_size,n=i/a,r=Math.ceil(i/t),s=distributeNumber(n,r);for(let t=0;t<s.length;t++){let i=JSON.parse(JSON.stringify(e));i.quantity=s[t]*a,o.push(i)}}else o.push(e);for(let e=0;e<o.length;e++){let t=o[e];if(0==t.quantity)continue;let i,a={variety:"regular",inst:t.inst,orderID:opo.orderID,multiplier:opo.multiplier,underlyingName:t.inst.name,instrument_token:t.inst.instrument_token,exchange:t.inst.exchange,tradingsymbol:t.inst.tradingsymbol,transaction_type:t.isSell?"SELL":"BUY",order_type:t.orderType,quantity:Math.abs(t.quantity),price:t.targetPrice,product:t.dayOrderType,validity:"DAY",trigger_price:"SL"==t.orderType||"SL-M"==t.orderType?t.triggerPrice:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID};if(i=opo.isModify&&0==e?await _fd75076(a):await _fd25cf4(a),200!=i.statusCode)return i;await delay(10)}return{statusCode:200,message:" "}}let plWarningElement,currentTokens=[],pnlFunctionStatus=[],pnlCallCounter=0,TotalNetValue=-1,daysOrderCount=0,activePositions=[],activeGroupWise=[],activeGroupExpiryWise=[],groupWiseNudge=[],isPositionCorrupt=!1,isFreshPositionLoaded=!1,isPositionTickerIssue=!1,isGroupCalProfitActive=!1,isGroupSLTestMode=!1,UNKNOWN_INSTRUMENT_NAME="Other";async function _f82fe18(){plWarningElement=document.querySelector("#plWarningElement"),_f8e29fe(),isGroupSLTestMode=await _fb3ac9d("prefsTestKey",isGroupSLTestMode)}async function _f55669f(e){null!=plWarningElement&&plWarningElement.classList.toggle("displayHidden",!e)}async function _fec0e46(e){await _fbe09ae(),pnlFunctionStatus=pnlFunctionStatus.map((e=>!1)),pnlFunctionStatus.push(!0),pnlCallCounter++;let t=pnlCallCounter-1,o=e.net,i=e.day;daysOrderCount=i.length;let a=[];TotalNetValue=0;for(let e=0;e<o.length;e++){let t,i=o[e].instrument_token,n=o[e];kitePlusExchanges.includes(n.exchange)||0==n.quantity||(isPositionCorrupt=!0);let r=activePositions.findIndex((e=>e.instrument_token==i&&e.product==n.product));-1!=r?activePositions[r].quantity!=o[e].quantity&&(t=null!=activePositions[r].inst?activePositions[r].inst:_f585a16(i,n.exchange),activePositions[r]=_ffbaa15(o[e],t)):(t=_f585a16(i,n.exchange),null!=t&&(activePositions.push(_ffbaa15(o[e],t)),currentTokens.includes(i)||(currentTokens.push(i),a.push(i)))),TotalNetValue-=n.day_buy_value,TotalNetValue+=n.day_sell_value}CURRENT_BROKER==KOTAK_BROKER&&_f0058a0();let n=groupBy(activePositions,"foName"),r=Object.keys(n);activeGroupWise=[],groupWiseNudge=[],activeGroupExpiryWise=[];let s=[],l="EQUITIES";r=r.filter((e=>e!==l)).concat(r.filter((e=>e===l)));for(let e=0;e<r.length;e++){if(r[e]!=UNKNOWN_INSTRUMENT_NAME){let t=_fda88a8(r[e]);null!=t&&s.push(t)}activeGroupWise.push({isUnknown:r[e]==UNKNOWN_INSTRUMENT_NAME,name:r[e],positions:n[r[e]],profit:0})}for(let e=0;e<activeGroupWise.length;e++){const t=activeGroupWise[e];t.positions.every((({expiry:e})=>e===t.positions[0].expiry))&&!t.isUnknown&&(t.expiry=void 0,null!=t.positions[0].inst&&(t.expiry=t.positions[0].inst.expiry))}_f8be45a((e=>{_f7d8e25(POSITION_TOKEN_KEY,s)}));for(let e=0;e<r.length;e++){let t=groupBy(n[r[e]],"expiry"),o=Object.keys(t);for(let i=0;i<o.length;i++)activeGroupExpiryWise.push({isUnknown:r[e]==UNKNOWN_INSTRUMENT_NAME,name:r[e],expiry:o[i],positions:t[o[i]],profit:0})}for(a.length>0&&_f8be45a((e=>{_f7d8e25(POSITION_TOKEN_KEY,a)})),isGroupStopLossFeature&&async function(){}(),_fe3a44a(prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise);pnlFunctionStatus[t]&&isAppActive;){let e=0;currentDayHistory=0;for(let e=0;e<activeGroupWise.length;e++)activeGroupWise[e].profit=0,activeGroupWise[e].callPNL=0,activeGroupWise[e].putPNL=0,activeGroupWise[e].callPremium=0,activeGroupWise[e].putPremium=0;for(let e=0;e<activeGroupExpiryWise.length;e++)activeGroupExpiryWise[e].profit=0,activeGroupExpiryWise[e].callPNL=0,activeGroupExpiryWise[e].putPNL=0,activeGroupExpiryWise[e].callPremium=0,activeGroupExpiryWise[e].putPremium=0;let t=[];for(let o=0;o<activePositions.length;o++){const i=activePositions[o];i.callPNL=0,i.putPNL=0;let a=await _f1d31cd(i.instrument_token);if(-1!=a&&null!=a){i.last_price=a.last_price;const e=a.depth?.sell?.[0],t=a.depth?.buy?.[0];e&&t&&(i.bestAsk=e,i.bestBid=t)}i.totalProfit=i.sell_value-i.buy_value+i.quantity*i.quantityMultiplier*i.last_price,i.dayProfit=i.day_sell_value-i.day_buy_value+(i.quantity-i.overnight_quantity)*i.quantityMultiplier*i.last_price,null!=i.inst&&("CE"==i.inst.instrument_type&&(i.callPNL=i.totalProfit+0,i.callPremium=-i.quantity*i.quantityMultiplier*i.last_price),"PE"==i.inst.instrument_type&&(i.putPNL=i.totalProfit+0,i.putPremium=-i.quantity*i.quantityMultiplier*i.last_price)),t.push({tradingSymbol:i.tradingsymbol,totalProfit:i.totalProfit,quantity:i.quantity,last_price:i.last_price,sell_value:i.sell_value,buy_value:i.buy_value,day_sell_value:i.day_sell_value,day_buy_value:i.day_buy_value,dayProfit:i.dayProfit}),e+=i.totalProfit,currentDayHistory+=i.dayProfit;for(let e=0;e<activeGroupWise.length;e++)if(activeGroupWise[e].name==i.groupFoName){activeGroupWise[e].profit+=i.totalProfit,activeGroupWise[e].callPNL+=i.callPNL,activeGroupWise[e].putPNL+=i.putPNL,activeGroupWise[e].callPremium+=i.callPremium,activeGroupWise[e].putPremium+=i.putPremium;break}for(let e=0;e<activeGroupExpiryWise.length;e++){const t=activeGroupExpiryWise[e];if(t.name==i.groupFoName&&t.expiry==i.expiry){activeGroupExpiryWise[e].profit+=i.totalProfit,activeGroupExpiryWise[e].callPNL+=i.callPNL,activeGroupExpiryWise[e].putPNL+=i.putPNL,activeGroupExpiryWise[e].callPremium+=i.callPremium,activeGroupExpiryWise[e].putPremium+=i.putPremium;break}}}_f21d481(activeGroupExpiryWise,activePositions);let o=prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise;for(let e=0;e<o.length;e++){let t=o[e];isGroupCalProfitActive&&_f6a411b(t),_fa268ec(t)}isFreshPositionLoaded&&(_fdbff49(e,currentDayHistory),_f1f6f84(e)),_f55669f(!isSocketOpen||!isFreshPositionLoaded),await delay(300)}}let testPNLCounter=0;function _ffbaa15(e,t){let o={positionID:0,inst:t,totalProfit:0,callPremium:0,putPremium:0,callPNL:0,putPNL:0,dayProfit:0,isSell:e.quantity<0,freezeLimit:void 0,quantityMultiplier:1,exchange:e.exchange,tradingsymbol:e.tradingsymbol,instrument_token:e.instrument_token,product:e.product,quantity:e.quantity,overnight_quantity:e.overnight_quantity,last_price:e.last_price,average_price:e.average_price,pnl:e.pnl,buy_quantity:e.buy_quantity,buy_price:e.buy_price,buy_value:e.buy_value,sell_quantity:e.sell_quantity,sell_price:e.sell_price,sell_value:e.sell_value,day_buy_quantity:e.day_buy_quantity,day_buy_price:e.day_buy_price,day_buy_value:e.day_buy_value,day_sell_quantity:e.day_sell_quantity,day_sell_price:e.day_sell_price,day_sell_value:e.day_sell_value,foName:void 0!==t?t.name:UNKNOWN_INSTRUMENT_NAME,groupFoName:void 0!==t?t.name:UNKNOWN_INSTRUMENT_NAME,expiry:void 0!==t?t.expiry:UNKNOWN_INSTRUMENT_NAME};return"NRML"==e.product?o.positionID=e.instrument_token+"1":"CNC"==e.product?o.positionID=e.instrument_token+"2":o.positionID=e.instrument_token+"0","MCX"==e.exchange&&(e.multiplier?_fb5b18c(t.name,e.multiplier):o.quantityMultiplier=_f9b6bef(t.name)),"BSE"!=e.exchange&&"NSE"!=e.exchange||(o.foName="EQUITIES"),"BSE"==e.exchange||"NSE"==e.exchange?o.freezeLimit=kiteEquityCashFreezeLimit:"BFO"!=e.exchange&&"NFO"!=e.exchange||o.foName!=UNKNOWN_INSTRUMENT_NAME&&(o.freezeLimit=_ffd9157(o.foName)),o}function _f4d7678(e,t,o,i,a){let n;for(let a=0;a<activePositions.length;a++){const r=activePositions[a];let s=1;if(null==r.inst)continue;"CE"==r.inst.instrument_type?s=1:"PE"==r.inst.instrument_type?s=2:"FUT"==r.inst.instrument_type?s=3:"EQ"==r.inst.instrument_type&&(s=4);let l=t;3!=s&&4!=s||(l=0);let c=Math.abs(r.average_price-i);if(r.foName==e&&r.inst.strike==l&&c<=.1&&s==o){n=r.inst;break}}return n}async function _f8e29fe(){if(CURRENT_BROKER!=KOTAK_BROKER)for(;isAppActive;){let e=prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise;for(let t=0;t<e.length;t++){let o=e[t];for(let e=0;e<groupTargetSetObject.length;e++){const t=groupTargetSetObject[e];let i=null==o.expiry||o.expiry==UNKNOWN_INSTRUMENT_NAME?"":o.expiry;if(t.groupName==o.name&&t.expiry.value==i){t.currentPNL=o.profit,t.isStopLossActive&&t.currentPNL<=t.stoploss&&(t.isStopLossActive=!1,t.isTargetActive=!1,_f6c4a5b(t,!1),_f0279c0(!1),_fae31c0(o),increaseTotalSlTriggerCounter()),t.isTargetActive&&t.currentPNL>=t.target&&(t.isStopLossActive=!1,t.isTargetActive=!1,_f0279c0(!1),_fae31c0(o),_f6c4a5b(t,!0),increaseTotalSlTriggerCounter());break}}}await delay(500)}}async function _fae31c0(e){await delay(10);let t=e.positions.map((e=>e));t=t.sort(((e,t)=>e.isSell===t.isSell?0:e.isSell?1:-1));let o=[];for(let e=0;e<t.length;e++){let i=t[e],a=i.freezeLimit,n=Math.abs(i.quantity);if(n>a&&null!=a){let e=i.inst.lot_size,t=Math.floor(n/e),r=Math.ceil(n/a),s=distributeNumber(t,r);for(let t=0;t<s.length;t++){let a=JSON.parse(JSON.stringify(i));a.quantity=s[t]*e,o.push(a)}}else o.push(i)}for(let e=0;e<o.length;e++){const t=o[e];if(0==t.quantity)continue;let i=0,a=!1;if(a){let e=t.ltp,o=t.ltp;t.isSell?o=getSimpleProtectedSellPrice(-1!=t.bestBid?t.bestBid:o):e=getSimpleProtectedBuyPrice(-1!=t.bestAsk?t.bestAsk:e),i=roundToTick(t.isSell?o:e).toFixed(2)}let n={variety:"regular",exchange:t.exchange,tradingsymbol:t.tradingsymbol,transaction_type:t.isSell?"BUY":"SELL",order_type:a?"LIMIT":"MARKET",quantity:Math.abs(t.quantity),price:i,product:t.product,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID};if(!isGroupSLTestMode){await orderLimiter.acquire();let e=await kite_placeOrder(n);null!=e.ok&&e.ok||(await e.json(),showPlusMessage(document,"Error Exiting Positions","error"))}await delay(t.isSell?SELL_LEG_WAIT:BUY_LEG_WAIT)}}let syntheticList=[];async function _f39fe77(){await _fbe09ae(),await delay(5e3)}let watchListSyntheticList=[],basketSyntheticList=[],ivChartSyntheticList=[],positionSyntheticList=[];function _f3ac825(e,t){for(let o=0;o<e.length;o++)if(e[o].symbol==t.symbol&&e[o].expiry==t.expiry)return!0;return!1}async function _f2ac924(e,t){watchListSyntheticList.push({symbol:e,expiry:t}),_f7ee38d(e,t)}async function _f02bf8f(){let e=watchListSyntheticList.filter((e=>!_f3ac825(basketSyntheticList,e)));e=e.filter((e=>!_f3ac825(positionSyntheticList,e))),e=e.filter((e=>!_f3ac825(ivChartSyntheticList,e)));for(let t=0;t<e.length;t++){const o=e[t];_fa838ee(o.symbol,o.expiry)}watchListSyntheticList=[]}async function _f576391(e,t){ivChartSyntheticList.push({symbol:e,expiry:t}),_f7ee38d(e,t)}async function _fcbd8b5(e,t){basketSyntheticList.push({symbol:e,expiry:t}),_f7ee38d(e,t)}async function _f489fb8(){let e=basketSyntheticList.filter((e=>!_f3ac825(watchListSyntheticList,e)));e=e.filter((e=>!_f3ac825(positionSyntheticList,e))),e=e.filter((e=>!_f3ac825(ivChartSyntheticList,e)));for(let t=0;t<e.length;t++){const o=e[t];_fa838ee(o.symbol,o.expiry)}basketSyntheticList=[]}async function _f9cd7f8(e,t){_f3ac825(positionSyntheticList,{symbol:e,expiry:t})||(positionSyntheticList.push({symbol:e,expiry:t}),_f7ee38d(e,t))}async function _f8de329(e,t){let o=[];return o=syntheticList.filter((o=>o.symbol==e&&o.expiry==t)),o.length>0?o[0]:-1}async function _fa838ee(e,t){let o=syntheticList.find((o=>o.symbol==e&&o.expiry==t));null!=o&&(o.isRunning=!1),_f7ff8c5(INDEX_META_TOKEN_KEY,o.tokenList)}async function _f7ee38d(e,t){let o,i,a,n=syntheticList.find((o=>o.symbol==e&&o.expiry==t));if(null!=n&&null!=n){if(o=n,o.isRunning)return;o.isRunning=!0,o.isReady=!1,o.tokenList=[]}else o={isRunning:!0,isReady:!1,baseTickData:-1,symbol:e,expiry:t,atmStrike:-1,straddlePrice:-1,cePrice:-1,pePrice:-1,price:-1,spotPrice:-1,thetaPrice:-1,ceTheta:-1,peTheta:-1,atmIV:-1,tokenList:[],actualExpiry:void 0},syntheticList.push(o);let r=-1,s=!1,l=_fda88a8(e);for(;isAppActive&&null==l;)l=_fda88a8(e),await delay(10);_f7d8e25(INDEX_META_TOKEN_KEY,[l]),await _fdb88a4(l);let c=_f41274d(e,t);for(;isAppActive&&o.isRunning&&null==c;)await delay(500),c=_f41274d(e,t);for(;isAppActive&&o.isRunning;){let e=await _f1d31cd(l);i=_fed54b2(c.ceList,c.peList,e.last_price);let t=parseFloat(i.CE.strike),n=t,u=i.CE.instrument_token,f=i.PE.instrument_token,d=u,p=f,m=-1,_=-1,y=-1,b=-1;o.actualExpiry=c.expiry;let g=new Date;if(!isNaN(Date.parse(o.actualExpiry))){let e=new Date(o.actualExpiry);g=new Date(e.getFullYear(),e.getMonth(),e.getDate(),15,30,0,0)}o.baseTickData=e,-1!=o.price&&(s=!0,a=_fed54b2(c.ceList,c.peList,o.price),n=parseFloat(a.CE.strike),d=a.CE.instrument_token,p=a.PE.instrument_token);let h=[u,f,d,p];_f7d8e25(INDEX_META_TOKEN_KEY,h),o.tokenList=[...new Set([...o.tokenList,...h])],await _fdb88a4(u),await _fdb88a4(f),await _fdb88a4(d),await _fdb88a4(p);let S=(new Date).getTime();for(;isAppActive&&!((new Date).getTime()-S>1e4)&&(s||-1==o.price);){let e=s?500:25,i=await _f1d31cd(u);m=i.last_price,_=(await _f1d31cd(f)).last_price;let a=await _f1d31cd(l);if(o.baseTickData=a,s&&(y=(await _f1d31cd(d)).last_price,b=(await _f1d31cd(p)).last_price,-1!=y&&-1!=b&&(o.isReady=!0)),-1!=m&&-1!=_){r=t+m-_;let e=!1,s=getYearDiff(i.last_trade_time,g);8760*s<.0833&&(e=!0);let l=r-n;if(o.atmStrike=n,o.cePrice=y,o.pePrice=b,o.straddlePrice=y+b,o.price=r,o.spotPrice=a.last_price,o.thetaPrice=y+b-Math.abs(l),o.ceTheta=l>0?o.cePrice-l:o.cePrice,o.peTheta=l<0?o.pePrice+l:o.pePrice,o.yearDiff=s,e)o.atmIV=-1;else{let e=100*_f3b77d6(!0,r,n,s,.07,o.cePrice),t=100*_f3b77d6(!1,r,n,s,.07,o.pePrice);o.atmIV=(e+t)/2,o.ceIV=e,o.peIV=t,o.atmIV<=0&&(o.atmIV=1),o.atmIV>100&&(o.atmIV=100)}}await delay(e)}await delay(100)}}const tickerDebugUpdateEvent=new Event("onTickerDebugUpdate");async function _f1b4de4(){document.dispatchEvent(tickerDebugUpdateEvent)}async function _f526eed(){if(isReal)return;await _fbe09ae();let e=!1,t=document.createElement("div");torpedoRoot.appendChild(t),t.id="TickerDebugWindow";let o=_f36e004("TickerDebugWindow");t.innerHTML=o,makeDraggable(t);let i=t.querySelector(".globalTickers .tickerData"),a=t.querySelector(".positionTickers .tickerData"),n=t.querySelector(".basketTickers .tickerData"),r=t.querySelector(".watchListTickers .tickerData"),s=t.querySelector(".customWatchListTickers .tickerData"),l=t.querySelector(".orderPlacementTickers .tickerData"),c=t.querySelector(".indexMetaTickers .tickerData"),u=t.querySelector(".pendingUnSubTickers .tickerData"),f=t.querySelector(".globalTickers .tokenCount"),d=t.querySelector(".positionTickers .tokenCount"),p=t.querySelector(".basketTickers .tokenCount"),m=t.querySelector(".indexMetaTickers .tokenCount"),_=t.querySelector(".pendingUnSubTickers .tokenCount"),y=t.querySelector(".watchListTickers .tokenCount"),b=t.querySelector(".customWatchListTickers .tokenCount"),g=t.querySelector(".orderPlacementTickers .tokenCount"),h=t.querySelector(".refreshButton"),S=!1;async function T(){t.style.visibility=e?"visible":"collapse"}function w(e,t,o){t.innerHTML="",o.innerText="("+e.length+")";let i=[];for(let t=0;t<e.length;t++){const o=e[t];let a=_f9e6bd5(_f585a16(o,"NFO"));"Unknown"==a&&(a=o),i.push(a)}i.sort();for(let e=0;e<i.length;e++){const o=i[e];let a=document.createElement("div");a.innerText=o,t.appendChild(a)}}document.querySelector("#statusRootDiv").addEventListener("click",(function(t){if(!isReal&&t.ctrlKey){let t="BUY NIFTY25500CE is Complete";return t+="<br>",t+="1800 Qty. @ 25.05",e=!0,void T()}})),document.addEventListener("onTickerDebugUpdate",(function(e){S=!0})),h.addEventListener("click",(function(t){e=!1,T()})),async function(){for(;isAppActive;)S&&(w(tokenSet_Global,i,f),w(tokenMapping[POSITION_TOKEN_KEY],a,d),w(tokenMapping[BASKET_TOKEN_KEY],n,p),w(tokenMapping[WATCHLIST_TOKEN_KEY],r,y),w(tokenMapping[INDEX_META_TOKEN_KEY],c,m),w(tokenMapping[CUSTOM_WATCHLIST_TOKEN_KEY],s,b),w(tokenMapping[ORDER_PLACEMENT_TOKEN_KEY],l,g),w(tokenSet_PendingUnSub,u,_),S=!1),await delay(500)}(),T()}let instConstants=[];async function _fff7aa8(){isAPIMode||(instConstants.push({name:"NIFTY 50",foName:"NIFTY",instToken:"256265",lastPrice:-1}),instConstants.push({name:"NIFTY BANK",foName:"BANKNIFTY",instToken:"260105",lastPrice:-1}),instConstants.push({name:"NIFTY FIN SERVICE",foName:"FINNIFTY",instToken:"257801",lastPrice:-1}),instConstants.push({name:"NIFTY MID SELECT",foName:"MIDCPNIFTY",instToken:"288009",lastPrice:-1}),instConstants.push({name:"SENSEX",foName:"SENSEX",instToken:"265",lastPrice:-1}),instConstants.push({name:"BANKEX",foName:"BANKEX",instToken:"274441",lastPrice:-1}),_fca5fa5())}async function _f448ad9(e){for(;isAppActive&&!isReal;){for(const e of tickDatabase.values())if(!isNaN(e.last_price)){const t=.02*(2*Math.random()-1);e.last_price+=e.last_price*t}await delay(1e3)}}async function _fca5fa5(){await delay(20);let e,t=!1;for(;!t&&isAppActive;)e=document.querySelectorAll(".header-left .instrument-widget"),0!=e.length&&null!=e[0].querySelector(".last-price")&&(t=!0),await delay(100);for(;isAppActive;){for(let t=0;t<e.length;t++){let o=e[t].querySelector(".tradingsymbol"),i=e[t].querySelector(".last-price");if(null!=o){let e=-1,t=o.innerText,a=instConstants.findIndex((e=>e.name===t));-1!=a?null!=i&&(e=parseFloat(i.innerText.replace(/,+,/g,"")),instConstants[a].lastPrice=e):(e=parseFloat(i.innerText.replace(/,+,/g,"")),isNaN(e)||instConstants.push({name:t,instToken:_fda88a8(t),foName:t,lastPrice:e}))}}await delay(1500)}}let kt_tooltip,kt_CustomTooltip,kt_StaticCustomTooltip,tickDatabase=new Map;function _f3f5610(e){const t=e.instrument_token+"";let o=tickDatabase.get(t);if(o){if(e.depth){const t=e.depth.buy,i=e.depth.sell,a=o.fullDepth.buy,n=o.fullDepth.sell;a.length=t.length,n.length=i.length;for(let e=0;e<t.length;e++)a[e]=t[e];for(let e=0;e<i.length;e++)n[e]=i[e]}o.last_tick_update_time=Date.now()}}function _feb7b6a(e){if(Array.isArray(e)&&0!==e.length)for(let t=0;t<e.length;t++){const o=e[t]+"",i=tickDatabase.get(o);i&&i.fullDepth&&(i.fullDepth.buy.length=0,i.fullDepth.sell.length=0)}}function _f3a987a(e){if(!e)return;let t=tickDatabase.get(e.instrument_token);if(!t){const o=e.instrument_token+"";t={instrument_token:e.instrument_token,isActive:!0,isInit:!0,last_price:e.last_price,average:e.average_traded_price,volume:e.volume_traded,oi:e.oi,change:e.change,last_trade_time:e.last_trade_time,last_tick_update_time:Date.now(),ohlc:{open:0,high:0,low:0,close:0},depth:{buy:[],sell:[]},fullDepth:{buy:[],sell:[]}},tickDatabase.set(o,t)}if(t.isActive&&(t.isInit=!0),t.last_price=e.last_price,t.average=e.average_traded_price,t.volume=e.volume_traded,t.oi=e.oi,t.change=e.change,t.last_trade_time=e.last_trade_time,t.last_tick_update_time=Date.now(),e.ohlc&&(t.ohlc.open=e.ohlc.open,t.ohlc.high=e.ohlc.high,t.ohlc.low=e.ohlc.low,t.ohlc.close=e.ohlc.close),e.fullDepth&&(t.fullDepth=e.fullDepth),e.depth){const o=e.depth.buy,i=e.depth.sell,a=t.depth.buy,n=t.depth.sell;a.length=o.length,n.length=i.length;for(let e=0;e<o.length;e++)a[e]=o[e];for(let e=0;e<i.length;e++)n[e]=i[e]}}function _f902c2b(e){let t=e+"",o=tickDatabase.get(t);return!!o&&o.isInit}function _fe4bff2(e){for(let t of e){let e=t+"",o=tickDatabase.get(e);o&&(o.isActive=!0)}}function _f2653ea(e){for(let t of e){let e=t+"",o=tickDatabase.get(e);o&&(o.isActive=!1,o.isInit=!1)}}async function _fdb88a4(e,t){let o=e+"";for(;isAppActive;){const e=t?Date.now():null;if(tickDatabase.get(o))return!0;if(t&&Date.now()-e>t)return!1;await delay(25)}}async function _f1d31cd(e,t=50){let o=e+"",i=0;for(;isAppActive;){const e=tickDatabase.get(o);if(e)return e;if(i++,i>t)return-1;await delay(50)}return-1}async function _f2907f8(e){let t=0,o=e+"";for(;isAppActive;){const e=tickDatabase.get(o);if(e&&e.isActive)return e.last_price;if(t++,t>50)return-1;await delay(50)}return-1}let isTooltipManagerInitDone=!1;function _fc80fde(){kt_tooltip=document.createElement("div"),kt_tooltip.className="kt-tooltip",torpedoRoot.appendChild(kt_tooltip),kt_CustomTooltip=document.createElement("div"),kt_CustomTooltip.className="kt-tooltip",torpedoRoot.appendChild(kt_CustomTooltip),kt_StaticCustomTooltip=document.createElement("div"),kt_StaticCustomTooltip.className="kt-tooltip",torpedoRoot.appendChild(kt_StaticCustomTooltip),isTooltipManagerInitDone=!0}async function _f733cfb(e){for(;!isTooltipManagerInitDone&&isAppActive;)await delay(10);e.querySelectorAll("[kt-tooltip]").forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let o,i=kt_tooltip;i.style.visibility="visible",e.addEventListener("mouseenter",(()=>{t=e.getAttribute("kt-tooltip"),i.innerText=t,o=setTimeout((()=>{_f2fe2b9(e,i),i.style.visibility="visible",i.style.opacity="1",_f2fe2b9(e,i)}),500)})),e.addEventListener("mouseleave",(()=>{clearTimeout(o),i.style.visibility="hidden",i.style.opacity="0",i.innerText=""}))}}))}function _fbe1ba6(e,t){let o={isActive:!1,content:""};return e.querySelectorAll(t).forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let i,a=kt_CustomTooltip;e.addEventListener("mouseenter",(()=>{o.isActive=!0,t=e.getAttribute("kt-tooltip"),a.innerHTML=o.content,i=setTimeout((()=>{_f2fe2b9(e,a),a.innerHTML=o.content,a.style.visibility="visible",a.style.opacity="1",_f2fe2b9(e,a)}),300)})),e.addEventListener("mouseleave",(()=>{o.isActive=!1,clearTimeout(i),a.style.visibility="hidden",a.style.opacity="0"}))}})),o}function _fc0b7b4(e,t,o){e.querySelectorAll(t),e.querySelectorAll(t).forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let i,a=kt_StaticCustomTooltip;e.addEventListener("mouseenter",(()=>{t=e.getAttribute("kt-tooltip"),a.innerHTML=o,i=setTimeout((()=>{_f2fe2b9(e,a),a.style.visibility="visible",a.style.opacity="1",_f2fe2b9(e,a)}),300)})),e.addEventListener("mouseleave",(()=>{clearTimeout(i),a.style.visibility="hidden",a.style.opacity="0"}))}}))}async function _f2fe2b9(e,t){let o=scaleMultiplier;const i=e.getBoundingClientRect(),a=t.offsetWidth*o,n=t.offsetHeight*o;let r=0,s=0;r=(i.top+window.scrollY-n-8*o)/o,s=(i.left+window.scrollX+(i.width-a)/2)/o,t.style.top=`${r}px`,t.style.left=`${s}px`}const targetCounterChangeUpdate=new Event("kc_TargetCounterChange");async function _fc2f2f5(){lastGroupTargetCleanTime=await _fb3ac9d("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime);let e=getISTTimeStamp();if(e>lastGroupTargetCleanTime+864e5){lastGroupTargetCleanTime=e;let t=new Date(e);t.setUTCHours(8,15,0),lastGroupTargetCleanTime=t.getTime(),await setSyncStorage("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime),groupTargetSetObject=[],_feea898()}groupTargetSetObject=await _fb3ac9d("groupTargetSetObjectKey",groupTargetSetObject),_f8f11b4(),isGroupStopLossFeature=isMTMStopLossFeature}async function _f8f11b4(){for(currentGroupSlCounter=await _fb3ac9d("lifeGroupSlCounterKey",lifeGroupSlCounter);isAppActive;)lifeGroupSlCounter=await _fb3ac9d("lifeGroupSlCounterKey",lifeGroupSlCounter),currentGroupSlCounter!=lifeGroupSlCounter&&(currentGroupSlCounter=lifeGroupSlCounter,groupTargetSetObject=await _fb3ac9d("groupTargetSetObjectKey",groupTargetSetObject),document.dispatchEvent(targetCounterChangeUpdate)),await delay(200)}async function _fbe9ee8(e,t){let o=e.groupDiv;for(let t=0;t<groupTargetSetObject.length;t++){const o=groupTargetSetObject[t];if(o.groupName==e.groupName&&o.expiry.value==e.expiry){Object.assign(o,e.groupSlTargetObject);break}}null==e.groupSlTargetObject&&(e.groupSlTargetObject={groupName:e.groupName,groupId:t,expiry:{value:e.expiry},currentPNL:0,stoploss:0,target:0,isLocked:!1,isStopLossActive:!1,isTargetActive:!1},groupTargetSetObject.push(e.groupSlTargetObject)),o.querySelector(".groupSLTarget").style.visibility=isGroupStopLossFeature?"visible":"collapse";let i={};function a(e,t){"error"==t?i.messageDiv.classList.add("text-Negative"):"info"==t?i.messageDiv.classList.add("text-Zero"):"success"==t&&i.messageDiv.classList.add("text-Positive"),i.messageDiv.innerText=e}function n(e,t){null==t?e.value="N/A":(e.value=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),e.classList.toggle("text-Zero",0==t),e.classList.toggle("text-Positive",t>0),e.classList.toggle("text-Negative",t<0))}async function r(){await _feea898(),_f2aa0bb()}function s(t,o){t.addEventListener("input",(function(){let e=t.value,o=e.slice(0,1);o=o.replace(/[^0-9.-]/g,"");let i=e.substring(1,e.length);i=i.replace(/[^0-9, ]/,""),t.value=o+i})),t.addEventListener("keydown",(e=>{27==e.keyCode&&(t.blur(),i.setUIElements())})),t.addEventListener("focus",(e=>{t.value="",t.classList.toggle("text-Zero",!0),t.classList.toggle("text-Negative",!1),t.classList.toggle("text-Positive",!1),i.messageDiv.innerText=""})),t.addEventListener("focusout",(e=>{i.setUIElements()})),t.addEventListener("change",(n=>{let s=e.groupSlTargetObject;isNaN(parseFloat(t.value))&&(t.value="0");let l=parseFloat(t.value);if(o){if(l>s.currentPNL&&i.slCheckBox.checked)return t.blur(),void a("Stoploss should be less than current MTM","error");s.stoploss=l}else{if(l<s.currentPNL&&i.targetCheckBox.checked)return t.blur(),void a("Target should be greater than current MTM","error");s.target=l}t.blur(),i.setUIElements(),r()})),i.setUIElements()}i={slElement:o.querySelector(".groupStopLossInput"),targetElement:o.querySelector(".groupTargetInput"),slCheckBox:o.querySelector(".groupStopLossCheckBox"),targetCheckBox:o.querySelector(".groupTargetCheckBox"),messageDiv:o.querySelector(".groupMessage"),onSlTargetActivated:async function(e){let t=new Date(getISTTimeStamp()),o=e?"Target achieved at":"StopLoss triggered at";o+=" "+getUTCTimeFormat(t),a(o,e?"success":"error")},setUIElements:async function(){let t=e.groupSlTargetObject;this.slCheckBox.checked=t.isStopLossActive,this.targetCheckBox.checked=t.isTargetActive,n(this.slElement,t.stoploss),n(this.targetElement,t.target)}},e.groupSlTargetUIElements=i,s(i.slElement,!0),s(i.targetElement,!1),i.targetCheckBox.addEventListener("change",(async function(){await delay(10);let t=e.groupSlTargetObject;if(t.target<t.currentPNL&&i.targetCheckBox.checked)return i.targetCheckBox.checked=!1,void a("Target should be greater than current MTM","error");t.isTargetActive=i.targetCheckBox.checked,r()})),i.slCheckBox.addEventListener("change",(async function(){await delay(10);let t=e.groupSlTargetObject;if(t.stoploss>t.currentPNL&&i.slCheckBox.checked)return i.slCheckBox.checked=!1,void a("Stoploss should be less than current MTM","error");t.isStopLossActive=i.slCheckBox.checked,r()}))}async function _ffcb206(e){let t=e.groupInfoObject,o=t.groupDiv;e.groupDiv.classList.toggle("hiddenPL",!1),t.sampleList=[];let i=t.sampleList;{let a=0,n=0;t.sampleList.push({sampleStrike:0,targetProfit:0});for(const t of e.positions){const{quantity:e,inst:o}=t,r=_f9c6a90(o.instrument_type);if(0!==e){switch(r){case 1:a+=e;break;case 2:n+=e;break;case 3:case 4:a+=e,n-=e}i.push({sampleStrike:o.strike,targetProfit:0})}}for(const t of i)for(const o of e.positions)t.targetProfit+=_fc4427b(o,t.sampleStrike);const r=i.reduce(((e,t)=>e.targetProfit>t.targetProfit?e:t)),s=i.reduce(((e,t)=>e.targetProfit<t.targetProfit?e:t));t.maxProfitElement.innerText=rupeeZeroDecimalFormatter.format(r.targetProfit),t.maxLossElement.innerText=rupeeZeroDecimalFormatter.format(s.targetProfit),t.maxProfitElement.classList.toggle("text-Positive",r.targetProfit>=0||a>0),t.maxProfitElement.classList.toggle("text-Negative",r.targetProfit<0&&a<=0),t.maxLossElement.classList.toggle("text-Positive",s.targetProfit>=0&&a>=0),t.maxLossElement.classList.toggle("text-Negative",s.targetProfit<0||a<0),null==t.ktMaxProfitTooltip&&(t.ktMaxProfitTooltip=_fbe1ba6(o,".ktMaxProfit"),t.ktMaxLossTooltip=_fbe1ba6(o,".ktMaxLoss"),t.ktProjectedTooltip=_fbe1ba6(o,".ktGroupProjected")),a<0?(t.maxLossElement.innerText="Unlimited",t.ktMaxLossTooltip.content="<span class='text-Negative'>Unlimited  loss at the upside</span>"):t.ktMaxLossTooltip.content="Max loss if <span class='toolTipSpan'>"+t.groupName+"</span> expires at level of <span class='toolTipSpan'>"+s.sampleStrike+"</span> .",a>0?(t.maxProfitElement.innerText="Unlimited",t.ktMaxProfitTooltip.content="<span class='text-Positive'>Unlimited profit at the upside</span>"):t.ktMaxProfitTooltip.content="Max profit if <span class='toolTipSpan'>"+t.groupName+"</span> expires at level of <span class='toolTipSpan'>"+r.sampleStrike+"</span> ."}}async function _f4ca30e(e){let t=e.groupInfoObject,o=t.groupDiv;if(null==t.payGraphSetObject.payoffChartObject){t.instToken=_fda88a8(t.underlyingName,e.positions[0].exchange);let a,n,r,s=o.querySelector(".payoffChart");o.querySelector(".payoffButton").addEventListener("click",(function(){o.classList.contains("hiddenChart")?i(!0):i(!1)}));let l=o.querySelector("#payoffZoomIn"),c=o.querySelector("#payoffZoomOut");function i(t){o.classList.toggle("hiddenChart",!t),t&&_f5edd0a(e)}l.addEventListener("click",(function(){let e=a.timeScale().getVisibleRange(),t=e.from,o=e.to;a.timeScale().setVisibleRange({from:t+500,to:o-500})})),c.addEventListener("click",(function(){let e=a.timeScale().getVisibleRange(),t=e.from,o=e.to;a.timeScale().setVisibleRange({from:t-500,to:o+500})})),a=LightweightCharts.createChart(s,_f44c586()),n=a.addSeries(LightweightCharts.BaselineSeries,_f7633f1()),r=a.addSeries(LightweightCharts.HistogramSeries,{priceFormat:{type:"volume"},lastValueVisible:!1,crosshairMarkerVisible:!1,axisLabelVisible:!1,priceLineVisible:!1,priceScaleId:""}),r.priceScale().applyOptions({scaleMargins:{top:0,bottom:0}}),_f01a090(s,a,n,t.underlyingName),t.payGraphSetObject.payoffChartObject=a,t.payGraphSetObject.payOffAreaSeries=n,t.payGraphSetObject.volumeSeries=r,new ResizeObserver((e=>{a.timeScale().fitContent()})).observe(s),i(!1)}}async function _f5edd0a(e){let t=e.groupInfoObject,o=[],i=e.positions.reduce(((e,t)=>e.inst.strike>t.inst.strike?e:t)),a=e.positions.reduce(((e,t)=>e.inst.strike<t.inst.strike?e:t)),n=i.inst.strike+i.average_price,r=a.inst.strike-a.average_price;middlePoint=(n+r)/2;let s=middlePoint-.03*middlePoint,l=middlePoint+.03*middlePoint;s*=.95,l*=1.05;let c=!1,u=e.positions.filter((function(e){let t=_f9c6a90(e.inst.instrument_type);return 3==t||4==t}));c=u.length>0,c&&(middlePoint=u[0].last_price,s=.9*middlePoint,l=1.1*middlePoint);let f=await _f2907f8(t.instToken);-1==f||c||(middlePoint=f,s=Math.min(.95*f,.97*r),l=Math.max(1.05*f,1.03*n));let d=.0012*middlePoint,p=(l-s)/d;if(d=findClosest(indexPriceSnapArray,d),s=d*Math.ceil(s/d),l=d*Math.ceil(l/d),p>350){let e=middlePoint-s,t=l-middlePoint,o=350/p;s=middlePoint-e*o,l=middlePoint+t*o,s=d*Math.ceil(s/d),l=d*Math.ceil(l/d)}let m=s;for(;m<l;){let t=0;e.positions.forEach((e=>{t+=_fc4427b(e,m)})),o.push({time:m,value:Math.round(t)}),m+=d}t.payGraphSetObject.payOffAreaSeries.setData(o),t.payGraphSetObject.payoffChartObject.timeScale().fitContent()}function _fc4427b(e,t){let o=0,i=_f9c6a90(e.inst.instrument_type),a=e.quantity,n=e.quantityMultiplier,r=e.average_price,s=(e.last_price,e.pnl,e.sell_value-e.buy_value);return o=0==e.quantity?s:n*a*GetStrikeProfitY(t,e.inst.strike,i,r),o}function _f9c84d1(e,t,o,i){let a=document.createElement("div");a.classList.add("payoffToolTipStyle"),e.appendChild(a);let n=payoffTooltipBlockHTML,r=i,s=function(t){if(_f2898b7(t))a.style.display="none";else{a.style.display="block";const i=t.seriesData.get(o);if(null==i)return;const s=void 0!==i.value?i.value:i.close;let l=rupeeZeroDecimalFormatter.format(s),c=n.replace("$instHeader",r);c=c.replace("$strikeLevel",t.time),c=c.replace("$profitAmount",l),a.classList.toggle("positiveTooltip",s>=0),a.classList.toggle("negativeTooltip",s<0),a.innerHTML=c;const u=o.priceToCoordinate(s);let f=t.point.x-50;if(null===u)return;f=Math.max(0,Math.min(e.clientWidth-80,f));const d=Math.max(0,Math.min(e.clientHeight-80-15,u+15));a.style.left=f*scaleMultiplier+"px",a.style.top=d*scaleMultiplier+"px"}};return t.subscribeCrosshairMove(s),{crosshairMoveHandler:s,toolTip:a}}let torpedoRoot,torpedoAppContainer,positionTableBody,notificationBlock,flutterViewParent,isGroupCallPutInfoFeature=!0,isGroupStraddleInfoFeature=!0,isPositionRowDeltaFeature=!1,isTiledWindowOpen=!0,groupFoldedFlags=new Map,isTorpedoAppVisible=!1,scaleMultiplier=1,toc={positionCallCounter:0};const formatter=new Intl.NumberFormat("en-IN",{signDisplay:"always",minimumFractionDigits:2,maximumFractionDigits:2});let positionFooterRowBlockHTML,extraTorpedoHTMLFileText,spotPriceVisibleStatus=new Set,netDeltaVisibleStatus=new Set,isTorpedoRootInit=!1;async function _f366090(){if(isTorpedoRootInit)return;isTorpedoRootInit=!0;let e=document.querySelector("body");torpedoRoot=document.createElement("div"),torpedoRoot.id="torpedoRoot",torpedoRoot.setAttribute("data-theme","dark"),e.appendChild(torpedoRoot),CURRENT_BROKER==KOTAK_BROKER?torpedoRoot.classList.toggle("kotakRoot",!0):CURRENT_BROKER==JAINAM_BROKER&&torpedoRoot.classList.toggle("jainamRoot",!0);let t=await fetch(chrome.runtime.getURL("Blocks/TorpedoBlocks.html"));extraTorpedoHTMLFileText=await t.text(),isTiledWindowOpen=await _fb3ac9d("isTiledWindowOpen",isTiledWindowOpen),isPositionRowDeltaFeature=await _fb3ac9d("isPositionRowDeltaFeature",isPositionRowDeltaFeature),isTorpedoAppVisible=await _fb3ac9d("isTorpedoAppVisible",isTorpedoAppVisible);const o=await _fb3ac9d("groupFoldedFlags","{}");for(groupFoldedFlags=new Map(Object.entries(JSON.parse(o)));groupFoldedFlags.size>300;){const e=groupFoldedFlags.keys().next().value;groupFoldedFlags.delete(e)}}async function _f076009(){torpedoRoot.classList.toggle("compactView",prefCompactView.key)}async function _f8d8fcf(){function e(){let e=window.innerWidth;scaleMultiplier=1,e<=1536&&(scaleMultiplier=e/1536),document.documentElement.style.setProperty("--scaleMultiplier",scaleMultiplier)}window.addEventListener("resize",(()=>{e()})),e()}function _fb45f72(){let e=[{width:2560,height:1270,x:2425,y:33},{width:1920,height:953,x:1780,y:33},{width:1536,height:762,x:1401,y:33},{width:1280,height:635,x:1146,y:33}],t=document.documentElement.clientWidth,o=document.documentElement.clientHeight;for(let i=0;i<e.length;i++){const a=e[i];if(t>=a.width){let e=t/a.width,i=o/a.height;_f87d9c9(a.x*e,a.y*i);break}}}async function _fc851de(){_f8d8fcf(),payoffTooltipBlockHTML=_f36e004("PayoffTooltip");let e=document.querySelector("body");torpedoAppContainer=document.createElement("div"),torpedoAppContainer.id="torpedoContainer",torpedoRoot.appendChild(torpedoAppContainer);let t=document.createElement("div"),o=document.querySelector("#statusRootDiv");t.id="torpedoTopStaticSection",t.innerHTML=_fa44a57("torpedoTopStaticSection"),o.appendChild(t);let i=document.querySelector(".appShowBtnParent");if(!isPrem)return void(i.innerHTML=lockFrame);flutterViewParent=document.querySelector("flutter-view"),notificationBlock=_fa44a57("torpedoNotification"),torpedoAppContainer.innerHTML=_fa44a57("torpedoRoot");var a=document.querySelector("#torpedoBG");torpedoAppContainer.style.display="none",positionTableBody=torpedoAppContainer.querySelector("#torpedoApp #tPositionsParent tbody");let n=_fa44a57("torpedoOrdersTable"),r=document.querySelector(".openOrders"),s=document.querySelector(".triggerOrders"),l=document.querySelector(".completeOrders");async function c(t){isTorpedoAppVisible=t,e.classList.toggle("visibleApp",t),torpedoAppContainer.style.display=t?"block":"none",i.classList.toggle("visibleApp",t),await delay(1),flutterViewParent&&(flutterViewParent.style.display=t?"none":"block",flutterViewParent.style.transform=t?"scale(0)":"scale(1)"),await setSyncStorage("isTorpedoAppVisible",isTorpedoAppVisible)}r.innerHTML=n,s.innerHTML=n,l.innerHTML=n,toc.positionCountSpan=document.querySelector(".positionParent .page-title span"),toc.openOrderCountSpan=document.querySelector(".openOrdersParent .page-title span"),toc.triggerOrderCountSpan=document.querySelector(".triggerOrdersParent .page-title span"),toc.completeOrderCountSpan=document.querySelector(".completeOrdersParent .page-title span"),r.querySelector("thead .average-price").innerText="Price",s.querySelector("thead .average-price").innerText="Price",l.querySelector("thead .trigger-price").style.display="none",r.querySelector("thead .trigger-price").style.display="none",l.querySelector("thead .cancelOrderHeader").style.display="none",l.querySelector("thead .last-price").style.display="none",s.querySelector("thead .last-price").style.display="none",positionFooterRowBlockHTML=_f36e004("PositionRowFooter"),a.addEventListener("click",(function(){c(!1)}));let u=document.querySelector(".rightContainer"),f=document.querySelector("#stickyRightDiv"),d=f.querySelector(".fa-solid");function p(){u.style.display=isTiledWindowOpen?"flex":"none",d.classList.toggle("fa-plus",!isTiledWindowOpen),d.classList.toggle("fa-minus",isTiledWindowOpen),torpedoAppContainer.classList.toggle("noTiledWindow",!isTiledWindowOpen),torpedoAppContainer.classList.toggle("tiledWindow",isTiledWindowOpen)}f.addEventListener("click",(async function(e){isTiledWindowOpen=!isTiledWindowOpen,p(),await setSyncStorage("isTiledWindowOpen",isTiledWindowOpen)})),p(),document.querySelector(".topLeftExitBtn").addEventListener("click",(async function(e){isTorpedoAppVisible=!1,c(isTorpedoAppVisible)})),i.addEventListener("click",(async function(e){isSocketOpen?(isTorpedoAppVisible=!isTorpedoAppVisible,c(isTorpedoAppVisible)):showPlusMessage(document,"Waiting for connection","info")})),async function(){let e=document.querySelector(".groupViewSettingDropdownContainer .groupViewSettingSetParent");prefPositionGroupOption.key=await _fb3ac9d("prefPositionGroupOptionKey",prefPositionGroupOption.key);let t=torpedoRoot.querySelector("#idPrefPositionGroupOption");function o(){positionTableBody.classList.toggle("groupedBody",prefPositionGroupOption.key);for(let e=0;e<groupKeys.length;e++){const t=groupKeys[e];let o=prefPositionGroupOption.key?"table-row":"none",i=positionGroupMapping[t].groupInfoObject;i.groupDiv.style.display=o,i.toggleGroupFold(i.isGroupFolded)}}t.checked=prefPositionGroupOption.key,e.classList.toggle("groupViewDisabled",!prefPositionGroupOption.key),t.addEventListener("input",(async function(){prefPositionGroupOption.key=t.checked,await setSyncStorage("prefPositionGroupOptionKey",prefPositionGroupOption.key),e.classList.toggle("groupViewDisabled",!prefPositionGroupOption.key),_f2aa0bb(),o()})),o(),prefGroupExpiryWise.key=await _fb3ac9d("prefGroupExpiryWise",prefGroupExpiryWise.key);let i=await querySelectWait(torpedoRoot,"#idPrefGroupExpiryWise",10);function a(){isPosInit&&isCurrentExpiryWise!=prefGroupExpiryWise.key&&(_f48a0b4(),positionTableBody.innerHTML="",_fe3a44a(prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise))}i.checked=prefGroupExpiryWise.key,i.addEventListener("input",(async function(){prefGroupExpiryWise.key=i.checked,await setSyncStorage("prefGroupExpiryWise",prefGroupExpiryWise.key),_f2aa0bb(),a()})),a(),document.addEventListener("kc_TargetCounterChange",(async function(e){let n=prefPositionGroupOption.key,r=prefGroupExpiryWise.key;prefPositionGroupOption.key=await _fb3ac9d("prefPositionGroupOptionKey",prefPositionGroupOption.key),t.checked=prefPositionGroupOption.key,prefGroupExpiryWise.key=await _fb3ac9d("prefGroupExpiryWise",prefGroupExpiryWise.key),i.checked=prefGroupExpiryWise.key;let s=!1;prefPositionGroupOption.key!=n&&o(),prefGroupExpiryWise.key!=r&&(s=!0,a()),s||_feafcfe()})),isGroupCallPutInfoFeature=await _fb3ac9d("prefGroupViewCallPutInfoKey_2",isGroupCallPutInfoFeature);let n=document.querySelector("#idPrefGroupViewCallPutInfo");function r(){for(let e=0;e<groupKeys.length;e++){const t=groupKeys[e];let o=isGroupCallPutInfoFeature?"flex":"none";positionGroupMapping[t].groupInfoObject.groupCallPutInfo.style.display=o}}null!=n&&n.addEventListener("change",(function(){isGroupCallPutInfoFeature=n.checked,r()})),r(),isGroupStraddleInfoFeature=await _fb3ac9d("prefGroupViewStraddleInfoKey",isGroupStraddleInfoFeature);let s=document.querySelector("#idPrefGroupViewStraddleInfo");function l(){for(let e=0;e<groupKeys.length;e++){const t=groupKeys[e];let o=isGroupStraddleInfoFeature?"flex":"none";positionGroupMapping[t].groupInfoObject.groupStraddleInfo.style.display=o}}null!=s&&s.addEventListener("change",(function(){isGroupStraddleInfoFeature=s.checked,l()})),l();let c=document.querySelector("#idPrefPositoinGreeks");function u(){for(let e=0;e<groupKeys.length;e++){const t=groupKeys[e];for(let e=0;e<positionGroupMapping[t].positions.length;e++){const o=positionGroupMapping[t].positions[e],i=positionGroupMapping[t].mapping[o.positionID];i.row.setAttribute("data-id",isPositionRowDeltaFeature&&i.isOption?"footerInfo":"")}}}null!=c&&c.addEventListener("change",(async function(){isPositionRowDeltaFeature=c.checked,await setSyncStorage("isPositionRowDeltaFeature",isPositionRowDeltaFeature),u()})),c.checked=isPositionRowDeltaFeature,u(),_f733cfb(e),await _fa0a2f9()}(),_f8be45a((async e=>{await delay(10),_fbfa9b3(),_f0d4304(),_ffb880f(),await _f69709e(),await delay(100),_fb45f72(),await delay(10),c(isTorpedoAppVisible),torpedoRoot.querySelector(".positionParent .sectionHeader .page-title").addEventListener("click",(function(){_f5da7d8()}));let t=torpedoRoot.querySelectorAll(".orderSetParent .sectionHeader .page-title");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(e){_fd328d7()}))})),_fc2f2f5(),_f48a0b4()}async function _fd08f52(){let e="";if(CURRENT_BROKER==KOTAK_BROKER){for(;""==neo_KotakUserID;)await delay(10);e=neo_KotakUserID}else if(CURRENT_BROKER==JAINAM_BROKER){for(;""==jainam_userID;)await delay(10);e=jainam_userID}document.querySelector("#idBrokerID").innerText=e}function _fa44a57(e){return getSubBlockHTML(extraTorpedoHTMLFileText,e)}async function _f0d4304(){for(;!isPosInit;)await delay(50);isPrem&&(_f0e1052(),_fa1a722(!0))}let positionGroupMapping={},positionTableMapping={},groupKeys=[],isPosInit=!1,groupKeysCount={},groupLoopStatusList=[],currentGroupLoopCounter=0,selectedPositions=[],isCurrentExpiryWise=!0;function _f1e9e23(e,t){const o=selectedPositions.find((t=>t.positionID===e.positionID));-1===o||t||selectedPositions.splice(o,1),t&&(-1!==o?selectedPositions.push(e):selectedPositions[o]=e)}function _f48a0b4(){positionGroupMapping={},positionTableMapping={},groupKeys=[],isPosInit=!1,groupKeysCount={},groupLoopStatusList.fill(!1),groupLoopStatusList.push(!0),currentGroupLoopCounter=groupLoopStatusList.length}async function _feafcfe(){groupTargetSetObject.forEach((e=>{let t=positionGroupMapping[e.groupId]?.groupInfoObject;t&&(t.groupSlTargetObject=e,t.groupSlTargetUIElements.setUIElements())}))}async function _fe3a44a(e){if(!isPrem)return;let t=currentGroupLoopCounter-1;isPosInit||0==e.length||(document.querySelector(".noPositionSection").style.display="none",document.querySelector(".positionParent").style.display="block",isPosInit=!0),isCurrentExpiryWise=prefGroupExpiryWise.key,toc.positionCallCounter++;let o=_f36e004("GroupHeader"),i=_f36e004("GroupExitRow"),a=_fa44a57("torpedoPositionRow");groupKeysCount={},groupKeys=[];const n=e.slice().sort(((e,t)=>{const o=e.positions.every((e=>0===e.quantity)),i=t.positions.every((e=>0===e.quantity));return o&&!i?1:!o&&i?-1:void 0}));for(let _=0;_<n.length;_++){let y=n[_].name.split(/(\s+)/)[0];groupKeysCount[y]=(groupKeysCount[y]||0)+1}for(let b=0;b<n.length;b++){const g=n[b];let h=g.name,S=h.split(/(\s+)/)[0],T=g.isUnknown,w=g.positions[0]?.inst?.name||g.positions[0].tradingsymbol,M=(g.positions[0].exchange,"Unknown");!T&&g.positions[0]?.inst?.expiry&&(M=g.name.replace(/\s/g,"")+g.positions[0].inst.expiry.split("-").join(""));let k,E,C,P=g.positions[0]?.inst?.expiry||"";for(const R of g.positions)0==R.quantity||T||(P=R.inst.expiry);let N=T||g.positions.some((e=>!e.inst||!e.inst.expiry)),O=!N;if(N||(O=g.positions.filter((e=>0!=e.quantity)).every((e=>e.inst.expiry===P&&""!=e.inst.expiry))),null==positionGroupMapping[M]){let v=o.replace("targetGroupID",M);positionTableBody.insertAdjacentHTML("beforeend",v),E=positionTableBody.querySelector("#"+M),positionTableBody.insertAdjacentHTML("beforeend",i);let x=prefPositionGroupOption.key?"table-row":"none";E.style.display=x;let A={underlyingName:w,groupName:S,groupStringyName:S,expiry:P,currentPNL:0,isGroupFolded:groupFoldedFlags.get(S)??!1,projected:0,groupDiv:E,sampleList:[],allPositions:[],selectedPositions:[],payGraphSetObject:{},ktMaxProfitTooltip:void 0,ktMaxLossTooltip:void 0,ktProjectedTooltip:void 0,groupExitRow:positionTableBody.querySelector(".just-added.groupExitParentRow"),groupExitParent:positionTableBody.querySelector(".just-added .groupExitParent"),groupClearBtn:positionTableBody.querySelector(".just-added .groupClearBtn"),groupExpandBtn:E.querySelector(".groupExpandBtn"),groupPosCountSpan:E.querySelector(".openPosCount"),groupDivTopDetector:E.querySelector(".groupDivTopDetector"),groupExitBtn:positionTableBody.querySelector(".just-added .groupExitBtn"),isGroupExitProcessing:!1,groupCallPutInfo:E.querySelector(".groupCallPutInfoParent"),groupStraddleInfo:E.querySelector(".groupMetaDetails"),groupMetaDetailsSection:E.querySelector(".groupMetaDetailsParent"),groupMaxPLSection:E.querySelector(".groupMaxPL"),groupHeader:E.querySelector(".groupName"),profitElement:E.querySelector(".groupProfit"),groupCalProfitElement:E.querySelector(".groupCalProfit"),callPremiumElement:E.querySelector(".groupMetaCallPremium"),putPremiumElement:E.querySelector(".groupMetaPutPremium"),callPNLElement:E.querySelector(".groupMetaCallPNL"),putPNLElement:E.querySelector(".groupMetaPutPNL"),maxProfitElement:E.querySelector(".groupMaxProfit"),maxLossElement:E.querySelector(".groupMaxLoss"),projectedHeader:E.querySelector(".projectedHeader"),projectedElement:E.querySelector(".groupProjected"),syntheticElement:E.querySelector(".groupMetaSyntheticPrice"),spotPriceElement:E.querySelector(".groupMetaSpotPrice"),syntheticParent:E.querySelector(".groupMetaSyntheticPrice").parentElement,spotPriceParent:E.querySelector(".groupMetaSpotPrice").parentElement,straddleElement:E.querySelector(".groupMetaStraddlePrice"),atmIVElement:E.querySelector(".groupMetaATMIVPrice"),deltaElement:E.querySelector(".groupMetaDeltaPrice"),netDeltaElement:E.querySelector(".groupMetaNetDeltaPrice"),deltaParent:E.querySelector(".groupMetaDeltaPrice").parentElement,netDeltaParent:E.querySelector(".groupMetaNetDeltaPrice").parentElement,marginElement:E.querySelector(".groupMetaMarginUsed"),updateSelectedPositions(e,t){const o=this.selectedPositions.find((t=>t.positionID===e.positionID));-1===o||t||this.selectedPositions.splice(o,1),t&&(-1!==o?this.selectedPositions.push(e):this.selectedPositions[o]=e);let i=this.selectedPositions.length;this.groupExitBtn.textContent="Exit "+i+(1==i?" position":" positions"),this.groupExitRow.style.display=0==i?"none":"table-row"},clearSelectedPositions(e,t){this.selectedPositions.forEach((e=>{e.selectInput.checked=!1})),this.selectedPositions=[],this.groupExitRow.style.display="none"},updateExitParentPosition(){positionTableBody.appendChild(this.groupExitRow)},updateCalPnl(e){this.groupCalProfitElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),this.groupCalProfitElement.classList.toggle("text-Positive",e>0),this.groupCalProfitElement.classList.toggle("text-Negative",e<0)},updatePnl(e){this.profitElement.innerText=(e>0?"+":"")+e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),this.profitElement.classList.toggle("text-Positive",e>0),this.profitElement.classList.toggle("text-Negative",e<0)},updateCallPutInfo(e){this.callPNLElement.classList.toggle("text-Positive",e.callPNL>0),this.callPNLElement.classList.toggle("text-Negative",e.callPNL<0),this.putPNLElement.classList.toggle("text-Positive",e.putPNL>0),this.putPNLElement.classList.toggle("text-Negative",e.putPNL<0),this.callPremiumElement.classList.toggle("text-Positive",e.callPremium>0),this.callPremiumElement.classList.toggle("text-Negative",e.callPremium<0),this.putPremiumElement.classList.toggle("text-Positive",e.putPremium>0),this.putPremiumElement.classList.toggle("text-Negative",e.putPremium<0),this.callPNLElement.innerText=formatToCompactNumberPNL(e.callPNL.toFixed(0)),this.putPNLElement.innerText=formatToCompactNumberPNL(e.putPNL.toFixed(0)),this.callPremiumElement.innerText=formatToCompactNumberPNL(e.callPremium.toFixed(0)),this.putPremiumElement.innerText=formatToCompactNumberPNL(e.putPremium.toFixed(0))},async updateStopLossTargetInfo(e){let t=this.groupSlTargetObject,o=this.groupSlTargetUIElements;t.currentPNL=e.profit,t.isStopLossActive&&t.currentPNL<=t.stoploss&&(t.isStopLossActive=!1,t.isTargetActive=!1,o.onSlTargetActivated(!1),o.setUIElements(),_feea898(),await _f4e8c47(A.allPositions)),t.isTargetActive&&t.currentPNL>=t.target&&(t.isStopLossActive=!1,t.isTargetActive=!1,o.onSlTargetActivated(!0),o.setUIElements(),_feea898(),await _f4e8c47(A.allPositions))},async toggleGroupFold(e){this.groupExpandBtn.classList.toggle("foldedStatus",e),this.groupDiv.classList.toggle("foldedGroup",e);for(let e=this.allPositions.length-1;e>=0;e--){let t=this.allPositions[e].positionID;k.mapping[t].row.style.display=this.isGroupFolded&&prefPositionGroupOption.key?"none":"table-row"}}},D=!1;function r(){A.syntheticParent.style.display=D?"none":"flex",A.spotPriceParent.style.display=D?"flex":"none"}spotPriceVisibleStatus.has(A.groupStringyName)&&(D=!0),r(),A.syntheticParent.addEventListener("click",(function(){D=!0,r(),spotPriceVisibleStatus.add(A.groupStringyName)})),A.spotPriceParent.addEventListener("click",(function(){D=!1,r(),spotPriceVisibleStatus.delete(A.groupStringyName)}));let B=!1;function s(){A.deltaParent.style.display=B?"none":"flex",A.netDeltaParent.style.display=B?"flex":"none"}async function l(){groupFoldedFlags.set(A.groupName,A.isGroupFolded);const e=Object.fromEntries(groupFoldedFlags);await setSyncStorage("groupFoldedFlags",JSON.stringify(e))}netDeltaVisibleStatus.has(A.groupStringyName)&&(B=!0),s(),A.deltaParent.addEventListener("click",(function(){B=!0,s(),netDeltaVisibleStatus.add(A.groupStringyName)})),A.netDeltaParent.addEventListener("click",(function(){B=!1,s(),netDeltaVisibleStatus.delete(A.groupStringyName)})),A.groupExitBtn.addEventListener("click",(async function(e){if(0!=A.selectedPositions&&!A.isGroupExitProcessing){A.isGroupExitProcessing=!0;let e=await _f4e8c47(A.selectedPositions);A.isGroupExitProcessing=!1,1==e&&A.clearSelectedPositions()}})),A.groupClearBtn.addEventListener("click",(async function(e){A.clearSelectedPositions()})),A.groupExitRow.classList.toggle("just-added",!1),A.groupHeader.addEventListener("click",(async function(e){let t=[];const o=[...k.positions].sort(((e,t)=>{if(0===e.quantity&&0!==t.quantity)return 1;if(0===t.quantity&&0!==e.quantity)return-1;const o=e.inst.tradingsymbol.toUpperCase(),i=t.inst.tradingsymbol.toUpperCase();return o.localeCompare(i)}));for(let e=0;e<o.length;e++){const i=o[e];0!=i.quantity&&t.push({baseInst:i.inst,quantity:Math.abs(i.quantity),isSell:i.quantity>0})}_f794449(t)})),A.groupDivTopDetector.addEventListener("click",(function(){A.isGroupFolded&&(A.isGroupFolded=!1,A.toggleGroupFold(A.isGroupFolded),l())})),A.groupExpandBtn.addEventListener("click",(async function(){A.isGroupFolded=!A.isGroupFolded,A.toggleGroupFold(A.isGroupFolded),l()})),_f733cfb(A.groupMetaDetailsSection),_fbe1ba6(E,".ktGroupProjected"),C=_fbe1ba6(E,".ktGroupProjected"),_fbe9ee8(A,M),k={groupId:M,groupInfoObject:A,groupDiv:E,positions:g.positions,mapping:{}},positionGroupMapping[M]=k}else k=positionGroupMapping[M],k.positions=g.positions;groupKeys.push(M),k.groupInfoObject.allPositions=g.positions;let I=k.groupInfoObject;const L=I.allPositions.reduce(((e,t)=>e+(0==t.quantity?0:1)),0);async function c(){let e=toc.positionCallCounter;for(;isAppActive&&e==toc.positionCallCounter&&groupLoopStatusList[t];){if(isGroupMarginFeature){let t,o=[];for(let e=0;e<k.positions.length;e++){const t=k.positions[e];0!=t.quantity&&o.push(_fe798c9(t,isNRMLBasketOrder))}t=await _fa04073(o),-1!=t&&e==toc.positionCallCounter&&(I.marginElement.innerText=formatToCompactNumber(t.final.total.toFixed(0)))}break}}if(I.groupPosCountSpan.innerText="("+L+"/"+I.allPositions.length+")",I.isGroupExitProcessing=!1,I.groupMaxPLSection.style.visibility=O?"visible":"hidden",I.groupMetaDetailsSection.style.display=O?"block":"none",I.groupCallPutInfo.style.display=isGroupCallPutInfoFeature?"flex":"none",I.groupStraddleInfo.style.display=isGroupStraddleInfoFeature?"flex":"none",groupKeysCount[h]>1?I.groupHeader.innerText=S+" "+_ff20b1e(P)+": ":I.groupHeader.innerText=S+": ",k.positions.forEach((e=>{e.quantity>0?e.average_price=e.buy_value/e.buy_quantity:e.quantity<0&&(e.average_price=e.sell_value/e.sell_quantity)})),O&&c(),O){let F=!1;async function u(){for(await _fdb88a4(I.instToken);isAppActive&&groupLoopStatusList[t];){let e=-1,t=await _f8de329(S,void 0),o=await _f1d31cd(I.instToken);if(-1!=t&&-1!=t.price?e=t.price:-1!=o&&-1!=o.last_price&&(e=o.last_price),-1!=e){let t=[];t.push({time:e,value:5e4,color:"#3b6feb"}),I.payGraphSetObject.volumeSeries.setData(t);let o=0;k.positions.forEach((t=>{o+=_fc4427b(t,e)})),I.projected=o,isProjectProfitFeature&&(I.projectedElement.innerText=rupeeZeroDecimalFormatter.format(o),I.projectedElement.classList.toggle("text-Positive",o>0),I.projectedElement.classList.toggle("text-Negative",o<0),null!=C&&(I.ktProjectedTooltip.content="Projected profit if <span class='toolTipSpan'>"+S+"</span> expires at current level of <span class='toolTipSpan'>"+e+"</span> ."),d())}await delay(1500)}}async function f(){for(_f9cd7f8(S,I.expiry),await delay(50);isAppActive&&groupLoopStatusList[t];){let e=await _f8de329(S,I.expiry);if(-1!=e&&-1!=e.price){let t=-1==e.straddlePrice?"N/A":e.straddlePrice.toFixed(2);I.atmIVElement.innerText=-1==e.atmIV?"N/A":e.atmIV.toFixed(2);let o=e.price.toFixed(2);I.syntheticElement.innerText=-1==e.price?"N/A":o;let i=e.spotPrice.toFixed(2);I.spotPriceElement.innerText=-1==e.spotPrice?"N/A":i,I.straddleElement.innerText=t;let a=0,n=0;for(let t=0;t<k.positions.length;t++){const o=k.positions[t];k.mapping[o.positionID];let i=e.spotPrice,r=parseFloat(o.inst.strike),s=e.yearDiff,l=.07365,c=0,u=o.ltp;o.inst&&(u=await _f2907f8(o.inst.instrument_token));let f=o.quantity>=0?1:-1,d=_f9c6a90(o.inst.instrument_type);if(1==d||2==d){let e=_f833675(1==d,i,r,s,l,u);c=void 0!==e?.delta?e.delta:0,a+=c*o.quantity,n+=c*f}else a+=o.quantity,n+=f}I.deltaElement.innerText=a.toFixed(2),I.netDeltaElement.innerText=n.toFixed(2)}await delay(1e3)}}null==k.payGraphSetObject&&(F=!0),_ffcb206(k),F&&_f4ca30e(k),F&&u(),F&&f()}function d(){currentTotalProjected=0;for(let e=0;e<groupKeys.length;e++){let t=positionGroupMapping[groupKeys[e]].groupInfoObject.projected;currentTotalProjected+=t}}}let p=0;for(let K=0;K<n.length;K++){const W=n[K];let U=W.isUnknown,G="Unknown";!U&&W.positions[0]?.inst?.expiry&&(G=W.name.replace(/\s/g,"")+W.positions[0].inst.expiry.split("-").join(""));let j=positionGroupMapping[G];positionTableBody.appendChild(j.groupDiv);const V=[...j.positions].sort(((e,t)=>{if(0===e.quantity&&0!==t.quantity)return 1;if(0===t.quantity&&0!==e.quantity)return-1;const o=e.inst.tradingsymbol.toUpperCase(),i=t.inst.tradingsymbol.toUpperCase();return o.localeCompare(i)}));let q=j.mapping,H=Object.keys(q);const Y=V.map((e=>e.positionID));for(let J=0;J<H.length;J++){let z=H[J];Y.includes(z)||(q[z].row.style.display="none")}for(let Q=0;Q<V.length;Q++){p++;const X=V[Q];let $=X.positionID;if(X.instrument_token,null==q[$]){positionTableBody.insertAdjacentHTML("beforeend",a);const te=positionTableBody.querySelector("tr.just-added");let oe=te.querySelector(".posUtilityParent"),ie=te.querySelector(".posUtilityParent .su-checkbox-group input"),ae=te.querySelector(".posUtilityParent .su-checkbox-group label"),ne=(te.querySelector(".posUtility"),te.querySelector(".instrument span")),re=te.querySelector(".quantity"),se=te.querySelector(".average-price"),le=te.querySelector(".last-price"),ce=te.querySelector(".pnl"),ue=te.querySelector(".change-percent"),fe=te.querySelector(".product span"),de=document.createElement("div");de.classList.toggle("positionRowFooterParent",!0),de.innerHTML=positionFooterRowBlockHTML,te.appendChild(de);let pe=de.querySelector(".posRowStrikeDelta"),me=de.querySelector(".posRowPositionDelta"),_e=de.querySelector(".posRowStrikeIv");_f733cfb(de);let ye=U?"":_f9c6a90(X.inst.instrument_type),be={row:te,positionID:$,inst:X.inst,average_price:0,isOption:1==ye||2==ye,tradingsymbol:X.tradingsymbol,product:X.product,quantity:0,selectInput:ie,selectLabel:ae,positionRowFooterParent:de,strikeDeltaElement:pe,positionDeltaElement:me,positionIvElement:_e,instrumentNameTD:ne,quantityTD:re,avgTD:se,ltpTD:le,plTD:ce,changeTD:ue,productTD:fe};async function m(e){let o=e.inst.name;for(_f9cd7f8(o,e.inst.expiry);isAppActive&&groupLoopStatusList[t];){if(!isPositionRowDeltaFeature){await delay(300);continue}let t=await _f8de329(o,e.inst.expiry);if(-1!=t&&-1!=t.price){const o=e;let i=t.spotPrice,a=parseFloat(o.inst.strike),n=t.yearDiff,r=.07365,s=0,l=0,c=0,u=o.ltp;o.inst&&(u=await _f2907f8(o.inst.instrument_token));const f=o?.inst?.lot_size??1;let d=_f9c6a90(o.inst.instrument_type);if(1==d||2==d){let e=_f833675(1==d,i,a,n,r,u);l=void 0!==e?.delta?e.delta:0,c=void 0!==e?.iv?100*e.iv:0,s=l*o.quantity/f}isPositionRowDeltaFeature&&o.isOption&&(o.strikeDeltaElement.innerText=l.toFixed(3),o.positionDeltaElement.innerText=s.toFixed(3),o.positionIvElement.innerText=0==c?"N/A":c.toFixed(2))}await delay(1e3)}}ie.id=$,ae.setAttribute("for",$),ie.addEventListener("change",(function(){j.groupInfoObject.updateSelectedPositions(be,ie.checked)})),te.setAttribute("data-id",isPositionRowDeltaFeature&&be.isOption?"footerInfo":""),te.style.display=j.groupInfoObject.isGroupFolded?"none":"table-row",q[$]=be,be.isOption&&m(be),te.querySelector(".positionEdit").addEventListener("click",(async function(e){if(!be.inst)return void showPlusMessage(document,"Order placement is not available for this instrument","error");let t=be.inst.instrument_type;"CE"==t||"PE"==t?(e.stopPropagation(),_f8481e6(be.inst,be.quantity,be.product)):showPlusMessage(document,"Feature not available for this type of instrument","error")})),te.querySelector(".positionAdd").addEventListener("click",(async function(e){if(!be.inst)return void showPlusMessage(document,"Order placement is not available for this instrument","error");be.inst.instrument_type,e.stopPropagation();let t={};if(t.product=be.product,t.isModify=!1,t.order_type="MARKET",isBasketWindowOpen){let t=1;e.ctrlKey&&(t=-1),_f9ceac1(be.inst,be.quantity*t)}else _f1a7719(be.inst,be.quantity<0?-1:1,t)})),_f733cfb(oe),te.classList.remove("just-added")}positionTableBody.appendChild(q[$].row);let Z=q[$];Z.row.setAttribute("data-tag",Q==V.length-1?"lastRow":""),Q==V.length-1&&j.groupInfoObject.updateExitParentPosition(),Z.quantity=X.quantity,0==Z.quantity&&(Z.selectInput.checked=!1,j.groupInfoObject.updateSelectedPositions(Z,!1)),Z.selectInput.parentElement.style.visibility=0==Z.quantity?"hidden":"visible";let ee=_f9e6bd5(X.inst,!0,!0);"Unknown"==ee&&(ee=Z.tradingsymbol),Z.instrumentNameTD.innerHTML=ee,Z.instrumentNameTD.addEventListener("click",(function(){if(!Z.inst)return void showPlusMessage(document,"Order placement is not available for this instrument","error");let e={};e.product=Z.product,e.isModify=!1,e.order_type="MARKET",_f1a7719(Z.inst,-Z.quantity,e)})),Z.avgTD.innerText=X.average_price.toFixed(2),Z.quantityTD.innerText=X.quantity,Z.quantityTD.classList.toggle("text-buy",X.quantity>0),Z.quantityTD.classList.toggle("text-sell",X.quantity<0),Z.plTD.classList.toggle("text-green",!1),Z.plTD.classList.toggle("text-red",!1),Z.changeTD.classList.toggle("text-green",!1),Z.changeTD.classList.toggle("text-red",!1),Z.productTD.innerText=_fad67f2(X.product),Z.productTD.classList.toggle("indigo","NRML"==X.product.toUpperCase()),Z.productTD.classList.toggle("amber","MIS"==X.product.toUpperCase()),Z.productTD.classList.toggle("teal","MTF"==X.product.toUpperCase()),Z.quantityTD.classList.toggle("greyed",0==X.quantity),Z.ltpTD.classList.toggle("greyed",0==X.quantity),Z.plTD.classList.toggle("greyed",0==X.quantity),Z.avgTD.classList.toggle("greyed",0==X.quantity),Z.changeTD.classList.toggle("greyed",0==X.quantity),Z.instrumentNameTD.classList.toggle("greyed",0==X.quantity),Z.productTD.parentElement.classList.toggle("greyed",0==X.quantity)}j.groupInfoObject.toggleGroupFold(j.groupInfoObject.isGroupFolded)}positionTableMapping=Object.values(positionGroupMapping).reduce(((e,t)=>({...e,...t.mapping})),{}),toc.positionCountSpan.innerText="("+p+")"}async function _f21d481(e,t){if(isPrem){for(let e=0;e<t.length;e++){const o=t[e];let i=positionTableMapping[o.positionID];if(null==i)continue;let a=0;0!=i.quantity?(a=(o.last_price-o.average_price)/o.average_price*100,i.changeTD.innerText=a.toFixed(2)+"%",i.plTD.classList.toggle("text-green",o.totalProfit>=0),i.plTD.classList.toggle("text-red",o.totalProfit<0),i.changeTD.classList.toggle("text-green",a>=0),i.changeTD.classList.toggle("text-red",a<0)):i.changeTD.innerText=a.toFixed(2)+"%",i.plTD.innerText=signNumberFormatter.format(o.totalProfit),i.ltpTD.innerText=o.last_price.toFixed(2)}for(let t=0;t<e.length;t++){const o=e[t];let i="Unknown";!o.isUnknown&&o.positions[0]?.inst?.expiry&&(i=o.name.replace(/\s/g,"")+o.positions[0].inst.expiry.split("-").join(""));let a=positionGroupMapping[i]?.groupInfoObject;null!=a&&(a.updatePnl(o.profit),a.updateCallPutInfo(o),a.updateStopLossTargetInfo(o))}}}let orderPriceUpdateTimeOut,ordersMapping={},isOrderInit=!1,orderPriceLoopCounter=0;async function _fda5840(e){if(!isPrem)return;let t=_fa44a57("torpedoOrdersRow"),o=["OPEN"],i=["TRIGGER","TRIGGER PENDING"],a=["COMPLETE","CANCELLED","REJECTED"];const n=e.filter((e=>o.includes(e.status.toUpperCase()))).length,r=e.filter((e=>i.includes(e.status.toUpperCase()))).length,s=e.filter((e=>a.includes(e.status.toUpperCase()))).length;isOrderInit||n+r+s==0||(document.querySelector(".noOrderSection").style.display="none",document.querySelector(".orderSetParent").style.display="flex",isOrderInit=!0),toc.openOrderCountSpan.innerText="("+n+")",toc.triggerOrderCountSpan.innerText="("+r+")",toc.completeOrderCountSpan.innerText="("+s+")";let l=document.querySelector(".openOrders tbody"),c=document.querySelector(".triggerOrders tbody"),u=document.querySelector(".completeOrders tbody");document.querySelector(".openOrdersParent").style.display=0!=n?"block":"none",document.querySelector(".triggerOrdersParent").style.display=0!=r?"block":"none",document.querySelector(".completeOrdersParent").style.display=0!=s?"block":"none";let f=[],d=[],p=[],m=[...new Set(e.filter((e=>"OPEN"===e.status?.toUpperCase()&&void 0!==e.instrument_token)).map((e=>e.instrument_token)))];_f8be45a((e=>{_f7d8e25(POSITION_TOKEN_KEY,m)}));for(let n=0;n<e.length;n++){const r=e[n];let s,m=r.order_id,_=r.status.toUpperCase();if(o.includes(_))s=l;else if(a.includes(_))s=u;else{if(!i.includes(_))continue;s=c}if(null==ordersMapping[m]){s.insertAdjacentHTML("beforeend",t);const e=s.querySelector("tr.just-added");let o=e.querySelector(".order-timestamp"),i=e.querySelector(".instrument span"),a=e.querySelector(".transaction-type span"),n=e.querySelector(".quantity"),l=e.querySelector(".productType span"),c=e.querySelector(".average-price"),u=e.querySelector(".trigger-price"),f=e.querySelector(".last-price"),d=e.querySelector(".order-status .order-status-label"),p=e.querySelector(".cancel-order i"),_=_f585a16(r.instrument_token,r.exchange),y={orderID:r.order_id,isUnknown:!1,row:e,tradingsymbol:r.tradingsymbol,inst:_,exchange:r.exchange,orderTime:r.order_timestamp,product:r.product,status:r.status,buySellType:r.transaction_type,price:0,order_type:r.order_type,average_price:0,trigger_price:0,quantity:0,filled_quantity:0,orderTimeTD:o,productTD:l,triggerTD:u,statusTD:d,buySellTypeTD:a,instrumentNameTD:i,quantityTD:n,avgTD:c,ltpTD:f,cancelTD:p,clickHandler:void 0,cancelHandler:void 0};ordersMapping[m]=y,e.classList.remove("just-added")}s.appendChild(ordersMapping[m].row);let y=ordersMapping[m];y.quantity=r.quantity,y.filled_quantity=r.filled_quantity,y.status=r.status,"OPEN"==_||"CANCELLED"==_||i.includes(_)?(y.average_price=r.price,y.trigger_price=r.trigger_price):"COMPLETE"==_&&(y.average_price=r.average_price),o.includes(_)?(y.ltpTD.style.display="table-cell",y.triggerTD.style.display="none",f.push(y)):a.includes(_)?(y.ltpTD.style.display="none",y.triggerTD.style.display="none",y.cancelTD.parentElement.style.display="none",p.push(y)):i.includes(_)&&(y.ltpTD.style.display="none",y.triggerTD.style.display="none",d.push(y)),null==y.inst&&(y.isUnknown=!0),y.quantity=r.quantity,y.orderTimeTD.innerText=r.order_timestamp.split(" ")[1];let b=_f9e6bd5(y.inst,!0);"Unknown"==b&&(b=y.tradingsymbol),y.instrumentNameTD.innerHTML=b,y.productTD.innerText=y.product,y.productTD.innerText=_fad67f2(y.product),y.productTD.classList.toggle("indigo","NRML"==y.product.toUpperCase()),y.productTD.classList.toggle("amber","MIS"==y.product.toUpperCase()),y.productTD.classList.toggle("teal","MTF"==y.product.toUpperCase()),y.buySellTypeTD.innerText=y.buySellType,y.buySellTypeTD.classList.toggle("red","SELL"==y.buySellType),y.buySellTypeTD.classList.toggle("blue","BUY"==y.buySellType),y.avgTD.innerText=y.average_price.toFixed(2),"SL"==y.order_type&&(y.avgTD.innerText=y.average_price.toFixed(2)+"/"+y.trigger_price.toFixed(2)+" trg."),y.triggerTD.innerText=y.trigger_price.toFixed(2),y.quantityTD.innerText=y.filled_quantity+" / "+y.quantity,y.statusTD.innerText=y.status.toUpperCase(),y.statusTD.classList.toggle("green","COMPLETE"==y.status.toUpperCase()),y.statusTD.classList.toggle("red","REJECTED"==y.status.toUpperCase()),null!=y.clickHandler&&y.instrumentNameTD.removeEventListener("click",y.clickHandler),y.clickHandler=function(){if(y.isUnknown)return void showPlusMessage(document,"Order placement is not available for this instrument","error");let e=0,t={};t.product=y.product,t.isModify="OPEN"==_||"TRIGGER PENDING"==_,t.orderID=y.orderID,t.order_type=y.order_type,t.price=y.average_price,t.triggerPrice=y.trigger_price,e="BUY"==y.buySellType.toUpperCase()?Math.abs(y.quantity):-Math.abs(y.quantity),_f1a7719(y.inst,e,t)},y.instrumentNameTD.addEventListener("click",y.clickHandler),void 0!==y.cancelHandler&&y.cancelTD.removeEventListener("click",y.cancelHandler),y.cancelHandler=async function(){let e={orderID:y.orderID,exchange:y?.inst?.exchange||y.exchange};await _f02bd32(e)},y.cancelTD.addEventListener("click",y.cancelHandler)}f.sort(((e,t)=>new Date(t.orderTime)-new Date(e.orderTime))),f.forEach((e=>{l.appendChild(e.row)})),p.sort(((e,t)=>new Date(t.orderTime)-new Date(e.orderTime))),p.forEach((e=>{u.appendChild(e.row)})),async function(){orderPriceLoopCounter++;let t=orderPriceLoopCounter;for(null!=orderPriceUpdateTimeOut&&(orderPriceUpdateTimeOut.cancel(),await delay(1));isAppActive&&t==orderPriceLoopCounter;){for(let o=0;o<e.length;o++){let i=e[o].order_id,a=ordersMapping[i];if(null!=a&&"OPEN"==a.status.toUpperCase()){let e=await _f1d31cd(a.inst.instrument_token);if(t!=orderPriceLoopCounter)return;if(-1!=e&&null!=e){let t=e.last_price.toFixed(2);a.ltpTD.innerText=t}}}orderPriceUpdateTimeOut=delayFlex(500),await orderPriceUpdateTimeOut.promise}}()}async function _f4e8c47(e){let t=[];for(let o=0;o<e.length;o++){let i=e[o];0!=i.quantity&&t.push({inst:i.inst,quantity:i.quantity,isSell:i.quantity<0,product:i.product,positionID:i.positionID})}let o=[];for(let e=0;e<t.length;e++){let i=t[e],a=i.inst.freezeQty,n=Math.abs(i.quantity);if(n>a&&null!=a){let e=i.inst.lot_size,t=n/e,r=Math.ceil(n/a),s=distributeNumber(t,r);for(let t=0;t<s.length;t++){let a=JSON.parse(JSON.stringify(i));a.quantity=s[t]*e,o.push(a)}}else o.push(i)}for(let e=0;e<o.length;e++){const t=o[e];if(0==t.quantity)continue;let i,a,n=await _f1d31cd(t.inst.instrument_token);n?.depth?.sell?.length&&n?.depth?.buy?.length?(i=n.depth.sell[0].price,a=n.depth.buy[0].price):(i=n.last_price,a=n.last_price);let r=n.last_price,s=n.last_price;s=getSimpleProtectedSellPrice(a),r=getSimpleProtectedBuyPrice(i);let l=0,c=!0;l=t.isSell?c?s:r:c?r:s;let u=!1;c&&(u=!0);let f=1;"MCX"==t.inst.exchange&&(f=_f9b6bef(t.inst.name));let d={variety:"regular",inst:t.inst,multiplier:f,exchange:t.inst.exchange,tradingsymbol:t.inst.tradingsymbol,transaction_type:t.isSell?"BUY":"SELL",order_type:u?"LIMIT":"MARKET",quantity:Math.abs(t.quantity),price:u?l:0,product:t.product,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID},p=await _fd25cf4(d);if(200!=p.statusCode){let e=p.message,t=e.indexOf("[Read");t>0&&(e=e.substring(0,t)),e.includes("AMO")&&(e="Market is closed! Can't place the order right now."),showPlusMessage(document,e,"error")}await delay(t.isSell?SELL_LEG_WAIT:BUY_LEG_WAIT)}return 1}async function _f06c2a0(e){if("PLACED"==e.orderStatus&&"LIMIT"==e.orderType&&_f2d3a88("Placed",`${e.buySellType}  ${e.tradingSymbol} is Placed`,"info"),"COMPLETED"==e.orderStatus){let t=`${e.buySellType}  ${e.tradingSymbol} is Complete`;t+="<br>",t+=`${Math.abs(e.quantity)} Qty. @ ${e.averagePrice}`,_f2d3a88("Completed",t,"success"),"BUY"==e.buySellType.toUpperCase()?playTorpeoClip("orderExecuteBuy"):playTorpeoClip("orderExecuteSell")}if("CANCELLED"==e.orderStatus){if(0==e.unfilledSize)return;_f2d3a88("CANCELLED",`${e.buySellType}  ${e.tradingSymbol} is Cancelled`,"info")}if("REJECTED"==e.orderStatus){let t=`${e.buySellType}  ${e.tradingSymbol} is Rejected`;t+="<br>",t+=`${e.rejectReason}`,_f2d3a88("REJECTED",t,"error")}}let watchListChain,watchListParent,customWatchListParent,watchListPoolElement,watchListSubPart1,watchListSubPart2,watchListRowblock,currentWatchList=[],watchListRowPool=[],MAX_TOTAL_STRIKES_LIMIT=50,prefWatchList_TotalStrikes=40,prefWatchList_ITMStrikes=0,isWatchListOptionSetVisible=!0,selectedWatchListNumber=0,WATCHLIST_SYMBOL_LIMIT=100,cWo={currentWatchList:[]},cwoData={symbolMapping:{}};async function _f69709e(){if(watchListRowblock=_fa44a57("torpedoWatchListRow"),prefWatchList_TotalStrikes=parseInt(await _fb3ac9d("prefWatchList_TotalStrikes",prefWatchList_TotalStrikes)),prefWatchList_ITMStrikes=parseInt(await _fb3ac9d("prefWatchList_ITMStrikes",prefWatchList_ITMStrikes)),selectedWatchListNumber=await _fb3ac9d("selectedWatchListNumber",selectedWatchListNumber),cwoData=await _fb3ac9d("cwoData",cwoData),null!=cwoData.symbolMapping[1]){for(let e=cwoData.symbolMapping[1].length-1;e>=0;e--){if(null==cwoData.symbolMapping[1][e]||null==cwoData.symbolMapping[1][e]){cwoData.symbolMapping[1].splice(e,1);continue}let t=_f585a16(cwoData.symbolMapping[1][e].instrument_token);cwoData.symbolMapping[1][e]=t}await setSyncStorage("cwoData",cwoData)}isWatchListOptionSetVisible=await _fb3ac9d("isWatchListOptionSetVisible",isWatchListOptionSetVisible),watchListChain=document.querySelector(".watchListChain"),watchListParent=watchListChain.querySelector(".watchListParent"),watchListSubPart1=watchListChain.querySelector(".watchListSubPart1"),watchListSubPart2=watchListChain.querySelector(".watchListSubPart2"),watchListPoolElement=watchListChain.querySelector(".watchListPool");let e=watchListChain.querySelector(".floatingToggle"),t=watchListChain.querySelector(".downArrowBtn"),o=watchListChain.querySelector(".upArrowBtn");function i(){watchListChain.classList.toggle("hiddenWatchListOption",!isWatchListOptionSetVisible),o.style.display=isWatchListOptionSetVisible?"block":"none",t.style.display=isWatchListOptionSetVisible?"none":"block"}e.addEventListener("click",(async()=>{isWatchListOptionSetVisible=!isWatchListOptionSetVisible,i(),await setSyncStorage("isWatchListOptionSetVisible",isWatchListOptionSetVisible)})),i();let a=watchListChain.querySelector(".totalStrikeCustomSelector"),n={minusButton:a.querySelector(".strikeDown"),plusButton:a.querySelector(".strikeUp"),textElement:a.querySelector("span")};n.textElement.innerText=prefWatchList_TotalStrikes,_f9b2ec3(n,(async e=>{e?(await setSyncStorage("prefWatchList_TotalStrikes",prefWatchList_TotalStrikes),_f9da2f3()):(prefWatchList_TotalStrikes+=n.direction,prefWatchList_TotalStrikes=mathClamp(prefWatchList_TotalStrikes,4,MAX_TOTAL_STRIKES_LIMIT),n.textElement.innerText=prefWatchList_TotalStrikes)}));let r=watchListChain.querySelector(".itmStrikeCustomSelector"),s={minusButton:r.querySelector(".strikeDown"),plusButton:r.querySelector(".strikeUp"),textElement:r.querySelector("span")};s.textElement.innerText=prefWatchList_ITMStrikes,_f9b2ec3(s,(async e=>{e?(await setSyncStorage("prefWatchList_ITMStrikes",prefWatchList_ITMStrikes),_f9da2f3()):(prefWatchList_ITMStrikes+=s.direction,prefWatchList_ITMStrikes=mathClamp(prefWatchList_ITMStrikes,-15,15),s.textElement.innerText=prefWatchList_ITMStrikes)}));let l=!0;l=await _fb3ac9d("prefColorizeStrikesKey",l);let c=document.querySelector("#idPrefColorizeStrikes");function u(){watchListParent.classList.toggle("colorized",l),watchListParent.classList.toggle("flatColorized",!l)}null!=c&&c.addEventListener("change",(function(){l=c.checked,u()})),u(),customWatchListParent=watchListChain.querySelector(".customWatchListParent"),cWo.customWatchListPart=watchListChain.querySelector(".customWatchListPart"),cWo.watchListRowActionBar=watchListChain.querySelector("#watchListRowActionBar"),cWo.watchListInfoText=watchListChain.querySelector(".watchListInfo"),cWo.watchListRowActionBar.style.opacity=0,new Sortable(cWo.customWatchListPart,{animation:150,handle:".watchlistRowHandle",ghostClass:"dragging",onEnd:async function(e){let t=[...cWo.customWatchListPart.children].map((e=>e.dataset.id)).map((e=>cwoData.symbolMapping[selectedWatchListNumber][e]));cwoData.symbolMapping[selectedWatchListNumber]=t,await setSyncStorage("cwoData",cwoData);for(let e=0;e<cWo.customWatchListPart.children.length;e++)cWo.customWatchListPart.children[e].setAttribute("data-id",e)}});let f=watchListChain.querySelectorAll(".watchListSelector");async function d(e){for(let e=0;e<f.length;e++)f[e].classList.toggle("selectedWatchList",e==selectedWatchListNumber);watchListParent.style.display=0==selectedWatchListNumber?"flex":"none",customWatchListParent.style.display=0!=selectedWatchListNumber?"flex":"none";for(let t=1;t<f.length;t++)e&&_f8aee14(t)}cWo.searchClose=customWatchListParent.querySelector(".searchClose"),cWo.basketSearchInput=customWatchListParent.querySelector("input"),cWo.basketSearchDiv=customWatchListParent.querySelector(".basketSearchDiv"),cWo.searchUlParentDiv=customWatchListParent.querySelector(".ulParentDiv"),cWo.searchSymbol=customWatchListParent.querySelector(".searchButtonSymbol"),f.forEach((e=>{e.addEventListener("click",(async function(e){selectedWatchListNumber=this.dataset.id,d(!1),await setSyncStorage("selectedWatchListNumber",selectedWatchListNumber)}))}));let p=!1,m=!0;!async function(){let e=[];for(let t=0;t<underlyingMapping.length;t++){const o=underlyingMapping[t];e.push({name:JSON.stringify(o.Name),Name:o.Name.toUpperCase(),instrument_token:o.InstrumentToken})}function t(e){_f1a7719(activePoolItem.inst,e?-1:1)}cWo.deleteActionBtn=cWo.watchListRowActionBar.querySelector(".deleteActionBtn"),cWo.deleteActionBtn.addEventListener("click",(async function(e){!async function(e){for(let t=cwoData.symbolMapping[selectedWatchListNumber].length-1;t>=0;t--)cwoData.symbolMapping[selectedWatchListNumber][t].instrument_token==e.instrument_token&&cwoData.symbolMapping[selectedWatchListNumber].splice(t,1);_f8aee14(),await setSyncStorage("cwoData",cwoData)}(activePoolItem.inst)})),cWo.buyActionBtn=cWo.watchListRowActionBar.querySelector(".buyActionBtn"),cWo.buyActionBtn.addEventListener("click",(async function(e){t(!1)})),cWo.sellActionBtn=cWo.watchListRowActionBar.querySelector(".sellActionBtn"),cWo.sellActionBtn.addEventListener("click",(async function(e){t(!0)}));let o=0,i=50,a=cWo.basketSearchDiv.querySelector("ul"),n=[],r=[];for(let e=0;e<i;e++){let t=document.createElement("li"),o=e;a.appendChild(t),n.push(t),r.push(void 0),t.addEventListener("click",(e=>{s(r[o])}))}async function s(e){c(),e&&async function(e){(cwoData.symbolMapping[selectedWatchListNumber]??=[]).length>=WATCHLIST_SYMBOL_LIMIT?showPlusMessage(document,"Watchlist is full, delete some symbols","error"):((cwoData.symbolMapping[selectedWatchListNumber]??=[]).push(e),_f8aee14(),await setSyncStorage("cwoData",cwoData))}(e)}function l(){y=0;for(let e=0;e<i;e++)n[e].innerText="",n[e].style.display="none",r[e]=void 0}function c(){u(!1),l(),cWo.basketSearchInput.value="",cWo.basketSearchInput.blur()}function u(e){o=(new Date).getTime(),p=e,cWo.searchClose.style.visibility=e?"visible":"hidden",cWo.searchUlParentDiv.style.visibility=e?"visible":"hidden"}function f(e,t,o){let i="";i=o||("MCX"==t?.exchange?_f9e6bd5(t):t?.name.replace(/^"(.*)"$/,"$1")??"-");let a=(cwoData?.symbolMapping?.[selectedWatchListNumber]??[]).some((e=>e.instrument_token==t.instrument_token));n[e].innerText=i,n[e].classList.toggle("existingSymbol",a),n[e].style.display="block",r[e]=t}function d(){n.forEach(((e,t)=>{e.classList.toggle("active",t===_)}))}document.addEventListener("click",(async()=>{m&&(await delay(50),(new Date).getTime()-o<400||p&&c())})),cWo.searchSymbol.addEventListener("click",(e=>{cWo.basketSearchInput.focus(),cWo.basketSearchInput.value=""})),cWo.searchClose.addEventListener("click",(()=>{c()})),cWo.basketSearchInput.addEventListener("keydown",(e=>{"Escape"===e.key&&c(),e.stopImmediatePropagation()}),!0),cWo.basketSearchInput.addEventListener("mouseup",(async()=>{await delay(10),m=!0})),cWo.basketSearchInput.addEventListener("mousedown",(async()=>{m=!1})),cWo.basketSearchInput.addEventListener("blur",(e=>{})),cWo.basketSearchInput.addEventListener("focus",(e=>{cWo.basketSearchInput.value="",y=0,_=-1,d(),function(){u(!0),l();for(let e=0;e<i;e++)null!=equityInstruments[e]&&(y++,f(e,equityInstruments[e]))}()}));let _=-1,y=0;window.addEventListener("keydown",(e=>{if(p)if("ArrowDown"===e.key)_=(_+1)%y,d(),e.preventDefault();else if("ArrowUp"===e.key)_=(_-1+y)%y,d(),e.preventDefault();else if("Enter"===e.key){if(_>=0){const e=r[_];e&&(s(e),c()),_=-1,d()}e.preventDefault()}}),!0),cWo.basketSearchInput.addEventListener("input",(e=>{let t=cWo.basketSearchInput.value.toLowerCase();if(y=0,u(!1),""==t.trim())return void u(!1);u(!0),l(),u(!0);const o=t.trim().split(/\s+/),a=e=>{const t=e.toLowerCase();return o.every((e=>t.includes(e)))},n=[...equityInstruments.filter((e=>a(e.name))),...mcxFutureInstruments.filter((e=>a(e.tradingsymbol)))];let r=Math.min(n.length,i);for(let e=0;e<r;e++)f(e,n[e]),y++}),!0)}(),d(!0)}let activePoolItem,isCustomWatchListStarted=!1,isCustomWatchListRefreshing=!1;async function _f8aee14(e){isCustomWatchListRefreshing=!0;let t=e??selectedWatchListNumber,o=[...cwoData.symbolMapping[t]??[]];cWo.watchListInfoText.innerText="Stocks ("+o.length+" / "+WATCHLIST_SYMBOL_LIMIT+")";let i=cWo.currentWatchList.filter((e=>!o.some((t=>t.instrument_token===e.instrument_token)))),a=o.filter((e=>!cWo.currentWatchList.some((t=>t.instrument_token===e.instrument_token))));for(let e=0;e<i.length;e++)i[e].poolElement.isActive=!1;cWo.currentWatchList=cWo.currentWatchList.filter((e=>!i.some((t=>t.instrument_token===e.instrument_token))));for(let e=0;e<o.length;e++){const t=o[e];let i=!1,a=cWo.currentWatchList.find((e=>e.instrument_token==t.instrument_token));if(null==a){i=!0;let e,o=watchListRowPool.find((e=>0==e.isActive));a={inst:t,instrument_token:t.instrument_token,poolElement:o},null==o?(customWatchListParent.insertAdjacentHTML("beforeend",watchListRowblock),e=customWatchListParent.querySelector(".just-added"),o={row:e,nameElement:e.querySelector(".watchList_strike"),ltpElement:e.querySelector(".watchList_ltp"),directionArrowElement:e.querySelector(".changeDirection"),changeElement:e.querySelector(".watchList_change"),clickHandler:void 0,mouseEnterHandler:void 0,mouseLeaveHandler:void 0,isActive:!0},e.classList.remove("just-added"),watchListRowPool.push(o),a.poolElement=o):(e=o.row,o.isActive=!0),null!=o.mouseEnterHandler&&o.row.removeEventListener("mouseenter",o.mouseEnterHandler),null!=o.mouseLeaveHandler&&o.row.removeEventListener("mouseleave",o.mouseLeaveHandler),o.mouseEnterHandler=function(e){activePoolItem=a,o.row.appendChild(cWo.watchListRowActionBar),cWo.watchListRowActionBar.style.opacity=1},o.mouseLeaveHandler=function(e){cWo.watchListRowActionBar.style.opacity=0},o.row.addEventListener("mouseenter",o.mouseEnterHandler),o.row.addEventListener("mouseleave",o.mouseLeaveHandler),cWo.currentWatchList.push(a)}let n=a.poolElement;a.inst=t,a.instrument_token=t.instrument_token,n.row.setAttribute("data-id",e),null!=n.clickHandler&&n.nameElement.removeEventListener("click",n.clickHandler),n.clickHandler=function(e){},i&&(a.poolElement.nameElement.innerHTML=_f9e6bd5(a.inst,!0),a.poolElement.ltpElement.innerText="N/A"),n.nameElement.addEventListener("click",n.clickHandler),cWo.customWatchListPart.appendChild(a.poolElement.row)}for(let e=0;e<watchListRowPool.length;e++){const t=watchListRowPool[e];t.row.style.display=t.isActive?"flex":"none",t.isActive||watchListPoolElement.appendChild(t.row)}if(a.length>0){let e=a.map((e=>e.instrument_token));_f7d8e25(CUSTOM_WATCHLIST_TOKEN_KEY,e)}if(i.length>0){let e=i.map((e=>e.instrument_token));_f7ff8c5(CUSTOM_WATCHLIST_TOKEN_KEY,e)}isCustomWatchListRefreshing=!1,isCustomWatchListStarted||async function(){for(isCustomWatchListStarted=!0;isAppActive;){let e=cWo.currentWatchList;for(let t=0;t<e.length;t++){const o=e[t];let i=await _f1d31cd(o.instrument_token,5);if(-1!=i){if(isCustomWatchListRefreshing){await delay(100);break}o.poolElement.nameElement.classList.toggle("text-Positive",i.change>=0),o.poolElement.nameElement.classList.toggle("text-Negative",i.change<0),o.poolElement.ltpElement.innerText=i.last_price.toFixed(2),o.poolElement.changeElement.innerText=i.change.toFixed(2),o.poolElement.ltpElement.classList.toggle("text-Positive",i.change>=0),o.poolElement.ltpElement.classList.toggle("text-Negative",i.change<0),o.poolElement.directionArrowElement.classList.toggle("fa-caret-up",i.change>=0),o.poolElement.directionArrowElement.classList.toggle("fa-caret-down",i.change<0)}}await delay(500)}}()}let isWatchListStarted=!1,isWatchListRefreshing=!1,isStraddleWatchList=!1;async function _f9da2f3(){isWatchListRefreshing=!0,watchListParent.classList.toggle("straddleWatchList",isStraddleWatchList),watchListParent.classList.toggle("strangleWatchList",!isStraddleWatchList);let e,t=await _fb3ac9d("prefIndexMetaSymbolKey",prefIndexMetaSymbol),o=await _fb3ac9d("prefIndexMetaExpiryKey",prefIndexMetaExpiry),i=parseInt(prefWatchList_TotalStrikes),a=parseInt(prefWatchList_ITMStrikes),n=_fda88a8(t,"NSE"),r=-1;for(;-1==r;)r=await _f2907f8(n),await delay(10);for(;!e;)e=_f41274d(t,o),await delay(10);let s=[...e.peList,...e.ceList],l=_fed54b2(e.ceList,e.peList,r),c=e.ceList.findIndex((e=>e.strike===l.CE.strike)),u=e.peList.findIndex((e=>e.strike===l.PE.strike)),f=groupBy(s,"strike"),d=Object.keys(f),p=d.findIndex((e=>e==l.CE.strike)),m=Math.ceil(i/2),_=Math.min(p-Math.floor(m/2),d.length),y=Math.max(c-a,0),b=Math.min(u+a,e.peList.length-1),g=[],h=[],S=[];if(isStraddleWatchList)for(let e=0;e<m;e++){let t=d[_+e];S.push(f[t][1]),S.push(f[t][0])}else{for(let t=0;t<i/2;t++)b-t<0||g.push(e.peList[b-t]);for(let t=0;t<i/2;t++)y+t>=e.ceList.length||h.push(e.ceList[y+t]);g.reverse(),S=[...g,...h]}let T=currentWatchList.filter((e=>!S.some((t=>t.instrument_token===e.instrument_token)))),w=S.filter((e=>!currentWatchList.some((t=>t.instrument_token===e.instrument_token))));for(let e=0;e<T.length;e++)T[e].poolElement.isActive=!1;currentWatchList=currentWatchList.filter((e=>!T.some((t=>t.instrument_token===e.instrument_token))));for(let e=0;e<S.length;e++){const t=S[e];let o=currentWatchList.find((e=>e.instrument_token==t.instrument_token));if(null==o){let e,i=watchListRowPool.find((e=>0==e.isActive));o={inst:t,instrument_token:t.instrument_token,poolElement:i},null==i?(watchListParent.insertAdjacentHTML("beforeend",watchListRowblock),e=watchListParent.querySelector(".just-added"),i={row:e,nameElement:e.querySelector(".watchList_strike"),ltpElement:e.querySelector(".watchList_ltp"),directionArrowElement:e.querySelector(".changeDirection"),changeElement:e.querySelector(".watchList_change"),clickHandler:void 0,mouseEnterHandler:void 0,mouseLeaveHandler:void 0,isActive:!0},e.classList.remove("just-added"),watchListRowPool.push(i),o.poolElement=i):(e=i.row,i.isActive=!0),currentWatchList.push(o)}let i=o.poolElement;o.inst=t,o.instrument_token=t.instrument_token,null!=i.clickHandler&&i.nameElement.removeEventListener("click",i.clickHandler),i.clickHandler=function(e){let t=!1;if(isBasketWindowOpen){let i=1;e.ctrlKey&&(i=-1),t=1==_f9ceac1(o.inst,-o.inst.lot_size*i)}else t=!1;t||_f1a7719(o.inst,-1)},i.nameElement.addEventListener("click",i.clickHandler),null!=i.mouseEnterHandler&&i.row.removeEventListener("mouseenter",i.mouseEnterHandler),null!=i.mouseLeaveHandler&&i.row.removeEventListener("mouseleave",i.mouseLeaveHandler),i.mouseEnterHandler=function(e){activePoolItem=o,i.row.appendChild(cWo.watchListRowActionBar),cWo.watchListRowActionBar.style.opacity=1},i.mouseLeaveHandler=function(e){cWo.watchListRowActionBar.style.opacity=0},i.row.addEventListener("mouseenter",i.mouseEnterHandler),i.row.addEventListener("mouseleave",i.mouseLeaveHandler),isStraddleWatchList?t.strike<r?watchListSubPart1.appendChild(o.poolElement.row):watchListSubPart2.appendChild(o.poolElement.row):"PE"==t.instrument_type?watchListSubPart1.appendChild(o.poolElement.row):watchListSubPart2.appendChild(o.poolElement.row),o.poolElement.row.classList.toggle("ceRow","CE"==o.inst.instrument_type),o.poolElement.row.classList.toggle("peRow","PE"==o.inst.instrument_type),o.poolElement.nameElement.innerHTML=_f9e6bd5(o.inst,!0),o.poolElement.ltpElement.innerText="N/A"}for(let e=0;e<watchListRowPool.length;e++){const t=watchListRowPool[e];t.row.style.display=t.isActive?"flex":"none",t.isActive||watchListPoolElement.appendChild(t.row)}if(w.length>0){let e=w.map((e=>e.instrument_token));_f7d8e25(WATCHLIST_TOKEN_KEY,e)}if(T.length>0){let e=T.map((e=>e.instrument_token));_f7ff8c5(WATCHLIST_TOKEN_KEY,e)}isWatchListRefreshing=!1,isWatchListStarted||async function(){for(isWatchListStarted=!0;isAppActive;){for(let e=0;e<currentWatchList.length;e++){const t=currentWatchList[e];let o=await _f1d31cd(t.instrument_token,5);if(-1!=o&&null!=o.change){if(isWatchListRefreshing){await delay(100);break}prefColorizeStrikes.key?(t.poolElement.nameElement.classList.toggle("text-Positive",!1),t.poolElement.nameElement.classList.toggle("text-Negative",!1)):(t.poolElement.nameElement.classList.toggle("text-Positive",o.change>=0),t.poolElement.nameElement.classList.toggle("text-Negative",o.change<0)),t.poolElement.ltpElement.innerText=o.last_price.toFixed(2),t.poolElement.changeElement.innerText=o.change.toFixed(2),t.poolElement.ltpElement.classList.toggle("text-Positive",o.change>=0),t.poolElement.ltpElement.classList.toggle("text-Negative",o.change<0),t.poolElement.directionArrowElement.classList.toggle("fa-caret-up",o.change>=0),t.poolElement.directionArrowElement.classList.toggle("fa-caret-down",o.change<0)}}await delay(500)}}(),await delay(200)}